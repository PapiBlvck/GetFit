<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Track your fitness goals, workouts, nutrition, and health metrics all in one place">
    <meta name="theme-color" content="#32D74B">
    <title>GetFit App</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <link rel="apple-touch-icon" href="/public/logo.avif">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="GetFit">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    
    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut, updatePassword, EmailAuthProvider, reauthenticateWithCredential, deleteUser } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, doc, setDoc, getDoc, collection, query, where, getDocs, orderBy, limit, updateDoc, Timestamp, increment, deleteDoc } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
        import { getStorage, ref, uploadBytes, getDownloadURL, deleteObject } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js';
        
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA7h3xBXLb434Jf0F1ZxcZnkrXoySIHWVc",
            authDomain: "getfit-31e8c.firebaseapp.com",
            projectId: "getfit-31e8c",
            storageBucket: "getfit-31e8c.firebasestorage.app",
            messagingSenderId: "672703837611",
            appId: "1:672703837611:web:914698ec2a808420baceee",
            measurementId: "G-JCYL99LSGC"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);
        
        // Make available globally
        window.firebaseAuth = auth;
        window.firebaseDb = db;
        window.firebaseStorage = storage;
        window.firebaseSignIn = signInWithEmailAndPassword;
        window.firebaseSignUp = createUserWithEmailAndPassword;
        window.firebaseSignOut = signOut;
        window.firebaseOnAuthStateChanged = onAuthStateChanged;
        window.firebaseUpdatePassword = updatePassword;
        window.firebaseEmailAuthProvider = EmailAuthProvider;
        window.firebaseReauthenticateWithCredential = reauthenticateWithCredential;
        window.firebaseDeleteUser = deleteUser;
        window.firestoreDoc = doc;
        window.firestoreSetDoc = setDoc;
        window.firestoreGetDoc = getDoc;
        window.firestoreCollection = collection;
        window.firestoreQuery = query;
        window.firestoreWhere = where;
        window.firestoreGetDocs = getDocs;
        window.firestoreOrderBy = orderBy;
        window.firestoreLimit = limit;
        window.firestoreUpdateDoc = updateDoc;
        window.firestoreIncrement = increment;
        window.firestoreTimestamp = Timestamp;
        window.firestoreDeleteDoc = deleteDoc;
        window.firebaseStorageRef = ref;
        window.firebaseUploadBytes = uploadBytes;
        window.firebaseGetDownloadURL = getDownloadURL;
        window.firebaseDeleteObject = deleteObject;
    </script>
    
    <script type="module">
        import { createIcons } from 'https://unpkg.com/lucide@latest?module';
        window.createIcons = createIcons;
    </script>
    <style>
        :root {
            --color-primary: #0A0A0A;
            --color-card: #1C1C1E;
            --color-accent: #32D74B;
            --color-accent-secondary: #00D9FF;
            --color-accent-tertiary: #FF6B6B;
            --color-text-light: #F2F2F7;
            --color-text-muted: #8E8E93;
            --gradient-primary: linear-gradient(135deg, #32D74B 0%, #00D9FF 100%);
            --gradient-secondary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-tertiary: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gradient-dark: linear-gradient(135deg, #1f1c2c 0%, #928DAB 100%);
        }
        
        * {
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-primary);
            color: var(--color-text-light);
            margin: 0;
            padding: 0;
            overflow-x: hidden;
            background-image: 
                linear-gradient(rgba(10, 10, 10, 0.92), rgba(10, 10, 10, 0.92)),
                url('https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=1920&h=1080&fit=crop&auto=format');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
        }
        
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        /* ===== TOP NAVIGATION BAR (ALL DEVICES) ===== */

        /* Global Animated Background (Landing Page Style) */
        body {
            background: #0A0A0A;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 30% 20%, rgba(0, 255, 245, 0.12) 0%, transparent 50%),
                radial-gradient(circle at 70% 60%, rgba(191, 0, 255, 0.12) 0%, transparent 50%);
            animation: backgroundRotate 30s linear infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes backgroundRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Update main content - no sidebar, just top nav */
        #app-container {
            margin-left: 0;
            padding-top: 70px; /* Space for fixed top nav */
            position: relative;
            z-index: 1;
        }

        #main-content {
            background: transparent !important;
        }

        /* Hide top nav on landing/login pages */
        body.landing-page .mobile-top-nav {
            display: none !important;
        }

        body.landing-page #app-container {
            padding-top: 0;
        }

        /* Top Navigation - Always Visible */
        .mobile-top-nav {
            display: flex !important; /* Always show */
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: 70px;
            background: rgba(20, 20, 20, 0.98);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 255, 245, 0.1);
            z-index: 1000;
            padding: 0 1.5rem;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.4);
        }

        .mobile-brand {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .mobile-brand-icon {
            width: 42px;
            height: 42px;
            background: linear-gradient(135deg, #32D74B, #00D9FF);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 1rem;
            color: black;
        }

        .mobile-brand-name {
            font-size: 1.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #32D74B, #00D9FF);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        @media (max-width: 640px) {
            .mobile-brand-name {
                font-size: 1.25rem;
            }
            .mobile-brand-icon {
                width: 36px;
                height: 36px;
            }
        }

        .mobile-menu-toggle {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 0.5rem;
        }

        .mobile-nav-dropdown {
            display: none;
            position: fixed;
            top: 60px;
            left: 0;
            right: 0;
            background: rgba(20, 20, 20, 0.98);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 255, 245, 0.1);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 999;
            max-height: calc(100vh - 60px);
            overflow-y: auto;
        }

        .mobile-nav-dropdown.show {
            display: block;
        }

        .mobile-nav-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            color: rgba(174, 174, 178, 1);
            text-decoration: none;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.2s ease;
        }

        .mobile-nav-item:hover,
        .mobile-nav-item.active {
            background: rgba(0, 255, 245, 0.05);
            color: #00FFF5;
        }

        .mobile-nav-icon {
            width: 24px;
            height: 24px;
        }

        /* Responsive design - Top nav always visible */
        @media (max-width: 768px) {
            .mobile-top-nav {
                height: 60px;
                padding: 0 1rem;
            }

            #app-container {
                padding-top: 60px;
            }
        }
        
        /* Modern Gradient Cards */
        .gradient-card {
            background: linear-gradient(135deg, rgba(50, 215, 75, 0.1) 0%, rgba(0, 217, 255, 0.1) 100%);
            border: 1px solid rgba(50, 215, 75, 0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .gradient-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px rgba(50, 215, 75, 0.15);
            border-color: rgba(50, 215, 75, 0.4);
        }
        
        /* Animated Gradient Background */
        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .animated-gradient {
            background: linear-gradient(270deg, #32D74B, #00D9FF, #667eea, #f093fb);
            background-size: 800% 800%;
            animation: gradientShift 15s ease infinite;
        }
        
        /* Glass Morphism Effect */
        .glass-card {
            background: #1f2937;
            backdrop-filter: blur(20px) saturate(180%);
            border: 1px solid #374151;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        /* Shimmer Effect */
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }
        
        .shimmer {
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            background-size: 1000px 100%;
            animation: shimmer 2s infinite;
        }
        
        /* Progress Bar Animation */
        .progress-bar {
            transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        /* Pulse Animation */
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.05); }
        }
        
        .pulse-animation {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        /* Floating Animation */
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        .float-animation {
            animation: float 3s ease-in-out infinite;
        }
        
        /* Stat Card with Gradient Border */
        .stat-card {
            position: relative;
            background: #1f2937;
            border-radius: 0.75rem;
            padding: 1rem;
            border: 1px solid #374151;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            min-height: 10rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .stat-card-inner {
            background: transparent;
            border-radius: 0;
            padding: 0;
            height: 100%;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card-inner::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, rgba(45, 212, 191, 0.1), transparent);
            border-radius: 50%;
            transform: translate(50%, -50%);
        }
        
        /* Badge Styles */
        .badge-glow {
            box-shadow: 0 0 20px rgba(20, 184, 166, 0.5);
        }
        
        /* Custom Scrollbar for main content */
        main::-webkit-scrollbar {
            width: 8px;
        }
        
        main::-webkit-scrollbar-track {
            background: rgba(28, 28, 30, 0.3);
        }
        
        main::-webkit-scrollbar-thumb {
            background: rgba(50, 215, 75, 0.5);
            border-radius: 4px;
        }
        
        main::-webkit-scrollbar-thumb:hover {
            background: rgba(50, 215, 75, 0.7);
        }
        
        /* Button Hover Effects */
        .btn-primary {
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .btn-primary::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
            pointer-events: none;
        }
        
        .btn-primary:hover::before {
            width: 300px;
            height: 300px;
        }
        
        /* Tooltip */
        .tooltip {
            position: relative;
        }
        
        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            padding: 0.5rem 1rem;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            white-space: nowrap;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }
        
        .tooltip:hover::after {
            opacity: 1;
        }
        
        /* Loading Skeleton */
        @keyframes skeleton-loading {
            0% { background-position: -200px 0; }
            100% { background-position: calc(200px + 100%) 0; }
        }
        
        .skeleton {
            background: linear-gradient(90deg, #1C1C1E 0px, #2C2C2E 40px, #1C1C1E 80px);
            background-size: 200px 100%;
            animation: skeleton-loading 1.5s infinite;
        }
        
        /* Custom Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 12px;
            pointer-events: none;
        }
        
        .toast {
            min-width: 320px;
            padding: 16px 20px;
            border-radius: 12px;
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            display: flex;
            align-items: center;
            gap: 12px;
            pointer-events: all;
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }
        
        .toast.success {
            background: rgba(50, 215, 75, 0.15);
            border: 1px solid rgba(50, 215, 75, 0.3);
        }
        
        .toast.error {
            background: rgba(255, 107, 107, 0.15);
            border: 1px solid rgba(255, 107, 107, 0.3);
        }
        
        .toast.info {
            background: rgba(0, 217, 255, 0.15);
            border: 1px solid rgba(0, 217, 255, 0.3);
        }
        
        .toast.warning {
            background: rgba(255, 159, 10, 0.15);
            border: 1px solid rgba(255, 159, 10, 0.3);
        }
        
        .toast-icon {
            width: 24px;
            height: 24px;
            flex-shrink: 0;
        }
        
        .toast-content {
            flex: 1;
        }
        
        .toast-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 2px;
        }
        
        .toast-message {
            font-size: 13px;
            color: rgba(242, 242, 247, 0.8);
        }
        
        .toast-close {
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.2s;
            padding: 4px;
        }
        
        .toast-close:hover {
            opacity: 1;
        }
        
        /* Modern Modal System */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.75);
            backdrop-filter: blur(8px);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .modal-overlay.active {
            display: flex;
            opacity: 1;
        }
        
        .modal {
            background: rgba(28, 28, 30, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            transform: scale(0.9) translateY(20px);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .modal-overlay.active .modal {
            transform: scale(1) translateY(0);
        }
        
        .modal-header {
            padding: 24px 24px 16px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .modal-title {
            font-size: 20px;
            font-weight: 700;
            color: white;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .modal-close {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            border: none;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .modal-body {
            padding: 24px;
        }
        
        .modal-footer {
            padding: 16px 24px 24px;
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }
        
        .modal-input {
            width: 100%;
            padding: 12px 16px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            font-size: 15px;
            outline: none;
            transition: all 0.2s;
        }
        
        .modal-input:focus {
            border-color: var(--color-accent);
            background: rgba(0, 0, 0, 0.4);
        }
        
        .modal-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.8);
            margin-bottom: 8px;
        }
        
        .modal-description {
            font-size: 14px;
            color: rgba(255, 255, 255, 0.6);
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .modal-btn {
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .modal-btn-primary {
            background: linear-gradient(135deg, var(--color-accent), #00D9FF);
            color: black;
            box-shadow: 0 4px 15px rgba(50, 215, 75, 0.3);
        }
        
        .modal-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(50, 215, 75, 0.4);
        }
        
        .modal-btn-secondary {
            background: rgba(255, 255, 255, 0.05);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .modal-btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .modal-btn-danger {
            background: linear-gradient(135deg, #FF453A, #FF6B58);
            color: white;
            box-shadow: 0 4px 15px rgba(255, 69, 58, 0.3);
        }
        
        .modal-btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 69, 58, 0.4);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group:last-child {
            margin-bottom: 0;
        }
        
        /* Custom Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            z-index: 9998;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }
        
        .modal-overlay.show {
            opacity: 1;
            pointer-events: all;
        }
        
        .modal {
            background: rgba(28, 28, 30, 0.95);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 32px;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            transform: scale(0.9);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .modal::-webkit-scrollbar {
            width: 8px;
        }
        
        .modal::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }
        
        .modal::-webkit-scrollbar-thumb {
            background: var(--color-accent);
            border-radius: 4px;
        }
        
        .modal::-webkit-scrollbar-thumb:hover {
            background: #3DE956;
        }
        
        .modal-overlay.show .modal {
            transform: scale(1);
        }
        
        .modal-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-icon.success {
            background: rgba(50, 215, 75, 0.2);
        }
        
        .modal-icon.error {
            background: rgba(255, 107, 107, 0.2);
        }
        
        .modal-icon.info {
            background: rgba(0, 217, 255, 0.2);
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: 700;
            text-align: center;
            margin-bottom: 12px;
        }
        
        .modal-message {
            text-align: center;
            color: rgba(242, 242, 247, 0.8);
            margin-bottom: 24px;
            line-height: 1.5;
        }
        
        .modal-buttons {
            display: flex;
            gap: 12px;
        }
        
        .modal-button {
            flex: 1;
            padding: 12px 24px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
            font-size: 14px;
        }
        
        .modal-button.primary {
            background: var(--color-accent);
            color: black;
        }
        
        .modal-button.primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(50, 215, 75, 0.3);
        }
        
        .modal-button.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .modal-button.secondary:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        /* Scrollable response area */
        .overflow-y-auto::-webkit-scrollbar {
            width: 8px;
        }
        
        .overflow-y-auto::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }
        
        .overflow-y-auto::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #14b8a6 0%, #06b6d4 100%);
            border-radius: 10px;
        }
        
        .overflow-y-auto::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #28a93e 0%, #00b8d9 100%);
        }
        
        /* Smooth scrolling */
        .overflow-y-auto {
            scroll-behavior: smooth;
        }
        
        @keyframes confetti {
            0% { transform: translateY(0) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }
        
        /* Confetti particle styles */
        .confetti-particle {
            position: fixed;
            width: 10px;
            height: 10px;
            z-index: 10000;
            pointer-events: none;
            animation: confetti 3s ease-out forwards;
        }
        
        /* Goal completion celebration */
        .goal-celebration {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 9999;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 3rem;
            border-radius: 2rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8);
            text-align: center;
            animation: celebrationPop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        @keyframes celebrationPop {
            0% { transform: translate(-50%, -50%) scale(0); }
            50% { transform: translate(-50%, -50%) scale(1.1); }
            100% { transform: translate(-50%, -50%) scale(1); }
        }
        
        /* Enhanced Goal Completion Checkmark with Animation */
        .checkmark-container {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-left: 8px;
        }
        
        .goal-completed-checkmark {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #14b8a6 0%, #06b6d4 100%);
            width: 28px;
            height: 28px;
            border-radius: 50%;
            position: relative;
            animation: checkmarkPop 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            box-shadow: 0 4px 12px rgba(50, 215, 75, 0.4);
        }
        
        .goal-completed-checkmark::before {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: 50%;
            background: linear-gradient(135deg, #14b8a6 0%, #06b6d4 100%);
            animation: checkmarkRipple 1s ease-out;
            opacity: 0;
        }
        
        .goal-completed-checkmark::after {
            content: "âœ“";
            color: white;
            font-size: 16px;
            font-weight: 900;
            animation: checkmarkCheck 0.4s ease-in-out 0.2s both;
        }
        
        @keyframes checkmarkPop {
            0% {
                transform: scale(0) rotate(-180deg);
                opacity: 0;
            }
            60% {
                transform: scale(1.2) rotate(10deg);
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }
        
        @keyframes checkmarkCheck {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            50% {
                transform: scale(1.3);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        @keyframes checkmarkRipple {
            0% {
                transform: scale(1);
                opacity: 0.6;
            }
            100% {
                transform: scale(2.5);
                opacity: 0;
            }
        }
        
        /* Goal Card Completion State */
        .goal-card.completed {
            animation: goalCompleteShake 0.5s ease-in-out;
            border-color: rgba(50, 215, 75, 0.5) !important;
        }
        
        @keyframes goalCompleteShake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        /* Quick Action Button Gradient Effect */
        .quick-action-gradient {
            background: linear-gradient(135deg, rgba(50, 215, 75, 0.1), rgba(0, 217, 255, 0.1));
            filter: blur(20px);
        }
        
        .quick-action-btn:hover .quick-action-gradient {
            animation: quickActionPulse 2s ease-in-out infinite;
        }
        
        @keyframes quickActionPulse {
            0%, 100% {
                opacity: 0.3;
                transform: scale(1);
            }
            50% {
                opacity: 0.6;
                transform: scale(1.05);
            }
        }
        
        /* Loading Spinner Animation */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .animate-spin {
            animation: spin 1s linear infinite;
        }
        
        /* ===== SIDEBAR REMOVED - NOW USING FIXED NAVBAR ===== */
        
        /* Hide sidebar completely */
        #sidebar {
            display: none !important;
            box-shadow: 4px 0 40px rgba(0, 0, 0, 0.6), inset -1px 0 0 rgba(50, 215, 75, 0.1);
        }
        
        /* Premium Navigation Links */
        /* Premium Navigation Link Styling */
        .nav-link {
            display: flex;
            align-items: center;
            padding: 0.875rem 1rem;
            border-radius: 14px;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            width: 100%;
            overflow: hidden;
            color: rgba(242, 242, 247, 0.9);
        }
        
        .nav-link::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, rgba(50, 215, 75, 0.1), rgba(0, 217, 255, 0.1));
            opacity: 0;
            transition: opacity 0.3s ease;
            border-radius: 14px;
        }
        
        .nav-link:hover::before {
            opacity: 1;
        }
        
        .nav-link:hover {
            background: rgba(50, 215, 75, 0.08);
            transform: translateX(4px);
            box-shadow: inset 4px 0 0 var(--color-accent);
            color: rgba(255, 255, 255, 1);
        }
        
        .nav-link.active {
            background: linear-gradient(135deg, rgba(50, 215, 75, 0.15), rgba(0, 217, 255, 0.1));
            border: 1px solid rgba(50, 215, 75, 0.3);
            box-shadow: 
                0 4px 12px rgba(50, 215, 75, 0.25),
                inset 0 1px 0 rgba(255, 255, 255, 0.1),
                inset 4px 0 0 var(--color-accent);
            transform: translateX(6px) scale(1.02);
            color: rgba(255, 255, 255, 1);
        }
        
        .nav-link.active::after {
            content: '';
            position: absolute;
            right: 8px;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--color-accent);
            box-shadow: 0 0 10px rgba(50, 215, 75, 0.8);
            animation: pulse-dot 2s ease-in-out infinite;
        }
        
        @keyframes pulse-dot {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.2); }
        }
        
        .nav-link.active .nav-icon-wrapper {
            background: var(--color-accent) !important;
            box-shadow: 0 4px 12px rgba(50, 215, 75, 0.4);
        }
        
        .nav-link.active .nav-icon-wrapper i {
            color: black !important;
        }
        
        .nav-icon-wrapper {
            width: 42px;
            height: 42px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 0.75rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }
        
        .nav-link:hover .nav-icon-wrapper {
            transform: scale(1.1) rotate(3deg);
        }
        
        /* Pulsing Glow for Avatar */
        .avatar-glow {
            position: relative;
        }
        
        .avatar-glow::before {
            content: '';
            position: absolute;
            inset: -4px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--color-accent), #00D9FF);
            opacity: 0.5;
            filter: blur(8px);
            animation: avatarPulse 3s ease-in-out infinite;
        }
        
        @keyframes avatarPulse {
            0%, 100% {
                opacity: 0.3;
                transform: scale(1);
            }
            50% {
                opacity: 0.6;
                transform: scale(1.1);
            }
        }
        
        /* Enhanced Profile Card Glow */
        .profile-card-glow {
            position: relative;
            background: linear-gradient(135deg, rgba(50, 215, 75, 0.08), rgba(0, 217, 255, 0.05));
            border: 1px solid rgba(50, 215, 75, 0.2);
            box-shadow: 
                0 8px 24px rgba(50, 215, 75, 0.1),
                inset 0 1px 0 rgba(255, 255, 255, 0.05);
        }
        
        .profile-card-glow::before {
            content: '';
            position: absolute;
            inset: -1px;
            border-radius: inherit;
            padding: 1px;
            background: linear-gradient(135deg, rgba(50, 215, 75, 0.4), rgba(0, 217, 255, 0.2));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude;
            opacity: 0;
            animation: cardGlowPulse 4s ease-in-out infinite;
        }
        
        @keyframes cardGlowPulse {
            0%, 100% {
                opacity: 0.3;
            }
            50% {
                opacity: 0.7;
            }
        }
        
        /* Enhanced Logo Gradient */
        .animated-gradient {
            background: linear-gradient(135deg, #32D74B 0%, #00FFF5 50%, #BF00FF 100%);
            background-size: 200% 200%;
            animation: gradientShift 4s ease-in-out infinite;
            box-shadow: 0 8px 24px rgba(50, 215, 75, 0.4);
        }
        
        @keyframes gradientShift {
            0%, 100% {
                background-position: 0% 50%;
            }
            50% {
                background-position: 100% 50%;
            }
        }
        
        .brand-text-glow {
            font-weight: 900 !important;
            letter-spacing: -0.02em;
            background: linear-gradient(135deg, #32D74B, #00FFF5);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 2px 8px rgba(50, 215, 75, 0.5));
        }
        
        /* ===== LANDING PAGE REDESIGN (DARK AESTHETIC) ===== */
        
        /* Dark Landing Container - Matches Dashboard */
        .landing-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            position: relative;
            overflow: hidden;
        }
        
        .landing-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: url('https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=1920&h=1080&fit=crop&auto=format');
            background-size: cover;
            background-position: center;
            opacity: 0.15;
            z-index: 0;
        }
        
        .landing-container::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at top right, rgba(50, 215, 75, 0.1), transparent 50%),
                        radial-gradient(circle at bottom left, rgba(0, 217, 255, 0.1), transparent 50%);
            z-index: 0;
        }
        
        .landing-content {
            position: relative;
            z-index: 1;
            max-width: 1280px;
            margin: 0 auto;
            padding: 4rem 2rem;
        }
        
        /* Hero Two-Column Layout */
        .hero-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            align-items: center;
            min-height: 80vh;
        }
        
        @media (max-width: 968px) {
            .hero-grid {
                grid-template-columns: 1fr;
                gap: 3rem;
                min-height: auto;
            }
        }
        
        /* Left Column - Value Proposition */
        .hero-value {
            color: rgba(242, 242, 247, 0.95);
        }
        
        .hero-headline {
            font-size: 3.5rem;
            font-weight: 900;
            line-height: 1.1;
            margin-bottom: 1.5rem;
            color: rgba(242, 242, 247, 1);
            letter-spacing: -0.02em;
            text-shadow: 0 2px 20px rgba(0, 0, 0, 0.5);
        }
        
        .hero-headline .highlight {
            background: linear-gradient(135deg, #32D74B, #00D9FF);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            filter: drop-shadow(0 2px 8px rgba(50, 215, 75, 0.5));
        }
        
        .hero-description {
            font-size: 1.25rem;
            line-height: 1.6;
            color: rgba(174, 174, 178, 0.9);
            margin-bottom: 2rem;
        }
        
        .hero-features {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        .feature-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.25rem;
            background: rgba(28, 28, 30, 0.6);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .feature-item:hover {
            transform: translateX(8px) translateY(-2px);
            background: rgba(28, 28, 30, 0.8);
            border-color: rgba(50, 215, 75, 0.3);
            box-shadow: 0 12px 32px rgba(50, 215, 75, 0.2);
        }
        
        .feature-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, #32D74B, #00D9FF);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .feature-text {
            flex: 1;
        }
        
        .feature-text h3 {
            font-size: 1.1rem;
            font-weight: 700;
            color: rgba(242, 242, 247, 1);
            margin-bottom: 0.25rem;
        }
        
        .feature-text p {
            font-size: 0.9rem;
            color: rgba(174, 174, 178, 0.8);
        }
        
        /* Right Column - Form - Glass Morphism */
        .hero-form-container {
            background: rgba(28, 28, 30, 0.8);
            backdrop-filter: blur(30px) saturate(180%);
            padding: 3rem;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }
        
        .form-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            background: rgba(17, 17, 17, 0.8);
            padding: 0.5rem;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .form-tab {
            flex: 1;
            padding: 0.75rem 1.5rem;
            border: none;
            background: transparent;
            border-radius: 8px;
            font-weight: 600;
            color: rgba(174, 174, 178, 0.8);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .form-tab.active {
            background: linear-gradient(135deg, rgba(50, 215, 75, 0.15), rgba(0, 217, 255, 0.1));
            color: #32D74B;
            border: 1px solid rgba(50, 215, 75, 0.3);
            box-shadow: 0 4px 12px rgba(50, 215, 75, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.1);
        }
        
        .form-tab:hover:not(.active) {
            background: rgba(50, 215, 75, 0.08);
            color: rgba(50, 215, 75, 0.9);
        }
        
        .landing-form-group {
            margin-bottom: 1.5rem;
        }
        
        .landing-form-group label {
            display: block;
            font-size: 0.875rem;
            font-weight: 600;
            color: rgba(174, 174, 178, 1);
            margin-bottom: 0.5rem;
        }
        
        .landing-form-group input {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            font-size: 1rem;
            color: rgba(242, 242, 247, 1);
            background: rgba(17, 17, 17, 0.6);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .landing-form-group input::placeholder {
            color: rgba(174, 174, 178, 0.5);
        }
        
        .landing-form-group input:focus {
            outline: none;
            border-color: #32D74B;
            background: rgba(17, 17, 17, 0.9);
            box-shadow: 0 0 0 4px rgba(50, 215, 75, 0.15);
        }
        
        .landing-cta-button {
            width: 100%;
            padding: 1rem 2rem;
            background: linear-gradient(135deg, #32D74B, #00D9FF);
            color: white;
            font-size: 1.125rem;
            font-weight: 700;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(50, 215, 75, 0.3);
        }
        
        .landing-cta-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(50, 215, 75, 0.4);
        }
        
        .landing-cta-button:active {
            transform: translateY(0);
        }
        
        /* Social Proof Section */
        .social-proof {
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .social-proof-stats {
            display: flex;
            justify-content: space-around;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-item .number {
            display: block;
            font-size: 1.75rem;
            font-weight: 900;
            background: linear-gradient(135deg, #32D74B, #00D9FF);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-item .label {
            display: block;
            font-size: 0.75rem;
            color: rgba(174, 174, 178, 0.8);
            margin-top: 0.25rem;
        }
        
        .testimonial {
            background: rgba(17, 17, 17, 0.6);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            border-radius: 12px;
            border-left: 4px solid #32D74B;
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .testimonial-text {
            font-size: 0.9rem;
            color: rgba(174, 174, 178, 0.9);
            font-style: italic;
            margin-bottom: 1rem;
            line-height: 1.6;
        }
        
        .testimonial-author {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .testimonial-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #32D74B, #00D9FF);
        }
        
        .testimonial-info .name {
            font-weight: 700;
            color: rgba(242, 242, 247, 1);
            font-size: 0.875rem;
        }
        
        .testimonial-info .title {
            font-size: 0.75rem;
            color: rgba(174, 174, 178, 0.7);
        }
        
        .form-footer {
            text-align: center;
            margin-top: 1.5rem;
            font-size: 0.875rem;
            color: rgba(174, 174, 178, 0.8);
        }
        
        .form-footer a {
            color: #32D74B;
            text-decoration: none;
            font-weight: 600;
        }
        
        .form-footer a:hover {
            text-decoration: underline;
        }
        
        /* Hide form based on active tab */
        .form-content {
            display: none;
        }
        
        .form-content.active {
            display: block;
        }
    </style>
</head>
<body class="bg-gray-900 text-white font-inter">
    <!-- Toast Notification Container -->
    <div id="toast-container" class="toast-container"></div>
    
    <!-- Modal Overlay -->
    <div id="modal-overlay" class="modal-overlay">
        <div class="modal" id="modal">
            <div id="modal-content"></div>
        </div>
    </div>
    
    <!-- Mobile Top Navigation -->
    <nav class="mobile-top-nav">
        <div class="mobile-brand">
            <div class="mobile-brand-icon">GF</div>
            <span class="mobile-brand-name">GetFit</span>
        </div>
        <button class="mobile-menu-toggle" onclick="toggleMobileMenu()" aria-label="Toggle Menu">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="3" y1="12" x2="21" y2="12"/>
                <line x1="3" y1="6" x2="21" y2="6"/>
                <line x1="3" y1="18" x2="21" y2="18"/>
            </svg>
        </button>
    </nav>

    <!-- Mobile Navigation Dropdown -->
    <div id="mobile-nav-dropdown" class="mobile-nav-dropdown">
        <a href="#" data-view="dashboard" onclick="event.preventDefault(); updateUIState('dashboard-view'); closeMobileMenu();" class="mobile-nav-item active">
            <svg class="mobile-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                <polyline points="9 22 9 12 15 12 15 22"/>
            </svg>
            <span>Dashboard</span>
        </a>
        
        <a href="#" data-view="workout" onclick="event.preventDefault(); updateUIState('workout-view'); closeMobileMenu();" class="mobile-nav-item">
            <svg class="mobile-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="7" cy="7" r="2"/>
                <circle cx="17" cy="7" r="2"/>
                <path d="M7 7l5 5.5 5-5.5M12 12.5V20"/>
            </svg>
            <span>Workouts</span>
        </a>
        
        <a href="#" data-view="nutrition" onclick="event.preventDefault(); updateUIState('nutrition-view'); closeMobileMenu();" class="mobile-nav-item">
            <svg class="mobile-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
            </svg>
            <span>Nutrition</span>
        </a>
        
        <a href="#" data-view="health" onclick="event.preventDefault(); updateUIState('health-view'); closeMobileMenu();" class="mobile-nav-item">
            <svg class="mobile-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
            </svg>
            <span>Health</span>
        </a>
        
        <a href="#" data-view="activity" onclick="event.preventDefault(); updateUIState('activity-view'); closeMobileMenu();" class="mobile-nav-item">
            <svg class="mobile-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                <circle cx="12" cy="10" r="3"/>
            </svg>
            <span>Activity</span>
        </a>
        
        <a href="#" data-view="social" onclick="event.preventDefault(); updateUIState('social-view'); closeMobileMenu();" class="mobile-nav-item">
            <svg class="mobile-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                <circle cx="9" cy="7" r="4"/>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75"/>
            </svg>
            <span>Social</span>
        </a>
        
        <a href="#" data-view="settings" onclick="event.preventDefault(); updateUIState('settings-view'); closeMobileMenu();" class="mobile-nav-item">
            <svg class="mobile-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="3"/>
                <path d="M12 1v6m0 6v6m8.66-13l-5.2 3m-3.46 2l-5.2 3m16.66 2h-6m-6 0H1m17.66 8l-5.2-3m-3.46-2l-5.2-3"/>
            </svg>
            <span>Settings</span>
        </a>
        
        <a href="#" onclick="event.preventDefault(); handleLogout(); closeMobileMenu();" class="mobile-nav-item" style="color: #FF453A;">
            <svg class="mobile-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                <polyline points="16 17 21 12 16 7"/>
                <line x1="21" y1="12" x2="9" y2="12"/>
            </svg>
            <span>Logout</span>
        </a>
    </div>
    
    <!-- App Container -->
    <div id="app-container" class="flex flex-col" style="min-height: 100vh; padding-top: 0;">
        <!-- Main Content Area -->
        <main id="main-content" class="flex-1 p-6 pt-0 overflow-y-auto transition-all duration-300" style="background: transparent; backdrop-filter: none; padding: 0;">
            <!-- Landing Page / Login View -->
            <div id="login-view" class="landing-container">
                <div class="landing-content">
                    <div class="hero-grid">
                        <!-- Left Column: Value Proposition -->
                        <div class="hero-value">
                
                            <h2 class="hero-headline">
                                Map Your Progress.<br>
                                <span class="highlight">Reach Your Peak.</span>
                            </h2>
                            
                            <p class="hero-description">
                                Transform your fitness journey with GPS tracking, personalized goal setting, and a supportive community. 
                                Your path to peak performance starts here.
                            </p>
                            
                            <div class="hero-features">
                                <div class="feature-item">
                                    <div class="feature-icon">
                                        <i data-lucide="map-pin" class="w-6 h-6 text-white"></i>
                                    </div>
                                    <div class="feature-text">
                                        <h3>GPS Activity Tracking</h3>
                                        <p>Track every run, walk, and workout with precision GPS mapping</p>
                                    </div>
                        </div>
                        
                                <div class="feature-item">
                                    <div class="feature-icon">
                                        <i data-lucide="target" class="w-6 h-6 text-white"></i>
                                    </div>
                                    <div class="feature-text">
                                        <h3>Smart Goal Setting</h3>
                                        <p>Set, track, and crush your fitness goals with AI-powered insights</p>
                                    </div>
                    </div>
                    
                                <div class="feature-item">
                                    <div class="feature-icon">
                                        <i data-lucide="users" class="w-6 h-6 text-white"></i>
                                    </div>
                                    <div class="feature-text">
                                        <h3>Community Challenges</h3>
                                        <p>Join millions achieving their goals together</p>
                                    </div>
                    </div>
                </div>
            </div>

                        <!-- Right Column: Get Started Form -->
                        <div class="hero-form-container">
                            <h2 style="font-size: 2rem; font-weight: 800; color: rgba(242, 242, 247, 1); margin-bottom: 0.5rem; text-align: center;">Get Started</h2>
                            <p style="color: rgba(174, 174, 178, 0.9); text-align: center; margin-bottom: 2rem;">Join the fitness revolution today</p>
                            
                            <!-- Form Tabs -->
                            <div class="form-tabs">
                                <button class="form-tab active" onclick="switchFormTab('signup')" id="tab-signup">Sign Up</button>
                                <button class="form-tab" onclick="switchFormTab('login')" id="tab-login">Log In</button>
                    </div>
                            
                            <!-- Sign Up Form -->
                            <div class="form-content active" id="form-signup">
                                <form onsubmit="handleSignup(event)">
                                    <div class="landing-form-group">
                                        <label>Full Name</label>
                                        <input type="text" id="signup-name" required placeholder="John Doe">
                </div>
                
                                    <div class="landing-form-group">
                                        <label>Email Address</label>
                                        <input type="email" id="signup-email" required placeholder="you@example.com">
                                    </div>
                                    
                                    <div class="landing-form-group">
                                        <label>Password</label>
                                        <input type="password" id="signup-password" required minlength="6" placeholder="Create a strong password">
                        </div>
                        
                                    <button type="submit" class="landing-cta-button">
                                        <i data-lucide="arrow-right" class="w-5 h-5 inline mr-2"></i>
                                        Start Your Journey
                                    </button>
                                </form>
                        </div>
                        
                            <!-- Log In Form -->
                            <div class="form-content" id="form-login">
                                <form onsubmit="handleLogin(event)">
                                    <div class="landing-form-group">
                                        <label>Email Address</label>
                                        <input type="email" id="login-email" required placeholder="you@example.com">
                        </div>
                        
                                    <div class="landing-form-group">
                                        <label>Password</label>
                                        <input type="password" id="login-password" required minlength="6" placeholder="Enter your password">
                                    </div>
                                    
                                    <button type="submit" class="landing-cta-button">
                                        <i data-lucide="log-in" class="w-5 h-5 inline mr-2"></i>
                                        Welcome Back
                        </button>
                    </form>
                            </div>
                            
                            <!-- Social Proof -->
                            <div class="social-proof">
                                <div class="social-proof-stats">
                                    <div class="stat-item">
                                        <span class="number">1M+</span>
                                        <span class="label">Active Users</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="number">50M+</span>
                                        <span class="label">Workouts Tracked</span>
                                    </div>
                                    <div class="stat-item">
                                        <span class="number">4.9â˜…</span>
                                        <span class="label">App Rating</span>
                                    </div>
                                </div>
                                
                                <div class="testimonial">
                                    <p class="testimonial-text">
                                        "GetFit transformed how I track my progress. The GPS mapping and goal insights are game-changers. 
                                        I've never been more motivated!"
                                    </p>
                                    <div class="testimonial-author">
                                        <div class="testimonial-avatar"></div>
                                        <div class="testimonial-info">
                                            <div class="name">Sarah Johnson</div>
                                            <div class="title">Marathon Runner â€¢ Los Angeles</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Signup View (Hidden - redirects to landing) -->
            <div id="signup-view" class="hidden"></div>

            <!-- Dashboard View -->
            <div id="dashboard-view" class="hidden">
                <!-- Header with Greeting -->
                <div class="mb-8">
                    <h1 class="text-3xl font-extrabold text-white mb-6">
                        Welcome back, <span id="dashboard-name" class="text-teal-400">User</span>! ðŸ‘‹
                    </h1>
                    <p class="text-gray-400">Let's crush your fitness goals today</p>
                </div>

                <!-- Stats Overview Grid -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-8">
                    <div class="stat-card cursor-pointer" onclick="showCaloriesDetail()">
                        <div class="stat-card-inner">
                            <div class="relative z-10">
                                <div class="flex items-center justify-between mb-2">
                                    <i data-lucide="flame" class="w-8 h-8 text-orange-500"></i>
                                    <span class="text-xs text-gray-400 uppercase tracking-wider">Today</span>
                                </div>
                                <p class="text-4xl font-bold text-teal-400" data-stat="calories">0</p>
                                <p class="text-xs text-gray-400 uppercase tracking-wider mt-1">Calories Burned</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card cursor-pointer" onclick="showStepsDetail()">
                        <div class="stat-card-inner">
                            <div class="relative z-10">
                                <div class="flex items-center justify-between mb-2">
                                    <i data-lucide="activity" class="w-8 h-8 text-blue-500"></i>
                                    <span class="text-xs text-gray-400 uppercase tracking-wider">Goal</span>
                                </div>
                                <p class="text-4xl font-bold text-teal-400" data-stat="steps">0</p>
                                <p class="text-xs text-gray-400 uppercase tracking-wider mt-1">Steps</p>
                                <div class="mt-3 h-2 bg-gray-700 rounded-full overflow-hidden">
                                    <div class="h-full bg-gradient-to-r from-teal-500 to-cyan-500 progress-bar" data-stat="steps-progress" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card cursor-pointer" onclick="showWorkoutsDetail()">
                        <div class="stat-card-inner">
                            <div class="relative z-10">
                                <div class="flex items-center justify-between mb-2">
                                    <i data-lucide="zap" class="w-8 h-8 text-yellow-500"></i>
                                    <span class="text-xs text-gray-400 uppercase tracking-wider">Total</span>
                                </div>
                                <p class="text-4xl font-bold text-teal-400" data-stat="workouts">0</p>
                                <p class="text-xs text-gray-400 uppercase tracking-wider mt-1">Workouts Done</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="stat-card cursor-pointer" onclick="showStreakDetail()">
                        <div class="stat-card-inner">
                            <div class="relative z-10">
                                <div class="flex items-center justify-between mb-2">
                                    <i data-lucide="target" class="w-8 h-8 text-purple-500"></i>
                                    <span class="text-xs text-gray-400 uppercase tracking-wider">Streak</span>
                                </div>
                                <p class="text-4xl font-bold text-teal-400" data-stat="streak">0</p>
                                <p class="text-xs text-gray-400 uppercase tracking-wider mt-1">Days Active</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Coach Card - Enhanced -->
                <div class="gradient-card p-6 rounded-2xl mb-8 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-teal-500/20 to-transparent rounded-full blur-3xl"></div>
                    <div class="relative z-10">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex items-center">
                                <div class="w-14 h-14 rounded-full bg-gradient-to-r from-yellow-400 to-orange-500 flex items-center justify-center mr-4 float-animation">
                                    <i data-lucide="sparkles" class="w-7 h-7 text-white"></i>
                                </div>
                                <div>
                                    <h3 class="text-xl font-bold">AI Coach Francine</h3>
                                    <p class="text-sm text-gray-400">Your Personal Fitness Assistant</p>
                                </div>
                            </div>
                            <span class="badge-glow px-3 py-1 rounded-full text-xs font-semibold bg-gradient-to-r from-teal-400 to-cyan-500">Online</span>
                        </div>
                        <div class="glass-card p-4 rounded-xl mb-4">
                            <p class="text-sm leading-relaxed">
                                "ðŸŽ¯ Great work! Your consistency this week is impressive! I'm here to answer any fitness or nutrition questions you have. Just ask!"
                            </p>
                        </div>
                        <button onclick="askFrancine()" class="btn-primary px-6 py-3 rounded-xl font-semibold bg-teal-600 hover:bg-teal-500 text-white flex items-center hover:scale-105 transition-all duration-150 hover:shadow-xl">
                            <i data-lucide="message-circle" class="w-4 h-4 mr-2"></i>
                            Ask Francine a Question
                        </button>
                    </div>
                </div>

                <!-- Daily Goals Grid - Redesigned Modern -->
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold flex items-center">
                    <i data-lucide="target" class="w-6 h-6 mr-2 text-green-500"></i>
                    Today's Goals
                    </h2>
                    <div class="flex items-center gap-3">
                        <span id="goals-completed-indicator" class="text-sm px-3 py-1 rounded-full bg-gray-800/50 border border-gray-700"></span>
                        <button onclick="testCelebration()" class="px-3 py-1 rounded-lg text-xs bg-purple-500/20 text-purple-400 hover:bg-purple-500/30 transition-all hover:scale-105" title="Test the celebration">
                        ðŸŽ‰ Test
                    </button>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <!-- Water Goal Card -->
                    <div id="goal-water" class="goal-card group relative overflow-hidden glass-card rounded-2xl transition-all duration-500">
                        <div class="absolute inset-0 bg-gradient-to-br from-blue-500/5 to-cyan-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        <div class="relative p-6">
                        <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center transition-transform duration-300 group-hover:scale-110 group-hover:rotate-3">
                                <i data-lucide="droplets" class="w-6 h-6 text-blue-400"></i>
                            </div>
                            <div class="text-right">
                                    <p class="text-2xl font-bold transition-colors group-hover:text-blue-300"><span id="water-current">1.5</span>L</p>
                                <p class="text-xs text-gray-400">of <span id="water-goal">2.5</span>L</p>
                            </div>
                        </div>
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="font-semibold">Water Intake</h3>
                                <span id="water-checkmark" class="checkmark-container"></span>
                        </div>
                            <div class="mb-4 h-2 bg-gray-700/50 rounded-full overflow-hidden backdrop-blur-sm">
                                <div id="water-progress" class="h-full bg-gradient-to-r from-teal-400 to-cyan-400 progress-bar transition-all duration-700 ease-out" style="width: 60%"></div>
                            </div>
                            <button onclick="document.querySelector('#add-water-btn').scrollIntoView({ behavior: 'smooth', block: 'center' }); document.querySelector('#add-water-btn').focus();" class="w-full py-3 rounded-xl bg-teal-600 hover:bg-teal-500 text-white font-semibold transition-all duration-150 hover:scale-105 hover:shadow-xl active:scale-95">
                            <i data-lucide="plus" class="w-4 h-4 inline mr-2"></i>
                            Log Water
                        </button>
                        </div>
                    </div>

                    <!-- Sleep Goal Card -->
                    <div id="goal-sleep" class="goal-card group relative overflow-hidden glass-card rounded-2xl transition-all duration-500">
                        <div class="absolute inset-0 bg-gradient-to-br from-purple-500/5 to-indigo-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        <div class="relative p-6">
                        <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 rounded-xl bg-purple-500/20 flex items-center justify-center transition-transform duration-300 group-hover:scale-110 group-hover:rotate-3">
                                <i data-lucide="moon" class="w-6 h-6 text-purple-400"></i>
                            </div>
                            <div class="text-right">
                                    <p class="text-2xl font-bold transition-colors group-hover:text-purple-300"><span id="sleep-current">7</span>h <span id="sleep-minutes">30</span>m</p>
                                <p class="text-xs text-gray-400">last night</p>
                            </div>
                        </div>
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="font-semibold">Sleep Quality</h3>
                                <span id="sleep-checkmark" class="checkmark-container"></span>
                            </div>
                            <div class="mb-4 flex items-center">
                            <span class="text-sm text-gray-400 mr-2">Quality:</span>
                                <div class="flex gap-1" id="sleep-stars">
                                    <i data-lucide="star" class="w-4 h-4 text-yellow-400 fill-yellow-400 transition-transform hover:scale-125"></i>
                                    <i data-lucide="star" class="w-4 h-4 text-yellow-400 fill-yellow-400 transition-transform hover:scale-125"></i>
                                    <i data-lucide="star" class="w-4 h-4 text-yellow-400 fill-yellow-400 transition-transform hover:scale-125"></i>
                                    <i data-lucide="star" class="w-4 h-4 text-yellow-400 fill-yellow-400 transition-transform hover:scale-125"></i>
                                    <i data-lucide="star" class="w-4 h-4 text-gray-600 transition-transform hover:scale-125"></i>
                            </div>
                        </div>
                            <button onclick="document.querySelector('#sleep-input').scrollIntoView({ behavior: 'smooth', block: 'center' }); document.querySelector('#sleep-input').focus();" class="w-full py-3 rounded-xl bg-teal-600 hover:bg-teal-500 text-white font-semibold transition-all duration-150 hover:scale-105 hover:shadow-xl active:scale-95">
                            <i data-lucide="plus" class="w-4 h-4 inline mr-2"></i>
                            Log Sleep
                        </button>
                        </div>
                    </div>

                    <!-- Steps Goal Card -->
                    <div id="goal-steps" class="goal-card group relative overflow-hidden glass-card rounded-2xl transition-all duration-500">
                        <div class="absolute inset-0 bg-gradient-to-br from-teal-500/5 to-emerald-500/5 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        <div class="relative p-6">
                        <div class="flex items-center justify-between mb-4">
                                <div class="w-12 h-12 rounded-xl bg-teal-500/20 flex items-center justify-center transition-transform duration-300 group-hover:scale-110 group-hover:rotate-3">
                                <i data-lucide="footprints" class="w-6 h-6 text-teal-400"></i>
                            </div>
                            <div class="text-right">
                                    <p class="text-2xl font-bold transition-colors group-hover:text-teal-300"><span id="steps-current">0</span></p>
                                <p class="text-xs text-gray-400">of <span id="steps-goal">10,000</span></p>
                            </div>
                        </div>
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="font-semibold">Steps Today</h3>
                                <span id="steps-checkmark" class="checkmark-container"></span>
                        </div>
                            <div class="mb-4 h-2 bg-gray-700/50 rounded-full overflow-hidden backdrop-blur-sm">
                                <div id="steps-goal-progress" class="h-full bg-gradient-to-r from-teal-400 to-emerald-400 progress-bar transition-all duration-700 ease-out" style="width: 0%"></div>
                            </div>
                            <button onclick="showView('health')" class="w-full py-3 rounded-xl bg-teal-600 hover:bg-teal-500 text-white font-semibold transition-all duration-150 hover:scale-105 hover:shadow-xl active:scale-95">
                            <i data-lucide="trending-up" class="w-4 h-4 inline mr-2"></i>
                            View Details
                        </button>
                        </div>
                    </div>
                </div>

                <!-- Quick Action Shortcuts - Redesigned Modern -->
                <h2 class="text-2xl font-bold mb-6 flex items-center">
                    <i data-lucide="zap" class="w-6 h-6 mr-2 text-yellow-500"></i>
                    Quick Actions
                </h2>
                
                <!-- Horizontal Scrolling Quick Actions -->
                <div class="relative mb-8">
                    <div class="flex gap-4 overflow-x-auto scrollbar-hide pb-4 scroll-smooth snap-x snap-mandatory">
                        <button onclick="showView('workout')" class="quick-action-btn group relative flex-shrink-0 w-40 snap-start">
                            <div class="quick-action-gradient absolute inset-0 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                            <div class="relative bg-gradient-to-br from-blue-500/10 to-blue-600/5 backdrop-blur-xl border border-blue-500/20 rounded-2xl p-6 text-center transition-all duration-300 group-hover:border-blue-400/40 group-hover:shadow-lg group-hover:shadow-blue-500/20 group-hover:-translate-y-1 group-active:translate-y-0 group-active:scale-95">
                                <div class="w-14 h-14 rounded-2xl bg-blue-500/20 flex items-center justify-center mx-auto mb-3 transition-transform duration-300 group-hover:scale-110 group-hover:rotate-3">
                                    <i data-lucide="dumbbell" class="w-7 h-7 text-blue-400 transition-colors group-hover:text-blue-300"></i>
                        </div>
                                <p class="font-semibold text-sm text-gray-200 group-hover:text-white transition-colors">Start Workout</p>
                                <div class="absolute top-2 right-2 w-2 h-2 bg-blue-400 rounded-full opacity-0 group-hover:opacity-100 animate-ping"></div>
                            </div>
                    </button>
                    
                        <button onclick="showView('nutrition')" class="quick-action-btn group relative flex-shrink-0 w-40 snap-start">
                            <div class="quick-action-gradient absolute inset-0 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                            <div class="relative bg-gradient-to-br from-orange-500/10 to-orange-600/5 backdrop-blur-xl border border-orange-500/20 rounded-2xl p-6 text-center transition-all duration-300 group-hover:border-orange-400/40 group-hover:shadow-lg group-hover:shadow-orange-500/20 group-hover:-translate-y-1 group-active:translate-y-0 group-active:scale-95">
                                <div class="w-14 h-14 rounded-2xl bg-orange-500/20 flex items-center justify-center mx-auto mb-3 transition-transform duration-300 group-hover:scale-110 group-hover:rotate-3">
                                    <i data-lucide="utensils" class="w-7 h-7 text-orange-400 transition-colors group-hover:text-orange-300"></i>
                        </div>
                                <p class="font-semibold text-sm text-gray-200 group-hover:text-white transition-colors">Log Meal</p>
                                <div class="absolute top-2 right-2 w-2 h-2 bg-orange-400 rounded-full opacity-0 group-hover:opacity-100 animate-ping"></div>
                            </div>
                    </button>
                    
                        <button onclick="showView('social')" class="quick-action-btn group relative flex-shrink-0 w-40 snap-start">
                            <div class="quick-action-gradient absolute inset-0 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                            <div class="relative bg-gradient-to-br from-purple-500/10 to-purple-600/5 backdrop-blur-xl border border-purple-500/20 rounded-2xl p-6 text-center transition-all duration-300 group-hover:border-purple-400/40 group-hover:shadow-lg group-hover:shadow-purple-500/20 group-hover:-translate-y-1 group-active:translate-y-0 group-active:scale-95">
                                <div class="w-14 h-14 rounded-2xl bg-purple-500/20 flex items-center justify-center mx-auto mb-3 transition-transform duration-300 group-hover:scale-110 group-hover:rotate-3">
                                    <i data-lucide="users" class="w-7 h-7 text-purple-400 transition-colors group-hover:text-purple-300"></i>
                        </div>
                                <p class="font-semibold text-sm text-gray-200 group-hover:text-white transition-colors">Find Friends</p>
                                <div class="absolute top-2 right-2 w-2 h-2 bg-purple-400 rounded-full opacity-0 group-hover:opacity-100 animate-ping"></div>
                            </div>
                    </button>
                    
                        <button onclick="showView('health')" class="quick-action-btn group relative flex-shrink-0 w-40 snap-start">
                            <div class="quick-action-gradient absolute inset-0 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                            <div class="relative bg-gradient-to-br from-red-500/10 to-red-600/5 backdrop-blur-xl border border-red-500/20 rounded-2xl p-6 text-center transition-all duration-300 group-hover:border-red-400/40 group-hover:shadow-lg group-hover:shadow-red-500/20 group-hover:-translate-y-1 group-active:translate-y-0 group-active:scale-95">
                                <div class="w-14 h-14 rounded-2xl bg-red-500/20 flex items-center justify-center mx-auto mb-3 transition-transform duration-300 group-hover:scale-110 group-hover:rotate-3">
                                    <i data-lucide="heart-pulse" class="w-7 h-7 text-red-400 transition-colors group-hover:text-red-300"></i>
                        </div>
                                <p class="font-semibold text-sm text-gray-200 group-hover:text-white transition-colors">Health Stats</p>
                                <div class="absolute top-2 right-2 w-2 h-2 bg-red-400 rounded-full opacity-0 group-hover:opacity-100 animate-ping"></div>
                            </div>
                    </button>
                    </div>
                    <!-- Scroll Indicator -->
                    <div class="absolute right-0 top-0 bottom-4 w-12 bg-gradient-to-l from-[#0A0A0A] to-transparent pointer-events-none"></div>
                </div>
            </div>

            <!-- Workout View -->
            <div id="workout-view" class="hidden">
                
                <!-- Active Timer View (Hidden by default, shown when workout starts) -->
                <div id="active-timer-view" class="hidden">
                    <!-- Back Button -->
                    <button onclick="exitActiveWorkout()" class="mb-4 px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-gray-700/50 transition text-gray-400 hover:text-white">
                        <i data-lucide="arrow-left" class="w-5 h-5"></i>
                        Back to Workouts
                    </button>
                    
                    <!-- Active Workout Name Display -->
                    <div class="mb-6 p-4 rounded-xl glass-card" style="background: rgba(28, 28, 30, 0.6); border: 1px solid rgba(50, 215, 75, 0.3);">
                        <h2 class="text-sm font-semibold text-gray-400 mb-1">ACTIVE WORKOUT</h2>
                        <h1 id="active-workout-name" class="text-3xl font-black" style="color: var(--color-accent);">Workout Session</h1>
                    </div>
                    
                    <!-- Workout Timer Section -->
                    <div class="mb-8 p-6 rounded-2xl glass-card" style="background: rgba(28, 28, 30, 0.9); border: 1px solid rgba(50, 215, 75, 0.2);">
                        <div class="text-center">
                            <h2 class="text-lg font-semibold mb-4 flex items-center justify-center gap-2" style="color: var(--color-accent);">
                                <i data-lucide="timer" class="w-5 h-5"></i>
                                Workout Timer
                            </h2>
                            
                            <!-- Digital Timer Display -->
                            <div id="workout-timer-display" class="text-7xl font-black mb-6 tracking-wider" style="color: var(--color-accent); text-shadow: 0 0 30px rgba(50, 215, 75, 0.5), 0 0 60px rgba(50, 215, 75, 0.3); font-family: 'Courier New', monospace;">
                                00:00:00
                            </div>
                            
                            <!-- Timer Control Buttons -->
                            <div class="flex gap-3 justify-center items-center flex-wrap">
                                <!-- Start Button (Initially Visible) -->
                                <button id="start-workout-timer-btn" 
                                        class="px-8 py-4 rounded-xl font-bold text-lg transition-all duration-150 hover:scale-105 hover:shadow-xl flex items-center gap-2 bg-teal-600 hover:bg-teal-500 text-white">
                                    <i data-lucide="play" class="w-5 h-5"></i>
                                    Start Timer
                                </button>
                                
                                <!-- Pause Button (Initially Hidden) -->
                                <button id="pause-workout-timer-btn" 
                                        class="hidden px-8 py-4 rounded-xl font-bold text-lg transition-all duration-300 hover:scale-105 border-2 flex items-center gap-2"
                                        style="background: rgba(255, 159, 10, 0.2); border-color: #FF9F0A; color: #FF9F0A;">
                                    <i data-lucide="pause" class="w-5 h-5"></i>
                                    Pause
                                </button>
                                
                                <!-- Reset Button (Initially Hidden) -->
                                <button id="reset-workout-timer-btn" 
                                        class="hidden px-6 py-4 rounded-xl font-bold text-lg transition-all duration-300 hover:scale-105 border-2 flex items-center gap-2"
                                        style="background: rgba(255, 69, 58, 0.2); border-color: #FF453A; color: #FF453A;">
                                    <i data-lucide="rotate-ccw" class="w-5 h-5"></i>
                                    Reset & Exit
                                </button>
                            </div>
                            
                            <!-- Timer Status Indicator -->
                            <div id="timer-status" class="mt-4 text-sm text-gray-400 font-medium">
                                Ready to start your workout
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Workout List View (Shown by default) -->
                <div id="workout-list-view">
                <h1 class="text-2xl font-bold mb-6">Workout Library</h1>

                <div class="flex space-x-4 mb-6 border-b border-gray-700">
                    <button onclick="setWorkoutTab('library')" class="workout-tab px-4 py-2 font-semibold border-b-2 border-green-500" style="color: var(--color-accent);">Library</button>
                    <button onclick="setWorkoutTab('my-routines')" class="workout-tab px-4 py-2 font-semibold text-gray-400">My Routines</button>
                    <button onclick="setWorkoutTab('history')" class="workout-tab px-4 py-2 font-semibold text-gray-400">History</button>
                </div>

                <!-- Library Tab -->
                <div id="workout-library-tab">
                    <!-- Browse Categories Section -->
                    <h2 class="text-xl font-bold mb-4">Browse Categories</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                        <div onclick="filterWorkouts('Strength')" class="p-6 rounded-xl cursor-pointer hover:scale-105 transition" style="background-color: var(--color-card);">
                            <div class="flex items-center mb-2">
                                <i data-lucide="dumbbell" class="w-6 h-6 mr-2" style="color: var(--color-accent);"></i>
                                <h3 class="font-bold text-lg">Strength Training</h3>
                            </div>
                            <p class="text-sm text-gray-400">30+ full routines available</p>
                            <p class="text-xs text-gray-500 mt-1">Build muscle & power</p>
                        </div>
                        
                        <div onclick="filterWorkouts('Cardio')" class="p-6 rounded-xl cursor-pointer hover:scale-105 transition" style="background-color: var(--color-card);">
                            <div class="flex items-center mb-2">
                                <i data-lucide="flame" class="w-6 h-6 mr-2 text-orange-400"></i>
                                <h3 class="font-bold text-lg">Cardio & HIIT</h3>
                            </div>
                            <p class="text-sm text-gray-400">18 fat-burning sessions</p>
                            <p class="text-xs text-gray-500 mt-1">Burn calories fast</p>
                        </div>
                        
                        <div onclick="filterWorkouts('Yoga')" class="p-6 rounded-xl cursor-pointer hover:scale-105 transition" style="background-color: var(--color-card);">
                            <div class="flex items-center mb-2">
                                <i data-lucide="wind" class="w-6 h-6 mr-2 text-blue-400"></i>
                                <h3 class="font-bold text-lg">Recovery & Stretch</h3>
                            </div>
                            <p class="text-sm text-gray-400">Focus on flexibility and core</p>
                            <p class="text-xs text-gray-500 mt-1">Rest & recover</p>
                        </div>
                    </div>

                    <!-- Filter Tabs -->
                    <h2 class="text-xl font-bold mb-4">All Workouts</h2>
                    <div class="flex space-x-2 mb-6 overflow-x-auto scrollbar-hide">
                        <button onclick="filterWorkouts('All')" class="workout-filter px-4 py-2 rounded-full text-black font-semibold" style="background-color: var(--color-accent);">All</button>
                        <button onclick="filterWorkouts('Beginner')" class="workout-filter px-4 py-2 rounded-full border border-gray-500 text-gray-300">Beginner</button>
                        <button onclick="filterWorkouts('Intermediate')" class="workout-filter px-4 py-2 rounded-full border border-gray-500 text-gray-300">Intermediate</button>
                        <button onclick="filterWorkouts('Advanced')" class="workout-filter px-4 py-2 rounded-full border border-gray-500 text-gray-300">Advanced</button>
                        <button onclick="filterWorkouts('Strength')" class="workout-filter px-4 py-2 rounded-full border border-gray-500 text-gray-300">Strength</button>
                        <button onclick="filterWorkouts('Yoga')" class="workout-filter px-4 py-2 rounded-full border border-gray-500 text-gray-300">Yoga</button>
                        <button onclick="filterWorkouts('Cardio')" class="workout-filter px-4 py-2 rounded-full border border-gray-500 text-gray-300">Cardio</button>
                    </div>

                    <div id="workout-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Workouts will be populated by JavaScript -->
                    </div>
                </div>

                <!-- My Routines Tab -->
                <div id="workout-routines-tab" class="hidden">
                    <div class="mb-4">
                        <button onclick="createNewRoutine()" class="px-6 py-2 rounded-lg text-black font-semibold" style="background-color: var(--color-accent);">
                            + Create New Routine
                        </button>
                    </div>
                    <div id="routines-list" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- Routines will be populated here -->
                    </div>
                </div>

                <!-- History Tab -->
                <div id="workout-history-tab" class="hidden">
                    <div id="history-list" class="space-y-4">
                        <!-- History will be populated here -->
                    </div>
                </div>
            </div>
                <!-- End Workout List View -->
            </div>
            <!-- End Workout View -->

            <!-- Nutrition View -->
            <div id="nutrition-view" class="hidden">
                <h1 class="text-2xl font-bold mb-6">Nutrition Tracker</h1>

                <!-- Goal Overview Dashboard -->
                <div id="nutrition-summary-display" class="mb-8">
                    <!-- Calories Remaining - Hero Card -->
                    <div class="p-8 rounded-2xl mb-6 glass-card relative overflow-hidden" style="background: linear-gradient(135deg, rgba(50, 215, 75, 0.1), rgba(0, 217, 255, 0.05)); border: 1px solid rgba(50, 215, 75, 0.2);">
                        <div class="absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-green-500/10 to-transparent rounded-full blur-3xl"></div>
                        <div class="relative z-10 text-center">
                            <h2 class="text-sm font-semibold text-gray-400 mb-2">CALORIES REMAINING</h2>
                            <p id="calories-remaining" class="text-6xl font-black mb-4" style="color: var(--color-accent); text-shadow: 0 0 30px rgba(50, 215, 75, 0.3);">
                                2000
                            </p>
                            <div class="flex justify-center items-center gap-8 text-sm">
                                <div>
                                    <p class="text-gray-400">Goal</p>
                                    <p id="calories-goal" class="text-xl font-bold text-white">2000</p>
                                </div>
                                <div class="text-gray-600 text-2xl">-</div>
                                <div>
                                    <p class="text-gray-400">Consumed</p>
                                    <p id="calories-consumed" class="text-xl font-bold text-orange-400">0</p>
                                </div>
                                <div class="text-gray-600 text-2xl">=</div>
                                <div>
                                    <p class="text-gray-400">Remaining</p>
                                    <p id="calories-remaining-small" class="text-xl font-bold" style="color: var(--color-accent);">2000</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Macros Progress -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                        <!-- Protein -->
                        <div class="p-6 rounded-xl glass-card" style="background: rgba(28, 28, 30, 0.8); border: 1px solid rgba(255, 204, 0, 0.2);">
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="text-sm font-bold text-yellow-400 uppercase tracking-wide">Protein</h3>
                                <i data-lucide="beef" class="w-5 h-5 text-yellow-400"></i>
                        </div>
                            <div class="mb-3">
                                <p class="text-3xl font-black text-white">
                                    <span id="protein-consumed">0</span>g
                                </p>
                                <p class="text-sm text-gray-400">of <span id="protein-goal">150</span>g</p>
                    </div>
                            <div class="w-full bg-gray-700 h-3 rounded-full overflow-hidden">
                                <div id="protein-progress-bar" class="h-3 rounded-full bg-gradient-to-r from-yellow-400 to-yellow-500 transition-all duration-500" style="width: 0%;"></div>
                            </div>
                            <p id="protein-remaining" class="text-xs text-gray-400 mt-2">150g remaining</p>
                </div>

                        <!-- Carbs -->
                        <div class="p-6 rounded-xl glass-card" style="background: rgba(28, 28, 30, 0.8); border: 1px solid rgba(0, 150, 255, 0.2);">
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="text-sm font-bold text-blue-400 uppercase tracking-wide">Carbs</h3>
                                <i data-lucide="wheat" class="w-5 h-5 text-blue-400"></i>
                        </div>
                            <div class="mb-3">
                                <p class="text-3xl font-black text-white">
                                    <span id="carbs-consumed">0</span>g
                                </p>
                                <p class="text-sm text-gray-400">of <span id="carbs-goal">200</span>g</p>
                    </div>
                            <div class="w-full bg-gray-700 h-3 rounded-full overflow-hidden">
                                <div id="carbs-progress-bar" class="h-3 rounded-full bg-gradient-to-r from-blue-400 to-blue-500 transition-all duration-500" style="width: 0%;"></div>
                        </div>
                            <p id="carbs-remaining" class="text-xs text-gray-400 mt-2">200g remaining</p>
                    </div>

                        <!-- Fat -->
                        <div class="p-6 rounded-xl glass-card" style="background: rgba(28, 28, 30, 0.8); border: 1px solid rgba(255, 69, 58, 0.2);">
                            <div class="flex items-center justify-between mb-3">
                                <h3 class="text-sm font-bold text-red-400 uppercase tracking-wide">Fat</h3>
                                <i data-lucide="droplet" class="w-5 h-5 text-red-400"></i>
                        </div>
                            <div class="mb-3">
                                <p class="text-3xl font-black text-white">
                                    <span id="fat-consumed">0</span>g
                                </p>
                                <p class="text-sm text-gray-400">of <span id="fat-goal">65</span>g</p>
                    </div>
                            <div class="w-full bg-gray-700 h-3 rounded-full overflow-hidden">
                                <div id="fat-progress-bar" class="h-3 rounded-full bg-gradient-to-r from-red-400 to-red-500 transition-all duration-500" style="width: 0%;"></div>
                            </div>
                            <p id="fat-remaining" class="text-xs text-gray-400 mt-2">65g remaining</p>
                        </div>
                    </div>
                </div>

                <!-- Food Logging Sections -->
                <div class="space-y-6">
                    <!-- Breakfast -->
                    <div class="p-6 rounded-xl glass-card" style="background: rgba(28, 28, 30, 0.6); border: 1px solid rgba(255, 159, 10, 0.2);">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <i data-lucide="sunrise" class="w-6 h-6 text-orange-400"></i>
                                <h2 class="text-xl font-bold">Breakfast</h2>
                            </div>
                            <button id="add-food-breakfast-btn" class="px-4 py-2 rounded-lg font-semibold text-sm transition-all hover:scale-105" style="background: rgba(255, 159, 10, 0.2); border: 1px solid rgba(255, 159, 10, 0.4); color: #FF9F0A;">
                                <i data-lucide="plus" class="w-4 h-4 inline mr-1"></i>
                                Add Food
                            </button>
                        </div>
                        <div id="breakfast-food-list" class="space-y-2">
                            <!-- Food items will be rendered here -->
                        </div>
                    </div>

                    <!-- Lunch -->
                    <div class="p-6 rounded-xl glass-card" style="background: rgba(28, 28, 30, 0.6); border: 1px solid rgba(50, 215, 75, 0.2);">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <i data-lucide="sun" class="w-6 h-6" style="color: var(--color-accent);"></i>
                                <h2 class="text-xl font-bold">Lunch</h2>
                            </div>
                            <button id="add-food-lunch-btn" class="px-4 py-2 rounded-lg font-semibold text-sm transition-all hover:scale-105" style="background: rgba(50, 215, 75, 0.2); border: 1px solid rgba(50, 215, 75, 0.4); color: var(--color-accent);">
                                <i data-lucide="plus" class="w-4 h-4 inline mr-1"></i>
                                Add Food
                            </button>
                        </div>
                        <div id="lunch-food-list" class="space-y-2">
                            <!-- Food items will be rendered here -->
                        </div>
                    </div>

                    <!-- Dinner -->
                    <div class="p-6 rounded-xl glass-card" style="background: rgba(28, 28, 30, 0.6); border: 1px solid rgba(0, 217, 255, 0.2);">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <i data-lucide="moon" class="w-6 h-6 text-blue-400"></i>
                                <h2 class="text-xl font-bold">Dinner</h2>
                            </div>
                            <button id="add-food-dinner-btn" class="px-4 py-2 rounded-lg font-semibold text-sm transition-all hover:scale-105" style="background: rgba(0, 217, 255, 0.2); border: 1px solid rgba(0, 217, 255, 0.4); color: #00D9FF;">
                                <i data-lucide="plus" class="w-4 h-4 inline mr-1"></i>
                                Add Food
                            </button>
                        </div>
                        <div id="dinner-food-list" class="space-y-2">
                            <!-- Food items will be rendered here -->
                        </div>
                    </div>

                    <!-- Snacks -->
                    <div class="p-6 rounded-xl glass-card" style="background: rgba(28, 28, 30, 0.6); border: 1px solid rgba(191, 90, 242, 0.2);">
                        <div class="flex items-center justify-between mb-4">
                            <div class="flex items-center gap-3">
                                <i data-lucide="cookie" class="w-6 h-6 text-purple-400"></i>
                                <h2 class="text-xl font-bold">Snacks</h2>
                            </div>
                            <button id="add-food-snacks-btn" class="px-4 py-2 rounded-lg font-semibold text-sm transition-all hover:scale-105" style="background: rgba(191, 90, 242, 0.2); border: 1px solid rgba(191, 90, 242, 0.4); color: #BF5AF2;">
                                <i data-lucide="plus" class="w-4 h-4 inline mr-1"></i>
                                Add Food
                            </button>
                        </div>
                        <div id="snacks-food-list" class="space-y-2">
                            <!-- Food items will be rendered here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Health View -->
            <div id="health-view" class="hidden">
                <h1 class="text-2xl font-bold mb-6">Health & Wellness</h1>

                <!-- Health Dashboard Container -->
                <div id="health-dashboard" class="mb-8">
                    <!-- Vital Metric Widgets Grid -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                        
                        <!-- Sleep Tracker Widget -->
                        <div id="sleep-widget" class="p-8 rounded-2xl glass-card relative overflow-hidden" style="background: linear-gradient(135deg, rgba(94, 92, 230, 0.1), rgba(87, 58, 240, 0.05)); border: 1px solid rgba(94, 92, 230, 0.3);">
                            <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-purple-500/20 to-transparent rounded-full blur-2xl"></div>
                            <div class="relative z-10">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-sm font-bold text-purple-400 uppercase tracking-wide">Sleep</h3>
                                    <i data-lucide="moon" class="w-6 h-6 text-purple-400"></i>
                                </div>
                                
                                <!-- Progress Ring -->
                                <div class="flex items-center justify-center mb-4">
                                    <div class="relative w-32 h-32">
                                        <svg class="transform -rotate-90 w-32 h-32">
                                            <circle cx="64" cy="64" r="56" stroke="rgba(94, 92, 230, 0.2)" stroke-width="8" fill="none"/>
                                            <circle id="sleep-progress-ring" cx="64" cy="64" r="56" stroke="#5E5CE6" stroke-width="8" fill="none"
                                                    stroke-dasharray="351.86" stroke-dashoffset="351.86" stroke-linecap="round"
                                                    style="transition: stroke-dashoffset 0.5s ease;"/>
                                        </svg>
                                        <div class="absolute inset-0 flex items-center justify-center">
                                            <div class="text-center">
                                                <p id="sleep-hours-display" class="text-3xl font-black text-white">0</p>
                                                <p class="text-xs text-gray-400">hours</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="text-center">
                                    <p class="text-sm text-gray-400">Goal: <span id="sleep-goal-display">8</span>h</p>
                                    <p id="sleep-status" class="text-xs text-purple-400 mt-2">Log your sleep</p>
                                </div>
                            </div>
                        </div>

                        <!-- Water Tracker Widget -->
                        <div id="water-widget" class="p-8 rounded-2xl glass-card relative overflow-hidden" style="background: linear-gradient(135deg, rgba(0, 217, 255, 0.1), rgba(0, 150, 255, 0.05)); border: 1px solid rgba(0, 217, 255, 0.3);">
                            <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-blue-400/20 to-transparent rounded-full blur-2xl"></div>
                            <div class="relative z-10">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-sm font-bold text-blue-400 uppercase tracking-wide">Water</h3>
                                    <i data-lucide="droplets" class="w-6 h-6 text-blue-400"></i>
                                </div>
                                
                                <!-- Vertical Water Fill Bar -->
                                <div class="flex items-center justify-center mb-4">
                                    <div class="relative w-20 h-40 bg-gray-800/50 rounded-full overflow-hidden border-2 border-blue-400/30">
                                        <div id="water-fill-bar" class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-blue-400 to-blue-300 rounded-full transition-all duration-500" style="height: 0%;">
                                            <div class="absolute inset-0 bg-gradient-to-t from-transparent via-white/20 to-transparent animate-pulse"></div>
                                        </div>
                                        <!-- Water Droplet Animation -->
                                        <div class="absolute top-2 left-1/2 transform -translate-x-1/2">
                                            <i data-lucide="droplet" class="w-4 h-4 text-blue-300 opacity-50"></i>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="text-center">
                                    <p class="text-3xl font-black text-white mb-1">
                                        <span id="water-count-display">0</span> / <span id="water-goal-display">8</span>
                                    </p>
                                    <p class="text-xs text-gray-400">glasses</p>
                                    <p id="water-status" class="text-xs text-blue-400 mt-2">Stay hydrated!</p>
                                </div>
                            </div>
                        </div>

                        <!-- Health Score Widget -->
                        <div id="score-widget" class="p-8 rounded-2xl glass-card relative overflow-hidden" style="background: linear-gradient(135deg, rgba(50, 215, 75, 0.1), rgba(0, 217, 255, 0.05)); border: 1px solid rgba(50, 215, 75, 0.3);">
                            <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-green-500/20 to-transparent rounded-full blur-2xl"></div>
                            <div class="relative z-10">
                                <div class="flex items-center justify-between mb-4">
                                    <h3 class="text-sm font-bold text-green-400 uppercase tracking-wide">Health Score</h3>
                                    <i data-lucide="heart-pulse" class="w-6 h-6 text-green-400"></i>
                                </div>
                                
                                <!-- Large Score Display -->
                                <div class="text-center mb-6">
                                    <p id="health-score-display" class="text-7xl font-black mb-2" style="color: var(--color-accent); text-shadow: 0 0 30px rgba(50, 215, 75, 0.4);">
                                        0
                                    </p>
                                    <p class="text-xs text-gray-400">out of 100</p>
                                </div>
                                
                                <div class="text-center">
                                    <p id="health-score-label" class="text-lg font-bold text-gray-400 mb-2">Getting Started</p>
                                    <div class="w-full bg-gray-700 h-2 rounded-full overflow-hidden">
                                        <div id="health-score-bar" class="h-2 rounded-full bg-gradient-to-r from-teal-400 to-teal-500 transition-all duration-500" style="width: 0%;"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Logging Controls -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Sleep Logging Control -->
                        <div class="p-6 rounded-xl glass-card" style="background: rgba(28, 28, 30, 0.6); border: 1px solid rgba(94, 92, 230, 0.2);">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h3 class="text-lg font-bold mb-1">Log Sleep</h3>
                                    <p class="text-xs text-gray-400">Track your nightly rest</p>
                                </div>
                                <i data-lucide="bed" class="w-8 h-8 text-purple-400"></i>
                            </div>
                            <div class="flex gap-3 mb-3">
                                <button id="add-sleep-6h-btn" class="flex-1 px-4 py-3 rounded-lg font-bold transition-all hover:scale-105 flex items-center justify-center gap-2" style="background: linear-gradient(135deg, #5E5CE6, #8B5CF6); color: white; box-shadow: 0 4px 15px rgba(94, 92, 230, 0.3);">
                                    <i data-lucide="plus" class="w-5 h-5"></i>
                                    6 hrs
                                </button>
                                <button id="add-sleep-7h-btn" class="flex-1 px-4 py-3 rounded-lg font-bold transition-all hover:scale-105 flex items-center justify-center gap-2" style="background: linear-gradient(135deg, #5E5CE6, #8B5CF6); color: white; box-shadow: 0 4px 15px rgba(94, 92, 230, 0.3);">
                                    <i data-lucide="plus" class="w-5 h-5"></i>
                                    7 hrs
                                </button>
                                <button id="add-sleep-8h-btn" class="flex-1 px-4 py-3 rounded-lg font-bold transition-all hover:scale-105 flex items-center justify-center gap-2" style="background: linear-gradient(135deg, #5E5CE6, #8B5CF6); color: white; box-shadow: 0 4px 15px rgba(94, 92, 230, 0.3);">
                                    <i data-lucide="plus" class="w-5 h-5"></i>
                                    8 hrs
                                </button>
                            </div>
                            <div class="flex gap-3">
                                <input 
                                    type="number" 
                                    id="sleep-input" 
                                    placeholder="Custom hours (e.g., 7.5)" 
                                    step="0.5"
                                    min="0"
                                    max="24"
                                    class="flex-1 px-4 py-3 rounded-lg border border-purple-500/30 text-white font-semibold" 
                                    style="background: rgba(94, 92, 230, 0.1);">
                                <button id="log-sleep-btn" class="px-6 py-3 rounded-lg font-bold transition-all hover:scale-105" style="background: linear-gradient(135deg, #5E5CE6, #8B5CF6); color: white; box-shadow: 0 4px 15px rgba(94, 92, 230, 0.3);">
                                    <i data-lucide="check" class="w-5 h-5 inline"></i>
                                </button>
                                <button id="reset-sleep-btn" class="px-6 py-3 rounded-lg font-bold transition-all hover:scale-105 border-2" style="background: rgba(255, 69, 58, 0.1); border-color: #FF453A; color: #FF453A;">
                                    <i data-lucide="rotate-ccw" class="w-5 h-5"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Water Logging Control -->
                        <div class="p-6 rounded-xl glass-card" style="background: rgba(28, 28, 30, 0.6); border: 1px solid rgba(0, 217, 255, 0.2);">
                            <div class="flex items-center justify-between mb-4">
                                <div>
                                    <h3 class="text-lg font-bold mb-1">Log Water</h3>
                                    <p class="text-xs text-gray-400">Stay hydrated throughout the day</p>
                                </div>
                                <i data-lucide="cup-soda" class="w-8 h-8 text-blue-400"></i>
                            </div>
                            <div class="flex gap-3">
                                <button id="add-water-btn" class="flex-1 px-6 py-3 rounded-lg font-bold transition-all hover:scale-105 flex items-center justify-center gap-2" style="background: linear-gradient(135deg, #00D9FF, #0096FF); color: black; box-shadow: 0 4px 15px rgba(0, 217, 255, 0.3);">
                                    <i data-lucide="plus" class="w-5 h-5"></i>
                                    Add 1 Glass
                                </button>
                                <button id="reset-water-btn" class="px-6 py-3 rounded-lg font-bold transition-all hover:scale-105 border-2" style="background: rgba(255, 69, 58, 0.1); border-color: #FF453A; color: #FF453A;">
                                    <i data-lucide="rotate-ccw" class="w-5 h-5"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Social View -->
            <div id="social-view" class="hidden">
                <h1 class="text-2xl font-bold mb-6">Social & Community</h1>

                <!-- Quick Stats Row -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <!-- Friends Count -->
                    <div class="p-4 rounded-xl glass-card" style="background: linear-gradient(135deg, rgba(191, 90, 242, 0.1), rgba(94, 92, 230, 0.05)); border: 1px solid rgba(191, 90, 242, 0.3);">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs text-gray-400 mb-1">Friends</p>
                                <p class="text-2xl font-black" id="friends-count">0</p>
                            </div>
                            <i data-lucide="users" class="w-8 h-8 text-purple-400"></i>
                        </div>
                    </div>

                    <!-- Pending Requests -->
                    <div class="p-4 rounded-xl glass-card cursor-pointer hover:scale-105 transition-all" onclick="showFriendRequests()" style="background: linear-gradient(135deg, rgba(255, 159, 10, 0.1), rgba(255, 204, 0, 0.05)); border: 1px solid rgba(255, 159, 10, 0.3);">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs text-gray-400 mb-1">Pending Requests</p>
                                <p class="text-2xl font-black" id="pending-requests-count">0</p>
                            </div>
                            <i data-lucide="user-check" class="w-8 h-8 text-orange-400"></i>
                        </div>
                    </div>

                    <!-- Challenges -->
                    <div class="p-4 rounded-xl glass-card cursor-pointer hover:scale-105 transition-all" onclick="showChallenges()" style="background: linear-gradient(135deg, rgba(50, 215, 75, 0.1), rgba(0, 217, 255, 0.05)); border: 1px solid rgba(50, 215, 75, 0.3);">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-xs text-gray-400 mb-1">Active Challenges</p>
                                <p class="text-2xl font-black" id="active-challenges-count">0</p>
                            </div>
                            <i data-lucide="zap" class="w-8 h-8 text-teal-400"></i>
                        </div>
                    </div>
                </div>

                <!-- Two-Column Social Dashboard -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                    
                    <!-- Left Column: Friends List -->
                    <div class="p-8 rounded-2xl glass-card relative overflow-hidden" style="background: linear-gradient(135deg, rgba(191, 90, 242, 0.1), rgba(94, 92, 230, 0.05)); border: 1px solid rgba(191, 90, 242, 0.3);">
                        <div class="absolute top-0 right-0 w-48 h-48 bg-gradient-to-br from-purple-500/20 to-transparent rounded-full blur-3xl"></div>
                        <div class="relative z-10">
                            <!-- Header -->
                            <div class="flex items-center justify-between mb-6">
                                <div>
                                    <h2 class="text-2xl font-black mb-1">ðŸ‘¥ Your Friends</h2>
                                    <p class="text-xs text-gray-400">Manage your connections</p>
                                </div>
                                <button id="add-friend-btn" class="px-4 py-2 rounded-lg font-bold text-sm transition-all hover:scale-105" style="background: linear-gradient(135deg, #BF5AF2, #5E5CE6); color: white; box-shadow: 0 4px 15px rgba(191, 90, 242, 0.3);">
                                    <i data-lucide="user-plus" class="w-4 h-4 inline mr-1"></i>
                                    Add Friend
                                </button>
                            </div>

                            <!-- Friends List -->
                            <div id="friends-list" class="space-y-3 max-h-96 overflow-y-auto">
                                <!-- Friends will be dynamically rendered here -->
                                <div class="text-center py-12">
                                    <i data-lucide="users" class="w-12 h-12 mx-auto mb-2 text-gray-500"></i>
                                    <p class="text-gray-400 text-sm">No friends yet. Start connecting!</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Right Column: Activity Feed -->
                    <div class="p-8 rounded-2xl glass-card relative overflow-hidden" style="background: linear-gradient(135deg, rgba(50, 215, 75, 0.1), rgba(0, 217, 255, 0.05)); border: 1px solid rgba(50, 215, 75, 0.3);">
                        <div class="absolute top-0 right-0 w-48 h-48 bg-gradient-to-br from-teal-500/20 to-transparent rounded-full blur-3xl"></div>
                        <div class="relative z-10">
                            <!-- Header -->
                            <div class="flex items-center justify-between mb-6">
                                <div>
                                    <h2 class="text-2xl font-black mb-1">ðŸ’ª Activity Feed</h2>
                                    <p class="text-xs text-gray-400">See what your friends are up to</p>
                                </div>
                                <button onclick="shareActivity()" class="px-4 py-2 rounded-lg font-bold text-sm transition-all hover:scale-105" style="background: linear-gradient(135deg, #32D74B, #00D9FF); color: black; box-shadow: 0 4px 15px rgba(50, 215, 75, 0.3);">
                                    <i data-lucide="share-2" class="w-4 h-4 inline mr-1"></i>
                                    Share
                                </button>
                            </div>

                            <!-- Activity Feed List -->
                            <div id="activity-feed-list" class="space-y-3 max-h-96 overflow-y-auto">
                                <!-- Activity feed items will be dynamically rendered here -->
                                <div class="text-center py-12">
                                    <i data-lucide="activity" class="w-12 h-12 mx-auto mb-2 text-gray-500"></i>
                                    <p class="text-gray-400 text-sm">No activities yet. Be the first to share!</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Global Leaderboard -->
                <div class="p-8 rounded-2xl glass-card relative overflow-hidden mb-6" style="background: linear-gradient(135deg, rgba(255, 204, 0, 0.1), rgba(255, 159, 10, 0.05)); border: 1px solid rgba(255, 204, 0, 0.3);">
                    <div class="absolute top-0 right-0 w-48 h-48 bg-gradient-to-br from-yellow-500/20 to-transparent rounded-full blur-3xl"></div>
                    <div class="relative z-10">
                        <!-- Header -->
                        <div class="flex items-center justify-between mb-6">
                            <div>
                                <h2 class="text-2xl font-black mb-1">ðŸ† Global Leaderboard</h2>
                                <p class="text-xs text-gray-400">Top performers this month</p>
                            </div>
                            <div class="flex gap-2">
                                <select id="leaderboard-type" class="px-3 py-2 rounded-lg font-semibold text-sm" style="background: rgba(255, 204, 0, 0.1); border: 1px solid rgba(255, 204, 0, 0.3); color: white;">
                                    <option value="workouts">Workouts</option>
                                    <option value="calories">Calories</option>
                                    <option value="streak">Streak</option>
                                </select>
                            </div>
                        </div>

                        <!-- Leaderboard List -->
                        <div id="leaderboard-list" class="space-y-3">
                            <!-- Leaderboard items will be dynamically rendered here -->
                            <div class="text-center py-8">
                                <i data-lucide="loader" class="w-8 h-8 mx-auto mb-2 text-gray-400 animate-spin"></i>
                                <p class="text-gray-400 text-sm">Loading leaderboard...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings View -->
            <div id="settings-view" class="hidden" style="padding: 2rem; max-width: 1200px; margin: 0 auto;">
                <!-- Settings Header -->
                <div class="mb-8">
                    <h1 class="text-3xl font-black mb-2" style="background: linear-gradient(135deg, var(--color-accent), #00D9FF); -webkit-background-clip: text; background-clip: text; -webkit-text-fill-color: transparent;">Settings</h1>
                    <p class="text-gray-400">Manage your account, preferences, and app experience</p>
                </div>

                <!-- Settings Container -->
                <div class="space-y-4">
                    
                    <!-- 1. ACCOUNT & PROFILE -->
                    <div class="settings-section glass-card rounded-2xl overflow-hidden" style="background: rgba(28, 28, 30, 0.6); border: 1px solid rgba(50, 215, 75, 0.2);">
                        <div class="settings-section-header p-6" style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 rounded-full flex items-center justify-center" style="background: rgba(50, 215, 75, 0.2);">
                                        <i data-lucide="user" class="w-5 h-5" style="color: #32D74B;"></i>
                                    </div>
                                    <div>
                                        <h2 class="text-lg font-bold">Account & Profile</h2>
                                        <p class="text-xs text-gray-400">Personal information and security</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="settings-section-content p-6 space-y-4">
                            <!-- Profile Info Display -->
                            <div class="flex items-center gap-4 p-4 rounded-xl" style="background: rgba(0, 0, 0, 0.2);">
                                <div class="relative group">
                                    <div id="settings-avatar-container" class="w-16 h-16 rounded-full flex items-center justify-center overflow-hidden" style="background: linear-gradient(135deg, #32D74B, #00D9FF);">
                                        <span class="text-2xl font-black text-white" id="settings-avatar-initial">U</span>
                                        <img id="settings-avatar-img" src="" alt="Avatar" class="hidden w-full h-full object-cover">
                                    </div>
                                    <button onclick="changeAvatar()" class="absolute inset-0 w-16 h-16 rounded-full bg-black/50 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center cursor-pointer">
                                        <i data-lucide="camera" class="w-6 h-6 text-white"></i>
                                    </button>
                                    <input type="file" id="avatar-upload-input" accept="image/*" class="hidden">
                                </div>
                                <div class="flex-1">
                                    <p class="font-bold text-lg" id="settings-name-display">-</p>
                                    <p class="text-sm text-gray-400" id="settings-email-display">-</p>
                                    <button onclick="changeAvatar()" class="text-xs text-teal-400 hover:text-teal-300 mt-1">Change photo</button>
                                </div>
                            </div>
                            
                            <!-- Action Buttons -->
                            <button id="update-profile-btn" class="settings-item-btn w-full p-4 rounded-xl flex items-center justify-between hover:bg-white/5 transition-all">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="edit-3" class="w-5 h-5 text-teal-400"></i>
                                    <div class="text-left">
                                        <p class="font-semibold">Edit Profile & Biometrics</p>
                                        <p class="text-xs text-gray-400">Update your personal details</p>
                                    </div>
                                </div>
                                <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400"></i>
                            </button>
                            
                            <button class="settings-item-btn w-full p-4 rounded-xl flex items-center justify-between hover:bg-white/5 transition-all">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="shield" class="w-5 h-5 text-blue-400"></i>
                                    <div class="text-left">
                                        <p class="font-semibold">Change Password</p>
                                        <p class="text-xs text-gray-400">Update your security credentials</p>
                                    </div>
                                </div>
                                <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400"></i>
                            </button>
                            
                            <button class="settings-item-btn w-full p-4 rounded-xl flex items-center justify-between hover:bg-white/5 transition-all" style="background: rgba(255, 159, 10, 0.1); border: 1px solid rgba(255, 159, 10, 0.3);">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="crown" class="w-5 h-5 text-orange-400"></i>
                                    <div class="text-left">
                                        <p class="font-semibold text-orange-400">Upgrade to Premium</p>
                                        <p class="text-xs text-gray-400">Unlock advanced features & AI coaching</p>
                                    </div>
                                </div>
                                <i data-lucide="chevron-right" class="w-5 h-5 text-orange-400"></i>
                            </button>
                        </div>
                    </div>

                    <!-- 2. APP PREFERENCES -->
                    <div class="settings-section glass-card rounded-2xl overflow-hidden" style="background: rgba(28, 28, 30, 0.6); border: 1px solid rgba(94, 92, 230, 0.2);">
                        <div class="settings-section-header p-6" style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full flex items-center justify-center" style="background: rgba(94, 92, 230, 0.2);">
                                    <i data-lucide="sliders" class="w-5 h-5" style="color: #5E5CE6;"></i>
                                </div>
                                <div>
                                    <h2 class="text-lg font-bold">App Preferences</h2>
                                    <p class="text-xs text-gray-400">Customize your experience</p>
                                </div>
                            </div>
                        </div>
                        <div class="settings-section-content p-6 space-y-3">
                            <!-- Theme Selection -->
                            <div class="p-4 rounded-xl flex items-center justify-between" style="background: rgba(0, 0, 0, 0.2);">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="moon" class="w-5 h-5 text-purple-400"></i>
                                    <div>
                                        <p class="font-semibold">Theme</p>
                                        <p class="text-xs text-gray-400">Dark Mode â€¢ Light â€¢ System</p>
                                    </div>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="toggle-dark-mode" class="sr-only peer" checked>
                                    <div class="w-11 h-6 bg-gray-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-teal-600"></div>
                                </label>
                            </div>
                            
                            <!-- Units Selection -->
                            <div class="p-4 rounded-xl flex items-center justify-between" style="background: rgba(0, 0, 0, 0.2);">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="ruler" class="w-5 h-5 text-blue-400"></i>
                                    <div>
                                        <p class="font-semibold">Units of Measurement</p>
                                        <p class="text-xs text-gray-400">Metric (kg, cm) â€¢ Imperial (lbs, in)</p>
                                    </div>
                                </div>
                                <select class="bg-gray-700 border border-gray-600 rounded-lg px-3 py-1 text-sm font-semibold focus:outline-none focus:ring-2 focus:ring-teal-500">
                                    <option value="metric">Metric</option>
                                    <option value="imperial">Imperial</option>
                                </select>
                            </div>
                            
                            <!-- Notifications -->
                            <button class="settings-item-btn w-full p-4 rounded-xl flex items-center justify-between hover:bg-white/5 transition-all">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="bell" class="w-5 h-5 text-yellow-400"></i>
                                    <div class="text-left">
                                        <p class="font-semibold">Notification Settings</p>
                                        <p class="text-xs text-gray-400">Reminders, goals, and updates</p>
                                    </div>
                                </div>
                                <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400"></i>
                            </button>
                        </div>
                    </div>

                    <!-- 3. HEALTH DATA & SYNC -->
                    <div class="settings-section glass-card rounded-2xl overflow-hidden" style="background: rgba(28, 28, 30, 0.6); border: 1px solid rgba(0, 217, 255, 0.2);">
                        <div class="settings-section-header p-6" style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full flex items-center justify-center" style="background: rgba(0, 217, 255, 0.2);">
                                    <i data-lucide="activity" class="w-5 h-5" style="color: #00D9FF;"></i>
                                </div>
                                <div>
                                    <h2 class="text-lg font-bold">Health Data & Sync</h2>
                                    <p class="text-xs text-gray-400">Manage data sources and export</p>
                                </div>
                            </div>
                        </div>
                        <div class="settings-section-content p-6 space-y-3">
                            <!-- Data Sources -->
                            <button class="settings-item-btn w-full p-4 rounded-xl flex items-center justify-between hover:bg-white/5 transition-all">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="smartphone" class="w-5 h-5 text-green-400"></i>
                                    <div class="text-left">
                                        <p class="font-semibold">Apple Health Integration</p>
                                        <p class="text-xs text-green-400">â— Connected</p>
                                    </div>
                                </div>
                                <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400"></i>
                            </button>
                            
                            <button class="settings-item-btn w-full p-4 rounded-xl flex items-center justify-between hover:bg-white/5 transition-all">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="watch" class="w-5 h-5 text-gray-400"></i>
                                    <div class="text-left">
                                        <p class="font-semibold">Wearable Devices</p>
                                        <p class="text-xs text-gray-400">Not connected</p>
                                    </div>
                                </div>
                                <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400"></i>
                            </button>
                            
                            <!-- Goals Management -->
                            <div class="mt-4 pt-4" style="border-top: 1px solid rgba(255, 255, 255, 0.1);">
                                <button id="edit-goals-btn" class="settings-item-btn w-full p-4 rounded-xl flex items-center justify-between hover:bg-white/5 transition-all">
                                    <div class="flex items-center gap-3">
                                        <i data-lucide="target" class="w-5 h-5 text-orange-400"></i>
                                        <div class="text-left">
                                            <p class="font-semibold">Nutrition Goals</p>
                                            <p class="text-xs text-gray-400"><span id="settings-calories-goal">2000</span> kcal â€¢ <span id="settings-protein-goal">150</span>g protein</p>
                                        </div>
                                    </div>
                                    <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400"></i>
                                </button>
                                
                                <button id="edit-health-goals-btn" class="settings-item-btn w-full p-4 rounded-xl flex items-center justify-between hover:bg-white/5 transition-all">
                                    <div class="flex items-center gap-3">
                                        <i data-lucide="droplet" class="w-5 h-5 text-blue-400"></i>
                                        <div class="text-left">
                                            <p class="font-semibold">Health Goals</p>
                                            <p class="text-xs text-gray-400"><span id="settings-water-goal">8</span> glasses â€¢ <span id="settings-sleep-goal">8</span>h sleep</p>
                                        </div>
                                    </div>
                                    <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400"></i>
                                </button>
                            </div>
                            
                            <!-- Data Export -->
                            <div class="mt-4 pt-4" style="border-top: 1px solid rgba(255, 255, 255, 0.1);">
                                <button class="settings-item-btn w-full p-4 rounded-xl flex items-center justify-between hover:bg-white/5 transition-all">
                                    <div class="flex items-center gap-3">
                                        <i data-lucide="download" class="w-5 h-5 text-teal-400"></i>
                                        <div class="text-left">
                                            <p class="font-semibold">Export Health Data</p>
                                            <p class="text-xs text-gray-400">Download your complete history</p>
                                        </div>
                                    </div>
                                    <i data-lucide="chevron-right" class="w-5 h-5 text-gray-400"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 4. SMART & AI FEATURES (Premium/Future) -->
                    <div class="settings-section glass-card rounded-2xl overflow-hidden" style="background: rgba(28, 28, 30, 0.6); border: 1px solid rgba(255, 159, 10, 0.2);">
                        <div class="settings-section-header p-6" style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full flex items-center justify-center" style="background: rgba(255, 159, 10, 0.2);">
                                    <i data-lucide="sparkles" class="w-5 h-5" style="color: #FF9F0A;"></i>
                                </div>
                                <div>
                                    <h2 class="text-lg font-bold">Smart & AI Features</h2>
                                    <p class="text-xs text-gray-400">Personalized insights and coaching</p>
                                </div>
                            </div>
                        </div>
                        <div class="settings-section-content p-6 space-y-3">
                            <div class="p-4 rounded-xl flex items-center justify-between" style="background: rgba(0, 0, 0, 0.2);">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="brain" class="w-5 h-5 text-purple-400"></i>
                                    <div>
                                        <p class="font-semibold">AI Coaching</p>
                                        <p class="text-xs text-gray-400">Smart workout & meal suggestions</p>
                                    </div>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer opacity-50">
                                    <input type="checkbox" class="sr-only peer" disabled>
                                    <div class="w-11 h-6 bg-gray-700 rounded-full peer peer-checked:bg-teal-600"></div>
                                    <span class="ml-2 text-xs text-orange-400 font-bold">Premium</span>
                                </label>
                            </div>
                            
                            <div class="p-4 rounded-xl flex items-center justify-between" style="background: rgba(0, 0, 0, 0.2);">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="trending-up" class="w-5 h-5 text-green-400"></i>
                                    <div>
                                        <p class="font-semibold">Progress Insights</p>
                                        <p class="text-xs text-gray-400">Weekly AI-powered analysis</p>
                                    </div>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer opacity-50">
                                    <input type="checkbox" class="sr-only peer" disabled>
                                    <div class="w-11 h-6 bg-gray-700 rounded-full peer peer-checked:bg-teal-600"></div>
                                    <span class="ml-2 text-xs text-orange-400 font-bold">Premium</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- 5. SUPPORT & LEGAL -->
                    <div class="settings-section glass-card rounded-2xl overflow-hidden" style="background: rgba(28, 28, 30, 0.6); border: 1px solid rgba(255, 255, 255, 0.1);">
                        <div class="settings-section-header p-6" style="border-bottom: 1px solid rgba(255, 255, 255, 0.1);">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full flex items-center justify-center" style="background: rgba(255, 255, 255, 0.1);">
                                    <i data-lucide="help-circle" class="w-5 h-5 text-gray-400"></i>
                                </div>
                                <div>
                                    <h2 class="text-lg font-bold">Support & Legal</h2>
                                    <p class="text-xs text-gray-400">Help, policies, and information</p>
                                </div>
                            </div>
                        </div>
                        <div class="settings-section-content p-6 space-y-2">
                            <button class="settings-item-btn w-full p-3 rounded-xl flex items-center justify-between hover:bg-white/5 transition-all">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="book-open" class="w-4 h-4 text-gray-400"></i>
                                    <p class="font-semibold text-sm">Help Center & FAQ</p>
                                </div>
                                <i data-lucide="external-link" class="w-4 h-4 text-gray-400"></i>
                            </button>
                            
                            <button class="settings-item-btn w-full p-3 rounded-xl flex items-center justify-between hover:bg-white/5 transition-all">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="message-circle" class="w-4 h-4 text-gray-400"></i>
                                    <p class="font-semibold text-sm">Contact Support</p>
                                </div>
                                <i data-lucide="external-link" class="w-4 h-4 text-gray-400"></i>
                            </button>
                            
                            <div class="pt-2 mt-2" style="border-top: 1px solid rgba(255, 255, 255, 0.05);">
                                <button class="settings-item-btn w-full p-3 rounded-xl flex items-center justify-between hover:bg-white/5 transition-all">
                                    <div class="flex items-center gap-3">
                                        <i data-lucide="shield-check" class="w-4 h-4 text-gray-400"></i>
                                        <p class="text-sm text-gray-400">Privacy Policy</p>
                                    </div>
                                    <i data-lucide="external-link" class="w-4 h-4 text-gray-400"></i>
                                </button>
                                
                                <button class="settings-item-btn w-full p-3 rounded-xl flex items-center justify-between hover:bg-white/5 transition-all">
                                    <div class="flex items-center gap-3">
                                        <i data-lucide="file-text" class="w-4 h-4 text-gray-400"></i>
                                        <p class="text-sm text-gray-400">Terms of Service</p>
                                    </div>
                                    <i data-lucide="external-link" class="w-4 h-4 text-gray-400"></i>
                                </button>
                            </div>
                            
                            <div class="pt-3 text-center">
                                <p class="text-xs text-gray-500">Version 1.0.0</p>
                            </div>
                        </div>
                    </div>

                    <!-- 6. DANGER ZONE -->
                    <div class="settings-section glass-card rounded-2xl overflow-hidden" style="background: rgba(28, 28, 30, 0.6); border: 1px solid rgba(255, 69, 58, 0.3);">
                        <div class="settings-section-header p-6" style="border-bottom: 1px solid rgba(255, 69, 58, 0.2);">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full flex items-center justify-center" style="background: rgba(255, 69, 58, 0.2);">
                                    <i data-lucide="alert-triangle" class="w-5 h-5" style="color: #FF453A;"></i>
                                </div>
                                <div>
                                    <h2 class="text-lg font-bold text-red-400">Danger Zone</h2>
                                    <p class="text-xs text-gray-400">Irreversible actions</p>
                                </div>
                            </div>
                        </div>
                        <div class="settings-section-content p-6 space-y-3">
                            <button id="logout-btn" class="w-full p-4 rounded-xl font-bold transition-all hover:scale-[1.02] flex items-center justify-center gap-2" style="background: linear-gradient(135deg, #FF453A, #FF6B58); color: white; box-shadow: 0 4px 20px rgba(255, 69, 58, 0.3);">
                                <i data-lucide="log-out" class="w-5 h-5"></i>
                                Log Out
                            </button>
                            
                            <button class="w-full p-3 rounded-xl text-sm font-semibold transition-all hover:bg-red-500/10" style="color: #FF453A; border: 1px solid rgba(255, 69, 58, 0.3);">
                                Delete Account
                            </button>
                        </div>
                    </div>

                </div>
            </div>
        </main>
    </div>

    <script>
        // ===== Toast Notification System =====
        function showToast(title, message, type = 'success', duration = 3000) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: '<i data-lucide="check-circle" class="toast-icon" style="color: #32D74B;"></i>',
                error: '<i data-lucide="x-circle" class="toast-icon" style="color: #FF6B6B;"></i>',
                info: '<i data-lucide="info" class="toast-icon" style="color: #00D9FF;"></i>',
                warning: '<i data-lucide="alert-triangle" class="toast-icon" style="color: #FF9F0A;"></i>'
            };
            
            toast.innerHTML = `
                ${icons[type] || icons.info}
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    ${message ? `<div class="toast-message">${message}</div>` : ''}
                </div>
                <div class="toast-close" onclick="this.parentElement.remove()">
                    <i data-lucide="x" style="width: 16px; height: 16px;"></i>
                </div>
            `;
            
            container.appendChild(toast);
            setTimeout(() => window.createIcons?.(), 10);
            
            // Trigger animation
            setTimeout(() => toast.classList.add('show'), 10);
            
            // Auto remove
            if (duration > 0) {
                setTimeout(() => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                }, duration);
            }
            
            return toast;
        }
        
        // ===== Modal System =====
        function showModal(title, message, type = 'info', buttons = null) {
            return new Promise((resolve) => {
                const overlay = document.getElementById('modal-overlay');
                const modalContent = document.getElementById('modal-content');
                
                const icons = {
                    success: '<i data-lucide="check-circle" style="width: 32px; height: 32px; color: #32D74B;"></i>',
                    error: '<i data-lucide="x-circle" style="width: 32px; height: 32px; color: #FF6B6B;"></i>',
                    info: '<i data-lucide="info" style="width: 32px; height: 32px; color: #00D9FF;"></i>',
                    warning: '<i data-lucide="alert-triangle" style="width: 32px; height: 32px; color: #FF9F0A;"></i>'
                };
                
                // Default buttons
                if (!buttons) {
                    buttons = [{
                        text: 'Got it!',
                        primary: true,
                        action: () => resolve(true)
                    }];
                }
                
                const buttonsHtml = buttons.map((btn, index) => 
                    `<button class="modal-button ${btn.primary ? 'primary' : 'secondary'}" onclick="modalButtonClick(${index})">${btn.text}</button>`
                ).join('');
                
                modalContent.innerHTML = `
                    <div class="modal-icon ${type}">
                        ${icons[type] || icons.info}
                    </div>
                    <h2 class="modal-title">${title}</h2>
                    <p class="modal-message">${message}</p>
                    <div class="modal-buttons">
                        ${buttonsHtml}
                    </div>
                `;
                
                // Store button actions
                window.modalButtonActions = buttons.map(btn => btn.action);
                
                overlay.classList.add('show');
                setTimeout(() => window.createIcons?.(), 10);
                
                // Close on overlay click
                overlay.onclick = (e) => {
                    if (e.target === overlay) {
                        closeModal();
                        resolve(false);
                    }
                };
            });
        }
        
        function modalButtonClick(index) {
            if (window.modalButtonActions && window.modalButtonActions[index]) {
                window.modalButtonActions[index]();
            }
            closeModal();
        }
        
        function closeModal() {
            const overlay = document.getElementById('modal-overlay');
            overlay.classList.remove('show');
        }
        
        function showConfirm(title, message, confirmText = 'Confirm', cancelText = 'Cancel') {
            return new Promise((resolve) => {
                showModal(title, message, 'warning', [
                    {
                        text: cancelText,
                        primary: false,
                        action: () => resolve(false)
                    },
                    {
                        text: confirmText,
                        primary: true,
                        action: () => resolve(true)
                    }
                ]);
            });
        }
        
        /**
         * Show input prompt modal
         * @param {string} title - Modal title
         * @param {string} message - Prompt message
         * @param {string} defaultValue - Default input value
         * @param {string} placeholder - Input placeholder
         * @param {string} inputType - Input type (text, number, email, etc.)
         * @returns {Promise<string|null>} - Returns input value or null if cancelled
         */
        function showPrompt(title, message = '', defaultValue = '', placeholder = '', inputType = 'text') {
            return new Promise((resolve) => {
                const overlay = document.getElementById('modal-overlay');
                const modal = document.getElementById('modal');
                
                const inputId = 'modal-input-' + Date.now();
                
                modal.innerHTML = `
                    <div class="modal-header">
                        <div class="modal-title">
                            <i data-lucide="edit-3" style="width: 24px; height: 24px; color: var(--color-accent);"></i>
                            ${title}
                        </div>
                        <button class="modal-close" onclick="closeModal()">
                            <i data-lucide="x" style="width: 18px; height: 18px;"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        ${message ? `<p class="modal-description">${message}</p>` : ''}
                        <div class="form-group">
                            <input 
                                type="${inputType}" 
                                id="${inputId}" 
                                class="modal-input" 
                                value="${defaultValue}" 
                                placeholder="${placeholder}"
                                autofocus
                            />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="modal-btn modal-btn-secondary" onclick="closeModal(); window.modalResolve(null);">
                            Cancel
                        </button>
                        <button class="modal-btn modal-btn-primary" id="modal-confirm-btn">
                            <i data-lucide="check" style="width: 18px; height: 18px;"></i>
                            Confirm
                        </button>
                    </div>
                `;
                
                // Store resolve function globally for access
                window.modalResolve = resolve;
                
                // Show modal
                overlay.classList.add('active');
                setTimeout(() => window.createIcons?.(), 10);
                
                // Get input and button
                const input = document.getElementById(inputId);
                const confirmBtn = document.getElementById('modal-confirm-btn');
                
                // Focus input
                setTimeout(() => input.focus(), 100);
                
                // Handle confirm
                const handleConfirm = () => {
                    const value = input.value;
                    closeModal();
                    resolve(value);
                };
                
                confirmBtn.addEventListener('click', handleConfirm);
                
                // Handle Enter key
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        handleConfirm();
                    }
                });
                
                // Handle ESC key
                const handleEsc = (e) => {
                    if (e.key === 'Escape') {
                        closeModal();
                        resolve(null);
                        document.removeEventListener('keydown', handleEsc);
                    }
                };
                document.addEventListener('keydown', handleEsc);
                
                // Handle overlay click
                overlay.addEventListener('click', (e) => {
                    if (e.target === overlay) {
                        closeModal();
                        resolve(null);
                    }
                }, { once: true });
            });
        }
        
        /**
         * Show multi-input form modal
         * @param {string} title - Modal title
         * @param {Array} fields - Array of field objects {label, type, id, placeholder, defaultValue}
         * @returns {Promise<Object|null>} - Returns object with field values or null if cancelled
         */
        function showForm(title, fields = []) {
            return new Promise((resolve) => {
                const overlay = document.getElementById('modal-overlay');
                const modal = document.getElementById('modal');
                
                const fieldsHtml = fields.map((field, index) => `
                    <div class="form-group">
                        <label class="modal-label">${field.label}</label>
                        <input 
                            type="${field.type || 'text'}" 
                            id="modal-field-${index}" 
                            class="modal-input" 
                            value="${field.defaultValue || ''}" 
                            placeholder="${field.placeholder || ''}"
                            ${field.required ? 'required' : ''}
                            ${field.min !== undefined ? `min="${field.min}"` : ''}
                            ${field.max !== undefined ? `max="${field.max}"` : ''}
                            ${field.step !== undefined ? `step="${field.step}"` : ''}
                            ${index === 0 ? 'autofocus' : ''}
                        />
                    </div>
                `).join('');
                
                modal.innerHTML = `
                    <div class="modal-header">
                        <div class="modal-title">
                            <i data-lucide="edit-3" style="width: 24px; height: 24px; color: var(--color-accent);"></i>
                            ${title}
                        </div>
                        <button class="modal-close" onclick="closeModal()">
                            <i data-lucide="x" style="width: 18px; height: 18px;"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form id="modal-form">
                            ${fieldsHtml}
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="modal-btn modal-btn-secondary" onclick="closeModal(); window.modalResolve(null);">
                            Cancel
                        </button>
                        <button type="submit" class="modal-btn modal-btn-primary" id="modal-submit-btn">
                            <i data-lucide="check" style="width: 18px; height: 18px;"></i>
                            Save
                        </button>
                    </div>
                `;
                
                window.modalResolve = resolve;
                overlay.classList.add('active');
                setTimeout(() => window.createIcons?.(), 10);
                
                const form = document.getElementById('modal-form');
                const submitBtn = document.getElementById('modal-submit-btn');
                
                const handleSubmit = (e) => {
                    if (e) e.preventDefault();
                    
                    // Gather all field values
                    const values = {};
                    fields.forEach((field, index) => {
                        const input = document.getElementById(`modal-field-${index}`);
                        values[field.id] = input.type === 'number' ? parseFloat(input.value) : input.value;
                    });
                    
                    closeModal();
                    resolve(values);
                };
                
                form.addEventListener('submit', handleSubmit);
                submitBtn.addEventListener('click', () => form.requestSubmit());
                
                // Handle ESC key
                const handleEsc = (e) => {
                    if (e.key === 'Escape') {
                        closeModal();
                        resolve(null);
                        document.removeEventListener('keydown', handleEsc);
                    }
                };
                document.addEventListener('keydown', handleEsc);
            });
        }
        
        const workouts = [
            // Beginner Workouts
            {id: 1, name: 'Morning Yoga Flow', category: 'Yoga', level: 'Beginner', duration: 30, calories: 120, image: 'https://images.unsplash.com/photo-1506126613408-eca07ce68773?w=400&h=300&fit=crop'},
            {id: 2, name: 'Evening Stretch', category: 'Yoga', level: 'Beginner', duration: 15, calories: 50, image: 'https://images.unsplash.com/photo-1544367567-0f2fcb009e0b?w=400&h=300&fit=crop'},
            {id: 3, name: 'Light Cardio Walk', category: 'Cardio', level: 'Beginner', duration: 25, calories: 150, image: 'https://images.unsplash.com/photo-1538805060514-97d9cc17730c?w=400&h=300&fit=crop'},
            {id: 4, name: 'Gentle Body Weights', category: 'Strength', level: 'Beginner', duration: 20, calories: 130, image: 'https://images.unsplash.com/photo-1598971639058-fab3c3109a00?w=400&h=300&fit=crop'},
            {id: 5, name: 'Beginner Core', category: 'Strength', level: 'Beginner', duration: 15, calories: 90, image: 'https://images.unsplash.com/photo-1599058917212-d750089bc07e?w=400&h=300&fit=crop'},
            {id: 6, name: 'Easy Jog', category: 'Cardio', level: 'Beginner', duration: 30, calories: 200, image: 'https://images.unsplash.com/photo-1452626038306-9aae5e071dd3?w=400&h=300&fit=crop'},
            {id: 7, name: 'Yoga Basics', category: 'Yoga', level: 'Beginner', duration: 25, calories: 100, image: 'https://images.unsplash.com/photo-1508672019048-805c876b67e2?w=400&h=300&fit=crop'},
            
            // Intermediate Workouts
            {id: 8, name: 'Full Body Blast', category: 'Strength', level: 'Intermediate', duration: 45, calories: 400, image: 'https://images.unsplash.com/photo-1581009146145-b5ef050c2e1e?w=400&h=300&fit=crop'},
            {id: 9, name: 'Core Strength', category: 'Strength', level: 'Intermediate', duration: 25, calories: 180, image: 'https://images.unsplash.com/photo-1571019614242-c5c5dee9f50b?w=400&h=300&fit=crop'},
            {id: 10, name: 'Power Yoga', category: 'Yoga', level: 'Intermediate', duration: 40, calories: 220, image: 'https://images.unsplash.com/photo-1599901860904-17e6ed7083a0?w=400&h=300&fit=crop'},
            {id: 11, name: 'Cardio Kickboxing', category: 'Cardio', level: 'Intermediate', duration: 35, calories: 350, image: 'https://images.unsplash.com/photo-1549719386-74dfcbf7dbed?w=400&h=300&fit=crop'},
            {id: 12, name: 'Upper Body Power', category: 'Strength', level: 'Intermediate', duration: 40, calories: 320, image: 'https://images.unsplash.com/photo-1583454110551-21f2fa2afe61?w=400&h=300&fit=crop'},
            {id: 13, name: 'Lower Body Burn', category: 'Strength', level: 'Intermediate', duration: 35, calories: 290, image: 'https://images.unsplash.com/photo-1434682881908-b43d0467b798?w=400&h=300&fit=crop'},
            {id: 14, name: 'Interval Run', category: 'Cardio', level: 'Intermediate', duration: 30, calories: 320, image: 'https://images.unsplash.com/photo-1476480862126-209bfaa8edc8?w=400&h=300&fit=crop'},
            {id: 15, name: 'Vinyasa Flow', category: 'Yoga', level: 'Intermediate', duration: 45, calories: 240, image: 'https://images.unsplash.com/photo-1506126613408-eca07ce68773?w=400&h=300&fit=crop'},
            {id: 16, name: 'Cycling HIIT', category: 'Cardio', level: 'Intermediate', duration: 30, calories: 380, image: 'https://images.unsplash.com/photo-1541534741688-6078c6bfb5c5?w=400&h=300&fit=crop'},
            
            // Advanced Workouts
            {id: 17, name: 'HIIT Cardio Burn', category: 'Cardio', level: 'Advanced', duration: 20, calories: 300, image: 'https://images.unsplash.com/photo-1517836357463-d25dfeac3438?w=400&h=300&fit=crop'},
            {id: 18, name: 'Beast Mode Strength', category: 'Strength', level: 'Advanced', duration: 60, calories: 550, image: 'https://images.unsplash.com/photo-1605296867304-46d5465a13f1?w=400&h=300&fit=crop'},
            {id: 19, name: 'Advanced Ashtanga', category: 'Yoga', level: 'Advanced', duration: 50, calories: 280, image: 'https://images.unsplash.com/photo-1552196563-55cd4e45efb3?w=400&h=300&fit=crop'},
            {id: 20, name: 'Explosive Power', category: 'Strength', level: 'Advanced', duration: 50, calories: 480, image: 'https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=400&h=300&fit=crop'},
            {id: 21, name: 'Tabata Extreme', category: 'Cardio', level: 'Advanced', duration: 25, calories: 400, image: 'https://images.unsplash.com/photo-1517836357463-d25dfeac3438?w=400&h=300&fit=crop'},
            {id: 22, name: 'Advanced Core', category: 'Strength', level: 'Advanced', duration: 30, calories: 250, image: 'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=400&h=300&fit=crop'},
            {id: 23, name: 'Warrior Bootcamp', category: 'Cardio', level: 'Advanced', duration: 45, calories: 520, image: 'https://images.unsplash.com/photo-1517836357463-d25dfeac3438?w=400&h=300&fit=crop'},
            {id: 24, name: 'Hot Yoga Power', category: 'Yoga', level: 'Advanced', duration: 60, calories: 350, image: 'https://images.unsplash.com/photo-1588286840104-8957b019727f?w=400&h=300&fit=crop'},
            {id: 25, name: 'Olympic Lifts', category: 'Strength', level: 'Advanced', duration: 55, calories: 500, image: 'https://images.unsplash.com/photo-1517836357463-d25dfeac3438?w=400&h=300&fit=crop'},
            
            // More Cardio
            {id: 26, name: 'Jump Rope Master', category: 'Cardio', level: 'Intermediate', duration: 20, calories: 280, image: 'https://images.unsplash.com/photo-1517836357463-d25dfeac3438?w=400&h=300&fit=crop'},
            {id: 27, name: 'Stair Climber', category: 'Cardio', level: 'Intermediate', duration: 25, calories: 300, image: 'https://images.unsplash.com/photo-1571902943202-507ec2618e8f?w=400&h=300&fit=crop'},
            {id: 28, name: 'Dance Cardio', category: 'Cardio', level: 'Beginner', duration: 30, calories: 220, image: 'https://images.unsplash.com/photo-1545205597-3d9d02c29597?w=400&h=300&fit=crop'},
            
            // More Yoga
            {id: 29, name: 'Yin Yoga Restore', category: 'Yoga', level: 'Beginner', duration: 45, calories: 110, image: 'https://images.unsplash.com/photo-1506126613408-eca07ce68773?w=400&h=300&fit=crop'},
            {id: 30, name: 'Balance & Flexibility', category: 'Yoga', level: 'Intermediate', duration: 35, calories: 160, image: 'https://images.unsplash.com/photo-1588286840104-8957b019727f?w=400&h=300&fit=crop'},
        ];

        let currentFilter = 'All';
        let userName = 'Guest';
        let waterIntake = 1.5;
        
        // Daily Goals State
        let dailyGoals = {
            water: { current: 1.5, goal: 2.5, completed: false },
            sleep: { current: 7.5, goal: 8, completed: false },
            steps: { current: 0, goal: 10000, completed: false }
        };
        
        let allGoalsCompletedToday = false;
        let currentUser = null;
        let userStats = {
            caloriesBurned: 0,
            steps: 0,
            workoutsDone: 0,
            activeStreak: 0
        };
        
        // Health goals - fetched from Firestore
        let healthGoals = {
            water: 8,  // glasses per day
            sleep: 8   // hours per night
        };
        
        // My Routines Data
        const myRoutines = [
            {id: 1, name: 'Morning Power Routine', workouts: ['Morning Yoga Flow', 'Core Strength'], duration: 55, created: '2 weeks ago'},
            {id: 2, name: 'Evening Relax', workouts: ['Evening Stretch', 'Light Cardio Walk'], duration: 40, created: '1 week ago'},
            {id: 3, name: 'Weekend Warrior', workouts: ['Full Body Blast', 'HIIT Cardio Burn'], duration: 65, created: '3 days ago'}
        ];
        
        // Workout History Data
        let workoutHistory = [
            {name: 'Morning Yoga Flow', date: 'Today, 7:30 AM', duration: 30, calories: 120},
            {name: 'HIIT Cardio Burn', date: 'Yesterday, 6:00 PM', duration: 20, calories: 300},
            {name: 'Core Strength', date: '2 days ago, 8:00 AM', duration: 25, calories: 180},
            {name: 'Power Yoga', date: '3 days ago, 7:00 AM', duration: 40, calories: 220},
            {name: 'Beast Mode Strength', date: '4 days ago, 5:30 PM', duration: 60, calories: 550},
            {name: 'Light Cardio Walk', date: '5 days ago, 9:00 AM', duration: 25, calories: 150}
        ];
        
        // Friends Data
        let friends = [];
        const availableFriends = [
            {id: 1, name: 'Sarah Johnson', username: 'sarahfit', image: 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=150&h=150&fit=crop', workouts: 147},
            {id: 2, name: 'Mike Chen', username: 'mikestrong', image: 'https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=150&h=150&fit=crop', workouts: 203},
            {id: 3, name: 'Emily Davis', username: 'emilyrun', image: 'https://images.unsplash.com/photo-1494790108377-be9c29b29330?w=150&h=150&fit=crop', workouts: 189},
            {id: 4, name: 'James Wilson', username: 'jamesgym', image: 'https://images.unsplash.com/photo-1500648767791-00dcc994a43e?w=150&h=150&fit=crop', workouts: 256},
            {id: 5, name: 'Lisa Martinez', username: 'lisayoga', image: 'https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=150&h=150&fit=crop', workouts: 312}
        ];

        // ===== MOBILE NAVIGATION FUNCTIONS =====
        
        /**
         * Toggle mobile navigation menu
         */
        function toggleMobileMenu() {
            const dropdown = document.getElementById('mobile-nav-dropdown');
            if (dropdown) {
                dropdown.classList.toggle('show');
            }
        }
        
        /**
         * Close mobile navigation menu
         */
        function closeMobileMenu() {
            const dropdown = document.getElementById('mobile-nav-dropdown');
            if (dropdown) {
                dropdown.classList.remove('show');
            }
        }
        
        /**
         * Update active state of mobile nav items
         */
        function updateMobileNavActive(viewId) {
            const mobileNavItems = document.querySelectorAll('.mobile-nav-item');
            mobileNavItems.forEach(item => {
                item.classList.remove('active');
                if (item.getAttribute('data-view') === viewId.replace('-view', '')) {
                    item.classList.add('active');
                }
            });
        }
        
        // ===== END MOBILE NAVIGATION FUNCTIONS =====

        /**
         * Core SPA navigation function
         * Handles all view switching and UI state management
         * @param {string} targetViewId - The ID of the view to display (e.g., 'dashboard-view', 'workout-view')
         */
        function updateUIState(targetViewId) {
            // Update mobile nav active state
            updateMobileNavActive(targetViewId);
            // Hide all application views
            const allViews = [
                'login-view', 
                'signup-view', 
                'dashboard-view', 
                'workout-view', 
                'nutrition-view', 
                'health-view', 
                'activity-view',
                'social-view', 
                'settings-view'
            ];
            
            allViews.forEach(viewId => {
                const viewElement = document.getElementById(viewId);
                if (viewElement) {
                    viewElement.classList.add('hidden');
                }
            });
            
            // Show the target view
            const targetView = document.getElementById(targetViewId);
            if (targetView) {
                targetView.classList.remove('hidden');
            } else {
                console.warn(`View with ID "${targetViewId}" not found`);
                return;
            }
            
            // Extract view name without '-view' suffix for history and nav state
            const viewName = targetViewId.replace('-view', '');
            
            // Update browser history state
            if (history.state !== viewName) {
                history.pushState(viewName, '', '');
            }
            
            // Show/hide sidebar based on view and adjust main content styling
            const sidebar = document.getElementById('corporate-sidebar');
            const mainContent = document.getElementById('main-content');
            const appContainer = document.getElementById('app-container');
            
            if (viewName === 'login' || viewName === 'signup') {
                // Landing/Auth views: Hide sidebar and add landing-page class to body
                document.body.classList.add('landing-page');
                
                if (sidebar) {
                    sidebar.style.display = 'none';
                }
                
                if (appContainer) {
                    appContainer.style.marginLeft = '0';
                    appContainer.style.paddingTop = '0';
                }
                
                if (mainContent) {
                    mainContent.style.padding = '0';
                    mainContent.style.paddingTop = '0';
                    mainContent.style.background = 'transparent';
                    mainContent.style.backdropFilter = 'none';
                    console.log('ðŸ“ Landing page mode - sidebar hidden');
                }
            } else {
                // App views: Show sidebar with scroll-to-hide enabled
                document.body.classList.remove('landing-page');
                
                if (sidebar) {
                    sidebar.style.display = 'flex';
                    sidebar.classList.add('sidebar-visible');
                }
                
                if (appContainer) {
                    appContainer.style.marginLeft = '260px';
                    appContainer.style.paddingTop = '0';
                }
                
                if (mainContent) {
                    mainContent.style.padding = '2rem';
                    mainContent.style.background = '#f8f9fa';
                    mainContent.style.backdropFilter = 'none';
                    console.log('ðŸ“ App view mode - sidebar visible');
                }
            }
            
            // Update active navigation state in sidebar
            const navLinks = document.querySelectorAll('.nav-item');
            navLinks.forEach(link => {
                link.classList.remove('active');
                const linkView = link.getAttribute('data-view');
                if (linkView === viewName) {
                    link.classList.add('active');
                }
            });
            
            // Initialize view-specific content and functionality
            switch (viewName) {
                case 'dashboard':
                    // Dashboard initialization if needed
                    break;
                case 'workout':
                    // Ensure workout list view is visible, not active timer
                    const workoutListView = document.getElementById('workout-list-view');
                    const activeTimerView = document.getElementById('active-timer-view');
                    if (workoutListView) workoutListView.classList.remove('hidden');
                    if (activeTimerView) activeTimerView.classList.add('hidden');
                    break;
                case 'social':
                    // Load all social features
                    loadFriendsList();
                    loadFriendRequests();
                    loadActivityFeed();
                    loadLeaderboard('workouts');
                    showChallenges();
                    break;
                case 'nutrition':
                    // Update nutrition display when view is shown
                    updateNutritionDisplay();
                    break;
                case 'health':
                    // Update health display when view is shown
                    updateHealthDisplay();
                    break;
                case 'settings':
                    // Load settings data when view is shown
                    loadSettingsData();
                    break;
            }
            
            // Reinitialize Lucide icons
            setTimeout(() => window.createIcons?.(), 100);
        }
        
        /**
         * Legacy function for backward compatibility
         * Calls updateUIState with proper view ID format
         * @param {string} viewName - The view name (without '-view' suffix)
         */
        function showView(viewName) {
            updateUIState(viewName + '-view');
        }

        // Form tab switching for landing page
        function switchFormTab(tabName) {
            // Update tab buttons
            document.getElementById('tab-signup').classList.toggle('active', tabName === 'signup');
            document.getElementById('tab-login').classList.toggle('active', tabName === 'login');
            
            // Update form content
            document.getElementById('form-signup').classList.toggle('active', tabName === 'signup');
            document.getElementById('form-login').classList.toggle('active', tabName === 'login');
            
            // Reinitialize icons for the newly visible form
            setTimeout(() => window.createIcons?.(), 50);
        }

        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            if (!email || !password) {
                showToast('Missing Information', 'Please enter both email and password', 'warning', 3000);
                return;
            }
            
            try {
                const userCredential = await window.firebaseSignIn(window.firebaseAuth, email, password);
                currentUser = userCredential.user;
                
                // Load user data from Firestore
                await loadUserData(currentUser.uid);
                
                showToast('Login Successful! ðŸŽ‰', `Welcome back, ${userName}! Time to crush your fitness goals today.`, 'success', 4000);
                showView('dashboard');
            } catch (error) {
                console.error('Login error:', error);
                
                // Provide user-friendly error messages
                let errorMessage = 'Unable to log in';
                let errorDetail = '';
                
                if (error.code === 'auth/invalid-credential' || error.code === 'auth/wrong-password' || error.code === 'auth/user-not-found') {
                    errorMessage = 'Invalid Credentials';
                    errorDetail = 'Email or password is incorrect. Don\'t have an account? Sign up first!';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Invalid Email';
                    errorDetail = 'Please enter a valid email address';
                } else if (error.code === 'auth/too-many-requests') {
                    errorMessage = 'Too Many Attempts';
                    errorDetail = 'Please try again later';
                } else {
                    errorDetail = error.message || 'Please check your credentials and try again';
                }
                
                showModal(errorMessage, errorDetail, 'error');
            }
        }

        async function handleSignup(e) {
            e.preventDefault();
            const name = document.getElementById('signup-name').value;
            const email = document.getElementById('signup-email').value;
            const password = document.getElementById('signup-password').value;
            
            // Validation
            if (!name || !email || !password) {
                showToast('Missing Information', 'Please fill in all fields', 'warning', 3000);
                return;
            }
            
            if (password.length < 6) {
                showToast('Password Too Short', 'Password must be at least 6 characters', 'warning', 3000);
                return;
            }
            
            try {
                const userCredential = await window.firebaseSignUp(window.firebaseAuth, email, password);
                currentUser = userCredential.user;
                
                // Create user profile in Firestore
                await createUserProfile(currentUser.uid, name, email);
                
                userName = name;
                
                // Update dashboard name if element exists
                const dashboardNameEl = document.getElementById('dashboard-name');
                if (dashboardNameEl) {
                    dashboardNameEl.textContent = userName;
                }
                
                showModal('Welcome to GetFit! ðŸŽ‰', `Hey ${userName}! Your fitness journey starts now. Let us make every workout count!`, 'success');
                showView('dashboard');
            } catch (error) {
                console.error('Signup error:', error);
                
                let errorMessage = 'Signup Failed';
                let errorDetail = '';
                
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = 'Email Already Registered';
                    errorDetail = 'This email is already in use. Try logging in instead!';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = 'Invalid Email';
                    errorDetail = 'Please enter a valid email address';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = 'Weak Password';
                    errorDetail = 'Please use a stronger password (at least 6 characters)';
                } else {
                    errorDetail = error.message || 'Could not create account. Please try again.';
                }
                
                showModal(errorMessage, errorDetail, 'error');
            }
        }
        
        // User profile data
        let userProfile = {
            displayName: '',
            email: '',
            age: null,
            gender: '',
            height: null,
            weight: null,
            avatarUrl: ''
        };
        
        // Create user profile in Firestore
        async function createUserProfile(userId, displayName, email) {
            const userRef = window.firestoreDoc(window.firebaseDb, 'users', userId);
            const userData = {
                id: userId,
                displayName: displayName,
                email: email,
                createdAt: Date.now(),
                profile: {
                    age: null,
                    gender: '',
                    height: null,
                    weight: null,
                    avatarUrl: ''
                },
                stats: {
                    totalWorkouts: 0,
                    totalCalories: 0,
                    currentStreak: 0,
                    longestStreak: 0,
                    totalSteps: 0
                },
                goals: {
                    dailySteps: 10000,
                    dailyCalories: 2500,
                    weeklyWorkouts: 5,
                    dailyWater: 2.5
                }
            };
            
            await window.firestoreSetDoc(userRef, userData);
            userStats = userData.stats;
            userProfile = {
                displayName: displayName,
                email: email,
                ...userData.profile
            };
            updateProfileDisplay();
        }
        
        // Load user data from Firestore
        async function loadUserData(userId) {
            try {
                const userRef = window.firestoreDoc(window.firebaseDb, 'users', userId);
                const userSnap = await window.firestoreGetDoc(userRef);
                
                if (userSnap.exists()) {
                    const userData = userSnap.data();
                    userName = userData.displayName || 'User';
                    userStats = userData.stats || {
                        totalWorkouts: 0,
                        totalCalories: 0,
                        currentStreak: 0,
                        totalSteps: 0
                    };
                    
                    // Load profile data
                    userProfile = {
                        displayName: userData.displayName || '',
                        email: userData.email || '',
                        age: userData.profile?.age || null,
                        gender: userData.profile?.gender || '',
                        height: userData.profile?.height || null,
                        weight: userData.profile?.weight || null,
                        avatarUrl: userData.profile?.avatarUrl || ''
                    };
                    
                    // Load or initialize nutritional goals
                    if (!userData.nutritionalGoals) {
                        // Set default nutritional goals if not present
                        const defaultGoals = {
                            goalCalories: 2000,
                            goalProtein: 150,
                            goalCarbs: 200,
                            goalFat: 65
                        };
                        
                        // Save to Firestore
                        await window.firestoreSetDoc(userRef, {
                            nutritionalGoals: defaultGoals
                        }, { merge: true });
                        
                        window.nutritionalGoals = defaultGoals;
                    } else {
                        window.nutritionalGoals = userData.nutritionalGoals;
                    }
                    
                    // Update UI safely
                    const dashboardNameEl = document.getElementById('dashboard-name');
                    if (dashboardNameEl) {
                        dashboardNameEl.textContent = userName;
                    }
                    
                    // Update profile display
                    updateProfileDisplay();
                    
                    // Update dashboard stats
                    updateDashboardStats();
                    
                    // Update nutrition display
                    updateNutritionDisplay();
                    
                    // Update health display
                    updateHealthDisplay();
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }
        
        // Update profile display in settings
        function updateProfileDisplay() {
            // Safely update profile elements if they exist
            const nameEl = document.getElementById('profile-name-display');
            const emailEl = document.getElementById('profile-email-display');
            const ageEl = document.getElementById('profile-age-display');
            const genderEl = document.getElementById('profile-gender-display');
            const heightEl = document.getElementById('profile-height-display');
            const weightEl = document.getElementById('profile-weight-display');
            
            if (nameEl) nameEl.textContent = userProfile.displayName || '-';
            if (emailEl) emailEl.textContent = userProfile.email || '-';
            if (ageEl) ageEl.textContent = userProfile.age ? `${userProfile.age} years` : '-';
            if (genderEl) genderEl.textContent = userProfile.gender || '-';
            if (heightEl) heightEl.textContent = userProfile.height ? `${userProfile.height} cm` : '-';
            if (weightEl) weightEl.textContent = userProfile.weight ? `${userProfile.weight} kg` : '-';
        }
        
        // Open Edit Profile Modal
        function openEditProfileModal() {
            const overlay = document.getElementById('modal-overlay');
            const modalContent = document.getElementById('modal-content');
            
            modalContent.innerHTML = `
                <div class="modal-icon info">
                    <i data-lucide="user" style="width: 32px; height: 32px; color: #00D9FF;"></i>
                </div>
                <h2 class="modal-title">Edit Profile</h2>
                <form id="edit-profile-form" class="space-y-4 text-left">
                    
                    <!-- Profile Picture Section -->
                    <div class="text-center mb-6 p-4 rounded-lg border-2 border-dashed border-gray-700 hover:border-green-500 transition" style="background-color: rgba(50, 215, 75, 0.05);">
                        <label class="block text-sm font-semibold mb-3 text-gray-300">
                            <i data-lucide="camera" class="w-5 h-5 inline mr-2" style="color: var(--color-accent);"></i>
                            Profile Picture
                        </label>
                        <div class="flex flex-col items-center gap-3">
                            <img id="avatar-preview" 
                                 src="${userProfile.avatarUrl || 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop&auto=format'}" 
                                 alt="Avatar Preview" 
                                 class="w-24 h-24 rounded-full border-4 border-green-500 object-cover shadow-lg">
                            
                            <!-- File Upload Button -->
                            <div class="flex gap-2 w-full">
                                <label for="avatar-file-input" class="flex-1 cursor-pointer">
                                    <div class="px-4 py-2 bg-green-500/20 hover:bg-green-500/30 border border-green-500/40 rounded-lg text-center text-sm font-semibold text-green-400 transition-all hover:scale-105">
                                        <i data-lucide="upload" class="w-4 h-4 inline mr-2"></i>
                                        Upload Photo
                                    </div>
                                </label>
                                <input type="file" id="avatar-file-input" accept="image/*" onchange="handleImageUpload(event)" class="hidden">
                            </div>
                            
                            <div class="text-xs text-gray-500 text-center">â€” OR â€”</div>
                            
                            <input type="url" id="edit-avatarUrl" value="${userProfile.avatarUrl || ''}"
                                   oninput="updateAvatarPreview(this.value)"
                                   class="w-full px-4 py-2 rounded-lg border border-gray-700 text-white focus:border-green-500 focus:outline-none transition text-sm" 
                                   style="background-color: var(--color-card);" 
                                   placeholder="https://example.com/your-photo.jpg">
                            <p class="text-xs text-gray-500">Paste image URL from:</p>
                            <div class="flex gap-2 text-xs flex-wrap justify-center">
                                <a href="https://imgur.com/upload" target="_blank" class="text-green-400 hover:text-green-300">Imgur</a>
                                <span class="text-gray-600">â€¢</span>
                                <a href="https://postimages.org/" target="_blank" class="text-green-400 hover:text-green-300">PostImages</a>
                                <span class="text-gray-600">â€¢</span>
                                <a href="https://imgbb.com/" target="_blank" class="text-green-400 hover:text-green-300">ImgBB</a>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2 text-gray-300">Display Name</label>
                        <input type="text" id="edit-displayName" value="${userProfile.displayName || ''}" 
                               class="w-full px-4 py-2 rounded-lg border border-gray-700 text-white focus:border-green-500 focus:outline-none transition" 
                               style="background-color: var(--color-card);" placeholder="Enter your name" required>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2 text-gray-300">Email</label>
                        <input type="email" id="edit-email" value="${userProfile.email || ''}" 
                               class="w-full px-4 py-2 rounded-lg border border-gray-700 text-white focus:border-green-500 focus:outline-none transition" 
                               style="background-color: var(--color-card);" placeholder="your.email@example.com" required>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2 text-gray-300">Age</label>
                            <input type="number" id="edit-age" value="${userProfile.age || ''}" min="13" max="120"
                                   class="w-full px-4 py-2 rounded-lg border border-gray-700 text-white focus:border-green-500 focus:outline-none transition" 
                                   style="background-color: var(--color-card);" placeholder="25">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2 text-gray-300">Gender</label>
                            <select id="edit-gender" 
                                    class="w-full px-4 py-2 rounded-lg border border-gray-700 text-white focus:border-green-500 focus:outline-none transition" 
                                    style="background-color: var(--color-card);">
                                <option value="">Select</option>
                                <option value="Male" ${userProfile.gender === 'Male' ? 'selected' : ''}>Male</option>
                                <option value="Female" ${userProfile.gender === 'Female' ? 'selected' : ''}>Female</option>
                                <option value="Other" ${userProfile.gender === 'Other' ? 'selected' : ''}>Other</option>
                                <option value="Prefer not to say" ${userProfile.gender === 'Prefer not to say' ? 'selected' : ''}>Prefer not to say</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2 text-gray-300">Height (cm)</label>
                            <input type="number" id="edit-height" value="${userProfile.height || ''}" min="50" max="300"
                                   class="w-full px-4 py-2 rounded-lg border border-gray-700 text-white focus:border-green-500 focus:outline-none transition" 
                                   style="background-color: var(--color-card);" placeholder="170">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2 text-gray-300">Weight (kg)</label>
                            <input type="number" id="edit-weight" value="${userProfile.weight || ''}" min="20" max="500" step="0.1"
                                   class="w-full px-4 py-2 rounded-lg border border-gray-700 text-white focus:border-green-500 focus:outline-none transition" 
                                   style="background-color: var(--color-card);" placeholder="70">
                        </div>
                    </div>
                    
                    <div class="flex gap-3 mt-6">
                        <button type="submit" class="modal-button primary flex-1">
                            <i data-lucide="save" class="w-4 h-4 inline mr-2"></i>
                            Save Changes
                        </button>
                        <button type="button" onclick="closeModal()" class="modal-button secondary">
                            Cancel
                        </button>
                    </div>
                </form>
            `;
            
            overlay.classList.add('show');
            setTimeout(() => window.createIcons?.(), 10);
            
            // Handle form submission
            document.getElementById('edit-profile-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                await saveProfileChanges();
            });
        }
        
        // Save profile changes to Firestore
        async function saveProfileChanges() {
            try {
                const displayName = document.getElementById('edit-displayName').value.trim();
                const email = document.getElementById('edit-email').value.trim();
                const age = parseInt(document.getElementById('edit-age').value) || null;
                const gender = document.getElementById('edit-gender').value;
                const height = parseInt(document.getElementById('edit-height').value) || null;
                const weight = parseFloat(document.getElementById('edit-weight').value) || null;
                const avatarUrl = document.getElementById('edit-avatarUrl').value.trim();
                
                // Validate required fields
                if (!displayName || !email) {
                    showToast('Validation Error', 'Display Name and Email are required!', 'error');
                    return;
                }
                
                // Show loading state
                showToast('Saving...', 'Updating your profile information', 'info', 2000);
                
                // Update Firestore - Use setDoc with merge for nested updates
                const userRef = window.firestoreDoc(window.firebaseDb, 'users', userId);
                await window.firestoreSetDoc(userRef, {
                    displayName: displayName,
                    email: email,
                    profile: {
                        age: age,
                        gender: gender,
                        height: height,
                        weight: weight,
                        avatarUrl: avatarUrl
                    }
                }, { merge: true });
                
                // Update local profile data
                userProfile = {
                    displayName,
                    email,
                    age,
                    gender,
                    height,
                    weight,
                    avatarUrl
                };
                
                // Update userName globally
                userName = displayName;
                
                // Update UI
                document.getElementById('user-name').textContent = userName;
                document.getElementById('dashboard-name').textContent = userName;
                updateProfileDisplay();
                
                // Update avatar if provided
                if (avatarUrl) {
                    const avatarImg = document.getElementById('user-avatar');
                    if (avatarImg) {
                        avatarImg.src = avatarUrl;
                    }
                }
                
                // Close modal and show success
                closeModal();
                showToast('Profile Updated! âœ…', 'Your profile information has been saved successfully.', 'success', 4000);
                
            } catch (error) {
                console.error('Error saving profile:', error);
                showToast('Save Failed', `Could not update profile: ${error.message}`, 'error', 5000);
            }
        }
        
        // Close modal
        function closeModal() {
            const overlay = document.getElementById('modal-overlay');
            overlay.classList.remove('show');
        }
        
        // Update avatar preview as user types URL
        function updateAvatarPreview(url) {
            const preview = document.getElementById('avatar-preview');
            if (preview && url) {
                preview.src = url;
                // Handle image load errors
                preview.onerror = function() {
                    this.src = 'https://images.unsplash.com/photo-1438761681033-6461ffad8d80?w=100&h=100&fit=crop&auto=format';
                };
            }
        }
        
        // Handle local image file upload
        function handleImageUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Check if file is an image
            if (!file.type.startsWith('image/')) {
                showToast('Invalid File', 'Please select an image file (JPG, PNG, GIF, etc.)', 'error');
                return;
            }
            
            // Check file size (max 5MB)
            if (file.size > 5 * 1024 * 1024) {
                showToast('File Too Large', 'Please select an image smaller than 5MB', 'error');
                return;
            }
            
            // Show loading
            showToast('Processing...', 'Converting your image', 'info', 1500);
            
            // Convert to base64
            const reader = new FileReader();
            reader.onload = function(e) {
                const base64Image = e.target.result;
                
                // Update preview
                const preview = document.getElementById('avatar-preview');
                const urlInput = document.getElementById('edit-avatarUrl');
                
                if (preview) {
                    preview.src = base64Image;
                }
                
                if (urlInput) {
                    urlInput.value = base64Image;
                }
                
                showToast('Image Loaded! âœ…', 'Your photo is ready. Click Save Changes to update your profile.', 'success', 3000);
            };
            
            reader.onerror = function() {
                showToast('Upload Failed', 'Could not read the image file', 'error');
            };
            
            reader.readAsDataURL(file);
        }
        
        // Update dashboard statistics
        function updateDashboardStats() {
            // Update calories burned
            document.querySelector('[data-stat="calories"]').textContent = userStats.totalCalories?.toLocaleString() || '0';
            
            // Update steps
            const totalSteps = userStats.totalSteps || 0;
            document.querySelector('[data-stat="steps"]').textContent = totalSteps.toLocaleString();
            const stepsPercent = (totalSteps / 10000) * 100;
            document.querySelector('[data-stat="steps-progress"]').style.width = `${Math.min(stepsPercent, 100)}%`;
            
            // Sync with daily goals
            dailyGoals.steps.current = totalSteps;
            
            // Update workouts done
            document.querySelector('[data-stat="workouts"]').textContent = userStats.totalWorkouts || '0';
            
            // Update active streak (Days Active)
            document.querySelector('[data-stat="streak"]').textContent = userStats.currentStreak || '0';
            
            // Update goals UI
            updateGoalsUI();
        }

        async function logout() {
            const confirmed = await showConfirm('Logout', 'Are you sure you want to log out?', 'Yes, Log Out', 'Cancel');
            if (confirmed) {
                try {
                    await window.firebaseSignOut(window.firebaseAuth);
                    currentUser = null;
                    userName = 'Guest';
                    userStats = {caloriesBurned: 0, steps: 0, workoutsDone: 0, activeStreak: 0};
                    document.getElementById('user-name').textContent = 'Guest';
                    document.getElementById('dashboard-name').textContent = 'User';
                    showToast('Logged Out', 'See you next time! Stay fit! ðŸ’ª', 'info', 3000);
                    showView('login');
                } catch (error) {
                    console.error('Logout error:', error);
                    showToast('Error', 'Failed to log out', 'error', 3000);
                }
            }
        }

        async function askFrancine() {
            // Show input modal for user question
            const overlay = document.getElementById('modal-overlay');
            const modalContent = document.getElementById('modal-content');
            
            modalContent.innerHTML = `
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center">
                        <div class="modal-icon info" style="margin: 0; margin-right: 12px;">
                            <i data-lucide="sparkles" style="width: 32px; height: 32px; color: #00D9FF;"></i>
                        </div>
                        <h2 class="modal-title" style="margin: 0;">Ask AI Coach Francine ðŸ¤–</h2>
                    </div>
                    <button onclick="closeModal()" class="p-2 hover:bg-gray-700 rounded-lg transition" title="Close">
                        <i data-lucide="x" style="width: 24px; height: 24px;"></i>
                    </button>
                </div>
                <p class="modal-message mb-4">What fitness or health question do you have today?</p>
                <textarea 
                    id="francine-question" 
                    placeholder="e.g., How can I build muscle faster? What should I eat before a workout?" 
                    class="w-full px-4 py-3 rounded-lg border border-gray-700 text-white mb-4 resize-none"
                    style="background-color: var(--color-primary); min-height: 100px;"
                    rows="4"
                ></textarea>
                <div class="modal-buttons">
                    <button class="modal-button secondary" onclick="closeModal()">
                        <i data-lucide="x" class="w-4 h-4 inline mr-2"></i>
                        Cancel
                    </button>
                    <button class="modal-button primary" onclick="getFrancineResponse()">
                        <i data-lucide="send" class="w-4 h-4 inline mr-2"></i>
                        Ask Francine
                    </button>
                </div>
            `;
            
            overlay.classList.add('show');
            setTimeout(() => {
                window.createIcons?.();
                const questionInput = document.getElementById('francine-question');
                questionInput.focus();
                
                // Add keyboard shortcuts
                questionInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
                        e.preventDefault();
                        getFrancineResponse();
                    }
                    if (e.key === 'Escape') {
                        e.preventDefault();
                        closeModal();
                    }
                });
            }, 100);
        }
        
        async function getFrancineResponse() {
            const questionInput = document.getElementById('francine-question');
            const question = questionInput.value.trim();
            
            if (!question) {
                showToast('Question Required', 'Please enter a question for Francine', 'warning', 2500);
                return;
            }
            
            // Show loading state
            const modalContent = document.getElementById('modal-content');
            modalContent.innerHTML = `
                <div class="modal-icon info">
                    <i data-lucide="loader-2" class="animate-spin" style="width: 32px; height: 32px; color: #00D9FF;"></i>
                </div>
                <h2 class="modal-title">Francine is thinking... ðŸ¤”</h2>
                <p class="modal-message">Getting you the best fitness advice!</p>
            `;
            setTimeout(() => window.createIcons?.(), 10);
            
            try {
                // Get AI response
                const response = await getAIResponse(question);
                
                // Show response with scrolling
                modalContent.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center">
                            <div class="modal-icon success" style="margin: 0; margin-right: 12px;">
                                <i data-lucide="sparkles" style="width: 32px; height: 32px; color: #32D74B;"></i>
                            </div>
                            <h2 class="modal-title" style="margin: 0;">Francine's Advice ðŸ’ª</h2>
                        </div>
                        <button onclick="closeModal()" class="p-2 hover:bg-gray-700 rounded-lg transition" title="Close">
                            <i data-lucide="x" style="width: 24px; height: 24px;"></i>
                        </button>
                    </div>
                    <div class="text-left mb-4 p-4 rounded-lg overflow-y-auto" style="background-color: rgba(50, 215, 75, 0.1); border: 1px solid rgba(50, 215, 75, 0.2); max-height: 60vh;">
                        <p class="text-sm text-gray-300 whitespace-pre-line">${response}</p>
                    </div>
                    <div class="modal-buttons">
                        <button class="modal-button secondary" onclick="askFrancine()">
                            <i data-lucide="message-circle" class="w-4 h-4 inline mr-2"></i>
                            Ask Another
                        </button>
                        <button class="modal-button primary" onclick="closeModal()">
                            <i data-lucide="check" class="w-4 h-4 inline mr-2"></i>
                            Got it!
                        </button>
                    </div>
                `;
                setTimeout(() => window.createIcons?.(), 10);
                
            } catch (error) {
                console.error('Error getting AI response:', error);
                
                // Fallback to curated responses
                const fallbackResponse = getFallbackResponse(question);
                
                modalContent.innerHTML = `
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center">
                            <div class="modal-icon info" style="margin: 0; margin-right: 12px;">
                                <i data-lucide="sparkles" style="width: 32px; height: 32px; color: #00D9FF;"></i>
                            </div>
                            <h2 class="modal-title" style="margin: 0;">Francine's Advice ðŸ’ª</h2>
                        </div>
                        <button onclick="closeModal()" class="p-2 hover:bg-gray-700 rounded-lg transition" title="Close">
                            <i data-lucide="x" style="width: 24px; height: 24px;"></i>
                        </button>
                    </div>
                    <div class="text-left mb-4 p-4 rounded-lg overflow-y-auto" style="background-color: rgba(50, 215, 75, 0.1); border: 1px solid rgba(50, 215, 75, 0.2); max-height: 60vh;">
                        <p class="text-sm text-gray-300 whitespace-pre-line">${fallbackResponse}</p>
                    </div>
                    <div class="modal-buttons">
                        <button class="modal-button secondary" onclick="askFrancine()">
                            <i data-lucide="message-circle" class="w-4 h-4 inline mr-2"></i>
                            Ask Another
                        </button>
                        <button class="modal-button primary" onclick="closeModal()">
                            <i data-lucide="check" class="w-4 h-4 inline mr-2"></i>
                            Got it!
                        </button>
                    </div>
                `;
                setTimeout(() => window.createIcons?.(), 10);
            }
        }
        
        // AI-powered response function
        async function getAIResponse(question) {
            // Option 1: Using OpenAI API (requires API key)
            // Uncomment and add your API key to use
            /*
            const apiKey = 'YOUR_OPENAI_API_KEY'; // Add your key here
            
            const response = await fetch('https://api.openai.com/v1/chat/completions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${apiKey}`
                },
                body: JSON.stringify({
                    model: 'gpt-3.5-turbo',
                    messages: [
                        {
                            role: 'system',
                            content: 'You are Francine, a professional fitness coach and nutritionist. Provide helpful, accurate, and motivating fitness and health advice. Keep responses concise (3-5 sentences) and actionable.'
                        },
                        {
                            role: 'user',
                            content: question
                        }
                    ],
                    max_tokens: 200,
                    temperature: 0.7
                })
            });
            
            const data = await response.json();
            return data.choices[0].message.content;
            */
            
            // Option 2: Using Hugging Face Inference API (Free alternative)
            // For now, use smart fallback with enhanced responses
            return getEnhancedResponse(question);
        }
        
        // Enhanced response system with comprehensive keyword matching and varied responses
        function getEnhancedResponse(question) {
            const q = question.toLowerCase();
            
            // Muscle building - Multiple response variations
            if (q.includes('muscle') || q.includes('bulk') || q.includes('gain weight') || q.includes('hypertrophy')) {
                const responses = [
                    "**Building Muscle: Complete Strategy**\n\n**Training Protocol:**\nâ€¢ Progressive Overload: Add 2.5-5kg weekly or 1-2 reps per set\nâ€¢ Volume: 10-20 sets per muscle group weekly\nâ€¢ Rep Range: 6-12 reps for hypertrophy\nâ€¢ Compound Movements: Squat, Deadlift, Bench, Pull-ups, Rows\nâ€¢ Time Under Tension: 40-70 seconds per set\n\n**Nutrition:**\nâ€¢ Caloric Surplus: +300-500 cal above maintenance\nâ€¢ Protein: 1.6-2.2g per kg bodyweight (spread across 4-5 meals)\nâ€¢ Carbs: 3-5g per kg (fuel for training)\nâ€¢ Fats: 0.8-1g per kg (hormone production)\n\n**Recovery:**\nâ€¢ Sleep: 7-9 hours (growth hormone peak)\nâ€¢ Rest Days: 1-2 weekly\nâ€¢ Deload Week: Every 4-6 weeks\n\n**Timeline:** Expect 0.25-0.5kg muscle gain monthly as a natural athlete. Stay patient!",
                    
                    "**Muscle Growth Blueprint**\n\n**Phase 1: Foundation (Weeks 1-4)**\nâ€¢ Focus on form with lighter weights\nâ€¢ Master compound movements\nâ€¢ Build work capacity\nâ€¢ Eat at slight surplus (+200 cal)\n\n**Phase 2: Growth (Weeks 5-12)**\nâ€¢ Increase weights by 5% weekly\nâ€¢ Add volume (sets/exercises)\nâ€¢ Protein at 2g per kg minimum\nâ€¢ Full surplus (+400 cal)\n\n**Phase 3: Peak (Weeks 13-16)**\nâ€¢ Push intensity to 85-90% 1RM\nâ€¢ Maintain volume\nâ€¢ Optimize recovery\n\n**Pro Tips:**\nâœ“ Train each muscle 2-3x weekly\nâœ“ Use exercises you feel in target muscle\nâœ“ Track all lifts in a journal\nâœ“ Take progress photos every 2 weeks\nâœ“ Creatine monohydrate: 5g daily (proven effective)\n\nConsistency trumps perfection every time!",
                    
                    "**Advanced Muscle Building Tactics**\n\n**Training Techniques:**\n1. **Drop Sets**: Reduce weight by 20-30% after failure, continue\n2. **Supersets**: Pair antagonist muscles (biceps-triceps)\n3. **Tempo Training**: 3-1-1-1 (eccentric-pause-concentric-pause)\n4. **Mechanical Drop Sets**: Change exercise angle when fatigued\n\n**Meal Timing (Optional but helpful):**\nâ€¢ Pre-workout (2hr): Carbs + moderate protein\nâ€¢ Post-workout (within 2hr): Protein + carbs (2:1 ratio)\nâ€¢ Before bed: Casein protein for overnight recovery\n\n**Supplement Stack (Evidence-based):**\nâœ“ Creatine: 5g daily (+2-5% strength)\nâœ“ Protein powder: Convenience, not necessity\nâœ“ Caffeine: 3-6mg/kg pre-workout\nâœ— Skip: BCAAs (if eating enough protein), fat burners\n\n**Common Mistakes:**\nâ€¢ Changing routines too frequently\nâ€¢ Not tracking progressive overload\nâ€¢ Under-eating protein\nâ€¢ Overtraining (more â‰  better)\n\nBuild the foundation first, then optimize!"
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }
            
            // Weight loss - Multiple detailed responses
            if (q.includes('lose weight') || q.includes('fat loss') || q.includes('slim') || q.includes('cut') || q.includes('shred')) {
                const responses = [
                    "**Sustainable Fat Loss Strategy**\n\n**Nutrition Fundamentals:**\nâ€¢ Caloric Deficit: -300 to -500 cal daily (not more!)\nâ€¢ Protein: 1.8-2.2g per kg (preserves muscle)\nâ€¢ Carbs: 2-3g per kg (energy for workouts)\nâ€¢ Fats: 0.5-0.8g per kg (minimum for hormones)\nâ€¢ Fiber: 25-35g daily (satiety)\n\n**Training Split:**\nâ€¢ Strength Training: 3-4x weekly (maintain muscle)\nâ€¢ Cardio: 2-3x weekly (150-200 cal sessions)\nâ€¢ Daily Steps: 8,000-10,000 minimum (NEAT)\n\n**Weekly Targets:**\nâ€¢ Fat Loss: 0.5-1% bodyweight weekly\nâ€¢ Muscle Retention: Maintain strength on main lifts\n\n**Tracking:**\nâ€¢ Weigh daily, take weekly average\nâ€¢ Photos every 2 weeks (same lighting/time)\nâ€¢ Measurements: waist, hips, thighs\n\n**Mental Game:**\nâ€¢ Plan meals ahead\nâ€¢ Allow 1-2 flexible meals weekly\nâ€¢ Focus on habits, not perfection\n\nYou've got this! Small deficit = sustainable results.",
                    
                    "**Fat Loss: Advanced Protocol**\n\n**Calorie Cycling:**\nâ€¢ High Days (training): Maintenance calories\nâ€¢ Low Days (rest): -500 calories\nâ€¢ Average deficit: -300 cal weekly\nâ€¢ Benefits: Better performance, less hunger\n\n**Meal Structure:**\nâ€¢ Meal 1 (Breakfast): Protein + fats (300 cal)\nâ€¢ Meal 2 (Lunch): Protein + carbs + veg (450 cal)\nâ€¢ Meal 3 (Pre-workout): Light carbs (150 cal)\nâ€¢ Meal 4 (Dinner): Protein + veg + moderate carbs (500 cal)\nâ€¢ Total: ~1,400-1,600 cal (adjust to your needs)\n\n**Cardio Strategy:**\nâ€¢ Fasted morning walks: 30-45 min, low intensity\nâ€¢ Post-workout HIIT: 15-20 min, 2x weekly\nâ€¢ Daily steps: Non-negotiable 10K\n\n**Strength Training Priority:**\nâ€¢ Keep weights heavy (relative to you)\nâ€¢ Reduce volume slightly (not intensity)\nâ€¢ Rest 2-3 min between main lifts\n\n**Hunger Management:**\nâœ“ Volume foods: Vegetables, fruits\nâœ“ Protein at every meal (most satiating)\nâœ“ Water: 3-4L daily\nâœ“ Coffee/tea: Appetite suppressant\nâœ“ Sleep: 7-9 hours (hunger hormones)\n\nFat loss is a marathon, not a sprint!",
                    
                    "**Complete Fat Loss Checklist**\n\n**Week 1-2: Assessment**\nâ–¡ Track current intake (no changes yet)\nâ–¡ Establish maintenance calories\nâ–¡ Take baseline photos/measurements\nâ–¡ Find current TDEE\n\n**Week 3-8: Fat Loss Phase**\nâ–¡ Create 400-500 cal deficit\nâ–¡ Protein: 2g per kg minimum\nâ–¡ Strength train 3-4x weekly\nâ–¡ Add 150 min cardio weekly\nâ–¡ Track weight daily (weekly average)\nâ–¡ Adjust every 2 weeks if needed\n\n**Week 9-10: Diet Break**\nâ–¡ Eat at maintenance for 10-14 days\nâ–¡ Maintain training intensity\nâ–¡ Reset hunger hormones\nâ–¡ Prepare mentally for next phase\n\n**Red Flags (Stop & Reassess):**\nâš ï¸ Losing >1.5% bodyweight weekly\nâš ï¸ Strength dropping >15% on main lifts\nâš ï¸ Energy levels extremely low\nâš ï¸ Sleep quality poor\nâš ï¸ Mood significantly affected\n\n**Success Markers:**\nâœ“ Consistent 0.5-1kg weekly loss\nâœ“ Maintaining strength\nâœ“ Good energy in workouts\nâœ“ Clothes fitting better\n\nPatience + consistency = results that last!"
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }
            
            // Workout frequency - Detailed variations
            if (q.includes('how often') || q.includes('frequency') || q.includes('how many days') || q.includes('train')) {
                const responses = [
                    "**Optimal Training Frequency by Goal**\n\n**Muscle Building:**\nâ€¢ Beginners: 3-4 full body sessions\nâ€¢ Intermediate: 4-5 upper/lower split\nâ€¢ Advanced: 5-6 push/pull/legs\n\n**Fat Loss:**\nâ€¢ 3-4 strength training sessions\nâ€¢ 2-3 cardio sessions (separate days)\nâ€¢ Daily: 10K steps minimum\n\n**General Fitness:**\nâ€¢ 3-5 mixed sessions weekly\nâ€¢ 2x strength, 2x cardio, 1x flexibility\n\n**Recovery Guidelines:**\nâ€¢ Same muscle: 48-72 hours rest\nâ€¢ Full body: 48 hours minimum\nâ€¢ Heavy lifting: 72 hours between sessions\nâ€¢ Active recovery: Daily walking, yoga\n\n**Weekly Template (Intermediate):**\nâ€¢ Monday: Upper body\nâ€¢ Tuesday: Cardio + core\nâ€¢ Wednesday: Lower body\nâ€¢ Thursday: Rest or active recovery\nâ€¢ Friday: Full body or upper\nâ€¢ Saturday: HIIT + mobility\nâ€¢ Sunday: Complete rest\n\nStart with 3 days, add more as you adapt!",
                    
                    "**Training Frequency Science**\n\n**Muscle Protein Synthesis (MPS):**\nâ€¢ Elevated for 24-48 hours post-workout\nâ€¢ Training a muscle 2x weekly = 2x MPS spikes\nâ€¢ More frequency = more growth stimulus\n\n**Volume Distribution:**\nâ€¢ 10-20 sets per muscle per week optimal\nâ€¢ Distribute across 2-3 sessions\nâ€¢ Example: Chest - Monday 8 sets, Thursday 8 sets\n\n**Frequency by Experience:**\n\n**Beginner (0-1 year):**\nâ€¢ 3-4 days sufficient\nâ€¢ Full body each session\nâ€¢ Focus: Learn movements\n\n**Intermediate (1-3 years):**\nâ€¢ 4-5 days optimal\nâ€¢ Upper/lower or push/pull/legs\nâ€¢ Focus: Progressive overload\n\n**Advanced (3+ years):**\nâ€¢ 5-6 days possible\nâ€¢ Sophisticated splits\nâ€¢ Focus: Weak point training\n\n**Overtraining Signs:**\nâš ï¸ Decreased performance\nâš ï¸ Persistent fatigue\nâš ï¸ Sleep disruption\nâš ï¸ Elevated resting heart rate\nâš ï¸ Mood changes\n\nMore isn't always better - find YOUR optimal frequency!"
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }
            
            // Nutrition with meal examples
            if (q.includes('eat') || q.includes('meal') || q.includes('food') || q.includes('nutrition') || q.includes('diet plan')) {
                const responses = [
                    "**Complete Nutrition Guide**\n\n**Macro Breakdown by Goal:**\n\n**Muscle Building (2,500 cal example):**\nâ€¢ Protein: 180g (720 cal, 29%)\nâ€¢ Carbs: 325g (1,300 cal, 52%)\nâ€¢ Fats: 55g (495 cal, 19%)\n\n**Fat Loss (1,800 cal example):**\nâ€¢ Protein: 160g (640 cal, 36%)\nâ€¢ Carbs: 180g (720 cal, 40%)\nâ€¢ Fats: 50g (450 cal, 24%)\n\n**Sample Day (Muscle Building):**\n\n**Breakfast (7 AM):**\nâ€¢ 3 whole eggs + 2 egg whites\nâ€¢ 80g oats with berries\nâ€¢ 1 banana\nâ€¢ Black coffee\n*Macros: 40g P, 70g C, 18g F*\n\n**Snack (10 AM):**\nâ€¢ Greek yogurt (200g)\nâ€¢ 30g almonds\n*Macros: 25g P, 20g C, 15g F*\n\n**Lunch (1 PM):**\nâ€¢ 180g chicken breast\nâ€¢ 200g sweet potato\nâ€¢ Mixed vegetables\nâ€¢ 1 tbsp olive oil\n*Macros: 45g P, 80g C, 12g F*\n\n**Pre-Workout (4 PM):**\nâ€¢ Rice cakes with honey\nâ€¢ 1 apple\n*Macros: 5g P, 50g C, 1g F*\n\n**Post-Workout (6:30 PM):**\nâ€¢ Protein shake: 40g whey\nâ€¢ 1 banana\n*Macros: 40g P, 35g C, 2g F*\n\n**Dinner (8 PM):**\nâ€¢ 200g salmon\nâ€¢ 150g quinoa\nâ€¢ Roasted vegetables\nâ€¢ Avocado (half)\n*Macros: 50g P, 70g C, 22g F*\n\n**Hydration:** 3-4L water throughout day\n\n**Supplements:**\nâœ“ Creatine: 5g with post-workout\nâœ“ Vitamin D: 2000 IU daily\nâœ“ Omega-3: 2g daily",
                    
                    "**Meal Timing & Nutrient Timing**\n\n**Pre-Workout Nutrition (2-3 hours before):**\n\nGoal: Fuel performance, prevent fatigue\nâ€¢ Carbs: 0.5-1g per kg bodyweight\nâ€¢ Protein: 20-30g\nâ€¢ Low fiber, low fat (digest quickly)\n\n**Options:**\nâ€¢ Oatmeal + protein powder + banana\nâ€¢ White rice + chicken + vegetables\nâ€¢ Rice cakes + peanut butter + honey\n\n**Intra-Workout (60+ min sessions):**\nâ€¢ 30-60g carbs (dextrose/maltodextrin)\nâ€¢ 5-10g BCAAs (optional)\nâ€¢ Electrolytes if sweating heavily\n\n**Post-Workout (Within 2 hours):**\n\nGoal: Recovery, muscle protein synthesis\nâ€¢ Protein: 0.3-0.5g per kg (20-40g)\nâ€¢ Carbs: 0.5-1g per kg (replenish glycogen)\nâ€¢ Fast-digesting preferred\n\n**Options:**\nâ€¢ Protein shake + rice cakes + fruit\nâ€¢ Chicken + white rice + vegetables\nâ€¢ Greek yogurt + granola + berries\n\n**General Meal Structure:**\n\n**Every Meal Should Include:**\nâœ“ Protein source (palm-sized)\nâœ“ Colorful vegetables (2 fists)\nâœ“ Complex carb (cupped hand)\nâœ“ Healthy fat (thumb-sized)\n\n**Meal Frequency:**\nâ€¢ 3-6 meals daily (personal preference)\nâ€¢ Protein every 3-5 hours optimal\nâ€¢ Total daily intake > meal timing\n\n**Hydration Strategy:**\nâ€¢ Wake up: 500ml water\nâ€¢ With meals: 250-500ml\nâ€¢ During workout: 500-1000ml\nâ€¢ Throughout day: Sip continuously\nâ€¢ Total: 3-4L daily minimum\n\nConsistency > perfection. One meal won't make or break progress!"
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }
            
            // Cardio with specific protocols
            if (q.includes('cardio') || q.includes('running') || q.includes('endurance') || q.includes('hiit')) {
                const responses = [
                    "**Cardio Training Protocols**\n\n**LISS (Low-Intensity Steady State):**\nâ€¢ Duration: 30-60 minutes\nâ€¢ Intensity: 60-70% max heart rate\nâ€¢ Frequency: 3-5x weekly\nâ€¢ Examples: Walking, cycling, swimming\nâ€¢ Best for: Fat loss, recovery, beginners\nâ€¢ Calories: 200-400 per session\n\n**MISS (Moderate-Intensity):**\nâ€¢ Duration: 20-40 minutes\nâ€¢ Intensity: 70-80% max heart rate\nâ€¢ Frequency: 3-4x weekly\nâ€¢ Examples: Jogging, rowing, elliptical\nâ€¢ Best for: Cardiovascular fitness\nâ€¢ Calories: 300-500 per session\n\n**HIIT (High-Intensity Interval):**\nâ€¢ Duration: 15-25 minutes\nâ€¢ Work: 30-60 seconds at 85-95% max HR\nâ€¢ Rest: 1-2x work interval\nâ€¢ Frequency: 2-3x weekly\nâ€¢ Examples: Sprints, bike intervals, burpees\nâ€¢ Best for: Time-efficient fat loss, fitness\nâ€¢ Calories: 250-400 per session\n\n**Sample HIIT Workout:**\nâ€¢ Warm-up: 5 min easy\nâ€¢ Intervals: 30s sprint / 90s walk (8 rounds)\nâ€¢ Cool-down: 5 min easy\nâ€¢ Total: 22 minutes\n\n**Sample LISS Workout:**\nâ€¢ 45-minute brisk walk\nâ€¢ Heart rate: 120-130 BPM\nâ€¢ Morning on empty stomach (optional)\n\n**Which to Choose?**\nâ€¢ Fat loss: LISS + HIIT combination\nâ€¢ Endurance: MISS primarily\nâ€¢ Time-restricted: HIIT 2-3x weekly\nâ€¢ Recovery: LISS daily\n\n**Pro Tips:**\nâœ“ Don't do HIIT daily (recovery needed)\nâœ“ LISS doesn't interfere with strength\nâœ“ Track heart rate for intensity\nâœ“ Progressive overload applies to cardio too\n\nFind what you enjoy - adherence > optimization!",
                    
                    "**Advanced Cardio Strategies**\n\n**Concurrent Training (Cardio + Weights):**\n\n**Option 1: Separate Days**\nâ€¢ Weights: Mon, Wed, Fri\nâ€¢ Cardio: Tue, Thu, Sat\nâ€¢ Benefit: Maximum performance both\n\n**Option 2: Same Day (AM/PM Split)**\nâ€¢ AM: Weights (prioritized)\nâ€¢ PM: Cardio (4-6 hours later)\nâ€¢ Benefit: More recovery between sessions\n\n**Option 3: Same Session**\nâ€¢ Weights first (15-45 min)\nâ€¢ Then cardio (15-20 min)\nâ€¢ Benefit: Time-efficient\n\n**Cardio for Different Goals:**\n\n**Maximum Fat Loss:**\nâ€¢ Morning fasted walk: 30-45 min (5-6x weekly)\nâ€¢ Post-workout HIIT: 15 min (2-3x weekly)\nâ€¢ Daily steps: 10,000+\nâ€¢ Total weekly: 200-300 min\n\n**Muscle Building:**\nâ€¢ LISS only: 20-30 min (2-3x weekly)\nâ€¢ Keep intensity low\nâ€¢ Focus: Recovery, heart health\nâ€¢ Total weekly: 60-90 min\n\n**Athletic Performance:**\nâ€¢ Sport-specific intervals: 2-3x weekly\nâ€¢ Tempo runs: 1x weekly\nâ€¢ LISS recovery: 2x weekly\nâ€¢ Total weekly: 120-180 min\n\n**Interference Effect:**\nâš ï¸ Excessive cardio + weights = reduced muscle growth\nâœ“ Keep cardio moderate if building muscle\nâœ“ Adequate nutrition prevents interference\nâœ“ 3-4 sessions weekly is sweet spot\n\n**Heart Rate Zones:**\nâ€¢ Zone 1 (50-60%): Recovery\nâ€¢ Zone 2 (60-70%): Fat burning\nâ€¢ Zone 3 (70-80%): Aerobic fitness\nâ€¢ Zone 4 (80-90%): Threshold training\nâ€¢ Zone 5 (90-100%): Max effort\n\nBalance is key - don't neglect either!"
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }
            
            // Recovery with detailed protocols
            if (q.includes('rest') || q.includes('recover') || q.includes('sore') || q.includes('pain') || q.includes('sleep')) {
                const responses = [
                    "**Complete Recovery Protocol**\n\n**Sleep Optimization:**\nâ€¢ Target: 7-9 hours nightly\nâ€¢ Consistency: Same bedtime/wake time\nâ€¢ Environment: Dark, cool (18-20Â°C), quiet\nâ€¢ Pre-sleep routine: No screens 1 hour before\nâ€¢ Supplements: Magnesium 400mg, melatonin 0.5-3mg\n\n**Sleep Stages for Athletes:**\nâ€¢ Deep sleep: Muscle repair, growth hormone release\nâ€¢ REM sleep: Cognitive recovery, skill consolidation\nâ€¢ Need both: Don't sacrifice sleep for training!\n\n**Active Recovery Days:**\n\n**Light Activities:**\nâ€¢ 20-30 min walk or easy cycling\nâ€¢ Yoga or stretching routine\nâ€¢ Swimming (low intensity)\nâ€¢ Mobility work\n\n**Benefits:**\nâœ“ Increases blood flow to muscles\nâœ“ Reduces stiffness\nâœ“ Mental break from intense training\nâœ“ Maintains movement patterns\n\n**Managing Muscle Soreness (DOMS):**\n\n**Day 1-2 Post-Workout:**\nâ€¢ Light movement (walking)\nâ€¢ Foam rolling: 10-15 min\nâ€¢ Gentle stretching\nâ€¢ Hot/cold contrast therapy\n\n**Day 3-4:**\nâ€¢ Gradually increase activity\nâ€¢ Light training same muscle group OK\nâ€¢ Continue mobility work\n\n**When to Worry:**\nâš ï¸ Sharp, localized pain\nâš ï¸ Pain lasting >7 days\nâš ï¸ Swelling or bruising\nâš ï¸ Limited range of motion\nâ†’ See a professional!\n\n**Nutrition for Recovery:**\nâ€¢ Protein: 1.6-2.2g per kg daily\nâ€¢ Carbs: Replenish glycogen (3-5g per kg)\nâ€¢ Hydration: 3-4L water daily\nâ€¢ Anti-inflammatories: Omega-3, turmeric, tart cherry\n\n**Weekly Schedule Example:**\nâ€¢ Mon: Upper body\nâ€¢ Tue: Lower body\nâ€¢ Wed: Active recovery\nâ€¢ Thu: Upper body\nâ€¢ Fri: Lower body\nâ€¢ Sat: Cardio or active recovery\nâ€¢ Sun: Complete rest\n\nRecovery IS training. Prioritize it!",
                    
                    "**Advanced Recovery Techniques**\n\n**Periodized Recovery:**\n\n**Daily Recovery:**\nâ€¢ Post-workout: Protein + carbs within 2 hours\nâ€¢ Evening: Light walk (10-15 min)\nâ€¢ Night: 7-9 hours sleep\nâ€¢ Throughout: Hydration (3-4L)\n\n**Weekly Recovery:**\nâ€¢ 1-2 complete rest days\nâ€¢ 1 active recovery session\nâ€¢ Foam rolling: 3-4x weekly\nâ€¢ Stretching: Daily (10 min minimum)\n\n**Monthly Recovery:**\nâ€¢ Deload week every 4-6 weeks\nâ€¢ Reduce volume by 40-50%\nâ€¢ Maintain intensity\nâ€¢ Focus on technique\n\n**Quarterly Recovery:**\nâ€¢ 1-2 week break from gym\nâ€¢ Active lifestyle maintained\nâ€¢ Mental reset\nâ€¢ Addresses nagging issues\n\n**Recovery Modalities (Evidence-Based):**\n\n**Highly Effective:**\nâœ“ Sleep (most important!)\nâœ“ Adequate nutrition\nâœ“ Progressive overload management\nâœ“ Stress management\n\n**Moderately Effective:**\nâœ“ Massage (weekly)\nâœ“ Foam rolling\nâœ“ Stretching\nâœ“ Cold water immersion (post-training)\n\n**Limited Evidence:**\nâ€¢ Compression garments\nâ€¢ Ice baths (may reduce adaptation)\nâ€¢ TENS units\nâ€¢ Infrared saunas\n\n**Central Nervous System (CNS) Recovery:**\n\n**High CNS Stress:**\nâ€¢ Heavy squats, deadlifts (>85% 1RM)\nâ€¢ Olympic lifts\nâ€¢ Max effort sprints\nâ€¢ Competitive sports\n\n**Recovery Needed:**\nâ€¢ 48-72 hours between heavy sessions\nâ€¢ Avoid consecutive high-CNS days\nâ€¢ Adequate carbs (brain fuel)\nâ€¢ Stress management crucial\n\n**Signs of Overtraining:**\nâš ï¸ Persistent fatigue despite rest\nâš ï¸ Strength plateau or decrease\nâš ï¸ Elevated resting heart rate (+5-10 bpm)\nâš ï¸ Mood disturbances\nâš ï¸ Frequent illness\nâš ï¸ Insomnia or poor sleep\nâš ï¸ Loss of motivation\n\n**If Overtrained:**\n1. Take 7-14 days complete rest\n2. Evaluate training volume/intensity\n3. Assess life stress factors\n4. Improve sleep and nutrition\n5. Gradually return to training\n\nRest is not weakness - it's strategic!"
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }
            
            // Motivation with actionable strategies
            if (q.includes('motivat') || q.includes('consistent') || q.includes('start') || q.includes('begin') || q.includes('discipline')) {
                const responses = [
                    "**Building Unbreakable Consistency**\n\n**Phase 1: Foundation (Weeks 1-4)**\n\n**Start Ridiculously Small:**\nâ€¢ Week 1: Just show up to gym (even 15 min)\nâ€¢ Week 2: Complete one exercise\nâ€¢ Week 3: Full 30-min workout\nâ€¢ Week 4: Maintain 3x weekly\n\n**Why?** Success builds momentum. Small wins â†’ confidence â†’ bigger wins.\n\n**Phase 2: Habit Formation (Weeks 5-12)**\n\n**Implementation Intentions:**\nâ€¢ \"When X happens, I will Y\"\nâ€¢ Example: \"After morning coffee, I will workout\"\nâ€¢ Example: \"On Monday at 6 PM, I go to the gym\"\n\n**Environment Design:**\nâœ“ Gym bag packed night before\nâœ“ Workout clothes laid out\nâœ“ Pre-workout prepared\nâœ“ Remove barriers (gym near work/home)\n\n**Habit Stacking:**\nâ€¢ Link new habit to existing one\nâ€¢ \"After brushing teeth, I do 10 push-ups\"\nâ€¢ \"After lunch, I walk for 15 min\"\n\n**Phase 3: Identity Shift (Weeks 13+)**\n\n**From \"I want to workout\" to \"I AM someone who works out\"**\n\n**Evidence-Based Strategies:**\nâ€¢ Every workout = vote for fit identity\nâ€¢ Track workouts (visual proof)\nâ€¢ Tell others your identity\nâ€¢ Dress the part\nâ€¢ Join fitness communities\n\n**Motivation vs Discipline:**\n\n**Motivation:**\nâ€¢ Temporary emotional state\nâ€¢ Unreliable long-term\nâ€¢ Influenced by mood/energy\n\n**Discipline:**\nâ€¢ Deliberate action regardless of feeling\nâ€¢ Built through repetition\nâ€¢ Independent of emotion\n\n**Building Discipline:**\n1. Set non-negotiable minimum (e.g., 3x weekly)\n2. Schedule it like a meeting\n3. No decision-making on workout day\n4. Show up even if \"not feeling it\"\n5. Something > nothing always\n\n**The 2-Minute Rule:**\nâ€¢ Can't do 60 min? Do 10 min.\nâ€¢ Can't do heavy weights? Do bodyweight.\nâ€¢ Can't do gym? Do home workout.\nâ€¢ Can't workout? Just stretch.\n\nBreaking the zero is what matters!\n\n**Accountability Systems:**\nâœ“ Workout partner (social commitment)\nâœ“ Public declaration (Instagram, friends)\nâœ“ Betting app (financial stake)\nâœ“ Coach/trainer (external pressure)\nâœ“ GetFit streak tracker (gamification)\n\n**Dealing with Setbacks:**\nâ€¢ Missed 1 day? Not a problem.\nâ€¢ Missed 2 days? Get back ASAP.\nâ€¢ Missed 1 week? Restart with easier version.\n\n**Rule:** Never miss twice in a row.\n\n**Long-term Success:**\nâœ“ Focus on process, not outcome\nâœ“ Celebrate small wins\nâœ“ Track non-scale victories\nâœ“ Find activities you genuinely enjoy\nâœ“ Remember your WHY\n\nYou don't need motivation. You need a system! ðŸ”¥",
                    
                    "**Mental Game Mastery**\n\n**Your Brain on Exercise:**\n\n**Immediate Benefits:**\nâ€¢ Dopamine surge (reward chemical)\nâ€¢ Endorphins (natural high)\nâ€¢ Reduced cortisol (stress hormone)\nâ€¢ Improved focus for 2-3 hours post-workout\n\n**Long-term Benefits:**\nâ€¢ Neuroplasticity (brain adaptability)\nâ€¢ Increased BDNF (brain growth factor)\nâ€¢ Better sleep quality\nâ€¢ Reduced anxiety and depression\nâ€¢ Improved self-efficacy\n\n**Psychological Techniques:**\n\n**1. Goal Setting Framework:**\n\n**Outcome Goals (What you want):**\nâ€¢ \"Lose 10kg\"\nâ€¢ \"Bench 100kg\"\nâ€¢ \"Run 5K under 25 min\"\n\n**Process Goals (How to get there):**\nâ€¢ \"Train 4x weekly\"\nâ€¢ \"Hit protein target daily\"\nâ€¢ \"Sleep 8 hours nightly\"\n\n**Focus 80% on process, 20% on outcome.**\n\n**2. Visualization:**\nâ€¢ Close eyes before workout\nâ€¢ Visualize completing it successfully\nâ€¢ Imagine how you'll feel after\nâ€¢ See yourself as strong, capable\nâ€¢ 3-5 minutes daily\n\n**3. Self-Talk Reframe:**\n\n**Negative â†’ Positive:**\nâŒ \"I have to workout\" â†’ âœ… \"I GET to workout\"\nâŒ \"This is hard\" â†’ âœ… \"This is making me stronger\"\nâŒ \"I'm tired\" â†’ âœ… \"I'm pushing my limits\"\nâŒ \"I might fail\" â†’ âœ… \"I'm learning and growing\"\n\n**4. The 5-Second Rule:**\nâ€¢ When you feel resistance, count: 5-4-3-2-1\nâ€¢ Then physically move\nâ€¢ Interrupt overthinking\nâ€¢ Build action bias\n\n**5. Identity-Based Habits:**\n\n**Questions to ask:**\nâ€¢ \"What would a fit person do right now?\"\nâ€¢ \"How would my ideal self handle this?\"\nâ€¢ \"What choice aligns with who I want to be?\"\n\n**Common Mental Barriers:**\n\n**\"I don't have time\"**\nâ†’ You have time. It's about priorities. We find time for what matters.\n\n**\"I'm too tired\"**\nâ†’ Exercise creates energy. Start with 10 min. You'll feel better.\n\n**\"I'll start Monday\"**\nâ†’ Start today. Right now. Even 5 minutes counts.\n\n**\"I'm not seeing results\"**\nâ†’ Results take time. Trust the process. Track non-scale wins.\n\n**\"I'm not motivated\"**\nâ†’ Motivation follows action. Act first, feeling follows.\n\n**Creating Intrinsic Motivation:**\n\n**External (Short-term):**\nâ€¢ Look good for event\nâ€¢ Impress others\nâ€¢ Win competition\n\n**Internal (Sustainable):**\nâ€¢ Feel strong and capable\nâ€¢ Stress management\nâ€¢ Health and longevity\nâ€¢ Personal growth\nâ€¢ Daily energy\n\n**Shift focus to intrinsic for lasting change.**\n\n**The Compound Effect:**\nâ€¢ 1% better daily = 37x better yearly\nâ€¢ Small actions compound\nâ€¢ Consistency > intensity\nâ€¢ Time is your friend\n\n**Your Fitness Journey:**\nâ€¢ Month 1: Uncomfortable, building habit\nâ€¢ Month 2: Seeing small changes, gaining confidence\nâ€¢ Month 3: Habit forming, enjoying process\nâ€¢ Month 6: Noticeable results, identity shift\nâ€¢ Year 1: Completely transformed, unrecognizable\n\nYou're not just changing your body. You're becoming a different person. That takes time. Be patient. Trust the process. You've got this! ðŸ’ª"
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }
            
            // Supplements
            if (q.includes('supplement') || q.includes('protein powder') || q.includes('creatine') || q.includes('vitamins')) {
                return "**Evidence-Based Supplement Guide**\n\n**TIER 1: Proven Effective**\n\n**Creatine Monohydrate:**\nâ€¢ Dose: 5g daily (timing doesn't matter)\nâ€¢ Benefits: +5-15% strength, +2-5% muscle mass, cognitive benefits\nâ€¢ Loading: Optional (20g/day for 5-7 days)\nâ€¢ Cost: ~$20 for 100 days\nâ€¢ Safety: Most researched supplement, very safe\nâ€¢ Who: Everyone (especially vegetarians)\n\n**Protein Powder:**\nâ€¢ Dose: Fill gaps (target 1.6-2.2g/kg total daily)\nâ€¢ Types: Whey (fast), casein (slow), plant-based (vegans)\nâ€¢ Timing: Convenient, not magical\nâ€¢ Cost: ~$1-2 per serving\nâ€¢ Who: Those struggling to hit protein targets\n\n**Caffeine:**\nâ€¢ Dose: 3-6mg per kg bodyweight (pre-workout)\nâ€¢ Benefits: +3-5% strength, improved focus, fat oxidation\nâ€¢ Timing: 30-60 min before training\nâ€¢ Tolerance: Cycle off occasionally\nâ€¢ Sources: Coffee, pre-workout, caffeine pills\n\n**TIER 2: Helpful for Some**\n\n**Omega-3 (Fish Oil):**\nâ€¢ Dose: 2-3g EPA+DHA daily\nâ€¢ Benefits: Heart health, inflammation reduction, joint health\nâ€¢ Who: Those not eating fatty fish 2-3x weekly\n\n**Vitamin D:**\nâ€¢ Dose: 2000-4000 IU daily\nâ€¢ Benefits: Bone health, immune function, mood\nâ€¢ Who: Those with limited sun exposure\n\n**Multivitamin:**\nâ€¢ Quality brand with methylated B vitamins\nâ€¢ Insurance policy for micronutrient gaps\nâ€¢ Not a replacement for whole foods\n\n**TIER 3: Context-Dependent**\n\n**BCAAs:**\nâ€¢ Skip if eating enough protein (200g+)\nâ€¢ Potentially useful: Fasted training\nâ€¢ Otherwise: Waste of money\n\n**Pre-Workout:**\nâ€¢ Effective ingredients: Caffeine, citrulline, beta-alanine\nâ€¢ Avoid: Proprietary blends, excessive stimulants\nâ€¢ Can make your own cheaper\n\n**Beta-Alanine:**\nâ€¢ Dose: 3-5g daily\nâ€¢ Benefits: Improved endurance in 60-240 sec efforts\nâ€¢ Side effect: Harmless tingling\n\n**Citrulline Malate:**\nâ€¢ Dose: 6-8g pre-workout\nâ€¢ Benefits: Improved blood flow, reduced fatigue\nâ€¢ Better than arginine\n\n**AVOID/WASTE OF MONEY:**\nâŒ Fat burners (mostly caffeine + marketing)\nâŒ Testosterone boosters (don't work naturally)\nâŒ Mass gainers (just eat food)\nâŒ CLA (minimal effects)\nâŒ Glutamine (unnecessary if eating protein)\nâŒ Most \"proprietary blends\"\n\n**Priority Order:**\n1. Dial in whole food nutrition\n2. Add protein powder if needed\n3. Add creatine monohydrate\n4. Consider caffeine (coffee works)\n5. Add Vitamin D and Omega-3 if deficient\n6. Everything else is optional\n\n**Budget Supplement Stack:**\nâ€¢ Creatine monohydrate: $20/100 days\nâ€¢ Protein powder: $50/month\nâ€¢ Caffeine: Coffee $10/month\nâ€¢ **Total: $75/month**\n\n**The Truth:**\nSupplements are ~5% of results. Focus 95% effort on training, nutrition, sleep, consistency. Don't use supplements to fix a bad diet!";
            }
            
            // Injuries and pain
            if (q.includes('injury') || q.includes('hurt') || q.includes('painful') || q.includes('shoulder') || q.includes('back') || q.includes('knee')) {
                return "**Injury Prevention & Management**\n\n**STOP IMMEDIATELY IF:**\nðŸš¨ Sharp, stabbing pain\nðŸš¨ Pain that worsens with movement\nðŸš¨ Swelling or visible deformity\nðŸš¨ Numbness or tingling\nðŸš¨ Loss of range of motion\nâ†’ **See a medical professional immediately!**\n\n**Common Issues & Solutions:**\n\n**Lower Back Pain:**\nâ€¢ Likely cause: Poor bracing, rounding under load\nâ€¢ Fix: Master bracing (big breath, brace core)\nâ€¢ Exercises: McGill Big 3 (bird dog, side plank, curl-up)\nâ€¢ Avoid: Excessive flexion under load\nâ€¢ Deload: Reduce weight by 40-50% temporarily\n\n**Shoulder Pain:**\nâ€¢ Likely cause: Internal rotation, poor scapular control\nâ€¢ Fix: Face pulls, band pull-aparts, YTWs\nâ€¢ Exercises: Rotator cuff work 2-3x weekly\nâ€¢ Avoid: Excessive pressing without balance\nâ€¢ Ratio: 2 pulls for every 1 push\n\n**Knee Pain:**\nâ€¢ Likely cause: Valgus collapse, weak VMO, poor ankle mobility\nâ€¢ Fix: Knee-over-toe progression, terminal knee extensions\nâ€¢ Exercises: Peterson step-ups, ATG split squats\nâ€¢ Avoid: Letting knees cave inward\nâ€¢ Strengthen: Glutes, VMO, hip external rotators\n\n**Elbow Pain (Golfer's/Tennis Elbow):**\nâ€¢ Likely cause: Overuse, poor wrist/forearm strength\nâ€¢ Fix: Eccentric wrist curls, flexbar exercises\nâ€¢ Rest: Reduce volume temporarily\nâ€¢ Avoid: Excessive gripping exercises\n\n**Prevention Strategies:**\n\n**1. Proper Warm-up (10-15 min):**\nâ€¢ General: 5 min light cardio\nâ€¢ Dynamic stretching: Leg swings, arm circles\nâ€¢ Specific: Light sets of workout exercises\nâ€¢ Activation: Target weak areas\n\n**2. Progressive Overload:**\nâ€¢ Increase weight by 2.5-5kg weekly (not daily!)\nâ€¢ Don't ego lift\nâ€¢ Deload every 4-6 weeks\nâ€¢ Listen to body signals\n\n**3. Technique Over Weight:**\nâ€¢ Master form with light weight first\nâ€¢ Use full range of motion\nâ€¢ Control eccentric (lowering) phase\nâ€¢ Don't sacrifice form for reps/weight\n\n**4. Prehab Work:**\nâ€¢ Rotator cuff: 2x weekly\nâ€¢ Core: 3x weekly\nâ€¢ Hip flexors/glutes: 2x weekly\nâ€¢ Ankle mobility: Daily\n\n**5. Recovery:**\nâ€¢ Sleep: 7-9 hours\nâ€¢ Nutrition: Adequate protein, calories\nâ€¢ Stress management\nâ€¢ Active recovery days\n\n**Returning from Injury:**\n\n**Week 1-2: Pain-Free Movement**\nâ€¢ Range of motion exercises\nâ€¢ No loading\nâ€¢ Focus: Blood flow, healing\n\n**Week 3-4: Light Loading**\nâ€¢ Start at 30-40% previous weight\nâ€¢ High reps (15-20)\nâ€¢ Pain-free only\n\n**Week 5-8: Progressive Loading**\nâ€¢ Increase 5-10% weekly\nâ€¢ Monitor pain levels (should stay 0-2/10)\nâ€¢ Build back strength gradually\n\n**Week 9+: Return to Normal**\nâ€¢ Back to regular programming\nâ€¢ Continue prehab work\nâ€¢ Maintain mobility\n\n**Pain Scale Guide:**\nâ€¢ 0: No pain (good!)\nâ€¢ 1-2: Mild discomfort (OK to continue)\nâ€¢ 3-4: Moderate pain (reduce load)\nâ€¢ 5+: Significant pain (stop immediately)\n\n**Remember:** Pain is your body's warning system. Don't ignore it. Smart training beats tough training every time!";
            }
            
            // Default comprehensive response
            return "**Personalized Fitness Guidance**\n\n**Based on your question, here's a comprehensive approach:**\n\n**Training Foundation:**\nâ€¢ Frequency: 3-5x weekly (start lower, build up)\nâ€¢ Structure: Full body (beginners) or split (intermediate+)\nâ€¢ Progressive overload: Add weight/reps weekly\nâ€¢ Form first: Master technique before adding load\n\n**Nutrition Essentials:**\nâ€¢ Protein: 1.6-2.2g per kg bodyweight\nâ€¢ Calories: +200-500 for muscle, -300-500 for fat loss\nâ€¢ Hydration: 3-4L water daily\nâ€¢ Whole foods: 80% of diet minimum\nâ€¢ Meal timing: Less important than daily totals\n\n**Recovery Protocol:**\nâ€¢ Sleep: 7-9 hours nightly (non-negotiable)\nâ€¢ Rest days: 1-2 weekly minimum\nâ€¢ Active recovery: Light walks, yoga, stretching\nâ€¢ Deload: Every 4-6 weeks (reduce volume 40-50%)\nâ€¢ Listen to body: Persistent fatigue = back off\n\n**Mindset & Consistency:**\nâ€¢ Focus on process, not just outcomes\nâ€¢ Start small, build sustainable habits\nâ€¢ Track progress (photos, measurements, strength)\nâ€¢ Find activities you enjoy\nâ€¢ Celebrate small wins\nâ€¢ Be patient - real change takes 3-6 months\n\n**Common Mistakes to Avoid:**\nâŒ Trying to do everything at once\nâŒ Changing routine too frequently\nâŒ Under-eating protein\nâŒ Neglecting sleep\nâŒ Comparing to others\nâŒ All-or-nothing mindset\n\n**Next Steps:**\n1. Set one specific, measurable goal\n2. Create a simple, sustainable plan\n3. Start this week (don't wait for Monday)\n4. Track your progress\n5. Adjust based on results after 2-3 weeks\n\n**For more specific guidance, ask about:**\nâ€¢ Building muscle\nâ€¢ Losing fat\nâ€¢ Workout programs\nâ€¢ Meal planning\nâ€¢ Supplements\nâ€¢ Injury prevention\nâ€¢ Cardio protocols\nâ€¢ Motivation strategies\n\nRemember: Consistency beats perfection. The best program is the one you can stick to long-term. You've got this! ðŸ’ª";
        }
        
        // Fallback for when API fails
        function getFallbackResponse(question) {
            return getEnhancedResponse(question);
        }

        // Confetti Celebration Function
        function triggerConfetti() {
            const colors = ['#FF6B6B', '#4ECDC4', '#45B7D1', '#FFA07A', '#98D8C8', '#F7DC6F', '#BB8FCE', '#85C1E2'];
            const confettiCount = 100;
            
            for (let i = 0; i < confettiCount; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti-particle';
                    confetti.style.left = Math.random() * window.innerWidth + 'px';
                    confetti.style.top = '-10px';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.animationDelay = (Math.random() * 0.5) + 's';
                    confetti.style.animationDuration = (Math.random() * 2 + 2) + 's';
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => confetti.remove(), 3500);
                }, i * 30);
            }
        }
        
        // Goal Celebration
        function celebrateGoalsCompleted() {
            if (allGoalsCompletedToday) return; // Don't celebrate multiple times
            
            allGoalsCompletedToday = true;
            triggerConfetti();
            
            // Create celebration modal
            const celebration = document.createElement('div');
            celebration.className = 'goal-celebration';
            celebration.innerHTML = `
                <div style="font-size: 4rem; margin-bottom: 1rem;">ðŸŽ‰</div>
                <h2 style="font-size: 2rem; font-weight: 800; margin-bottom: 1rem; color: white;">
                    All Goals Completed!
                </h2>
                <p style="font-size: 1.2rem; color: rgba(255,255,255,0.9); margin-bottom: 2rem;">
                    Amazing work! You crushed all your goals today! ðŸ’ª
                </p>
                <button onclick="this.parentElement.remove()" 
                    style="background: linear-gradient(135deg, #32D74B 0%, #00D9FF 100%); 
                           color: black; padding: 1rem 2rem; border: none; border-radius: 1rem; 
                           font-weight: 700; cursor: pointer; font-size: 1.1rem;">
                    Awesome! ðŸš€
                </button>
            `;
            document.body.appendChild(celebration);
            
            // Auto-remove after 10 seconds
            setTimeout(() => {
                if (celebration.parentElement) {
                    celebration.remove();
                }
            }, 10000);
            
            showToast('ðŸŽ‰ Goals Completed!', 'You are on fire today! All goals accomplished!', 'success', 5000);
        }
        
        // Check if all goals are completed
        function checkGoalsCompletion() {
            const waterCompleted = dailyGoals.water.current >= dailyGoals.water.goal;
            const sleepCompleted = dailyGoals.sleep.current >= dailyGoals.sleep.goal;
            const stepsCompleted = dailyGoals.steps.current >= dailyGoals.steps.goal;
            
            dailyGoals.water.completed = waterCompleted;
            dailyGoals.sleep.completed = sleepCompleted;
            dailyGoals.steps.completed = stepsCompleted;
            
            // Get goal card elements
            const waterCard = document.getElementById('goal-water');
            const sleepCard = document.getElementById('goal-sleep');
            const stepsCard = document.getElementById('goal-steps');
            
            // Update checkmarks with animation
            const waterCheckmark = document.getElementById('water-checkmark');
            const sleepCheckmark = document.getElementById('sleep-checkmark');
            const stepsCheckmark = document.getElementById('steps-checkmark');
            
            // Water goal
            if (waterCompleted && !waterCheckmark.innerHTML) {
                waterCheckmark.innerHTML = '<span class="goal-completed-checkmark"></span>';
                waterCard.classList.add('completed');
                setTimeout(() => waterCard.classList.remove('completed'), 500);
            } else if (!waterCompleted) {
                waterCheckmark.innerHTML = '';
            }
            
            // Sleep goal
            if (sleepCompleted && !sleepCheckmark.innerHTML) {
                sleepCheckmark.innerHTML = '<span class="goal-completed-checkmark"></span>';
                sleepCard.classList.add('completed');
                setTimeout(() => sleepCard.classList.remove('completed'), 500);
            } else if (!sleepCompleted) {
                sleepCheckmark.innerHTML = '';
            }
            
            // Steps goal
            if (stepsCompleted && !stepsCheckmark.innerHTML) {
                stepsCheckmark.innerHTML = '<span class="goal-completed-checkmark"></span>';
                stepsCard.classList.add('completed');
                setTimeout(() => stepsCard.classList.remove('completed'), 500);
            } else if (!stepsCompleted) {
                stepsCheckmark.innerHTML = '';
            }
            
            // Update indicator with modern styling
            const completedCount = [waterCompleted, sleepCompleted, stepsCompleted].filter(Boolean).length;
            const indicator = document.getElementById('goals-completed-indicator');
            indicator.innerHTML = `<span style="color: var(--color-accent); font-weight: 600;">${completedCount}/3 Completed</span>`;
            
            // Add celebratory styling when all complete
            if (completedCount === 3) {
                indicator.style.background = 'linear-gradient(135deg, rgba(50, 215, 75, 0.2), rgba(0, 217, 255, 0.2))';
                indicator.style.borderColor = 'var(--color-accent)';
            } else {
                indicator.style.background = '';
                indicator.style.borderColor = '';
            }
            
            // Trigger celebration if all completed
            if (waterCompleted && sleepCompleted && stepsCompleted && !allGoalsCompletedToday) {
                celebrateGoalsCompleted();
            }
        }
        
        // Update goals UI
        function updateGoalsUI() {
            // Water
            document.getElementById('water-current').textContent = dailyGoals.water.current.toFixed(1);
            const waterPercent = (dailyGoals.water.current / dailyGoals.water.goal) * 100;
            document.getElementById('water-progress').style.width = Math.min(waterPercent, 100) + '%';
            
            // Sleep
            const sleepHours = Math.floor(dailyGoals.sleep.current);
            const sleepMinutes = Math.round((dailyGoals.sleep.current - sleepHours) * 60);
            document.getElementById('sleep-current').textContent = sleepHours;
            document.getElementById('sleep-minutes').textContent = sleepMinutes;
            
            // Steps (sync with userStats)
            document.getElementById('steps-current').textContent = dailyGoals.steps.current.toLocaleString();
            const stepsPercent = (dailyGoals.steps.current / dailyGoals.steps.goal) * 100;
            document.getElementById('steps-goal-progress').style.width = Math.min(stepsPercent, 100) + '%';
            
            checkGoalsCompletion();
            
            // Reinitialize icons after UI update
            setTimeout(() => window.createIcons?.(), 50);
        }
        
        function setWorkoutTab(tab) {
            const tabs = ['workout-library-tab', 'workout-routines-tab', 'workout-history-tab'];
            tabs.forEach(t => document.getElementById(t).classList.add('hidden'));
            document.getElementById(tab).classList.remove('hidden');
            
            document.querySelectorAll('.workout-tab').forEach(t => {
                t.classList.remove('border-green-500');
                t.classList.add('text-gray-400');
                t.style.color = '';
            });
            event.target.classList.add('border-green-500');
            event.target.classList.remove('text-gray-400');
            event.target.style.color = 'var(--color-accent)';
            
            // Load content based on tab
            if (tab === 'workout-routines-tab') {
                displayRoutines();
            } else if (tab === 'workout-history-tab') {
                displayHistory();
            }
        }

        // ===== WORKOUT TIMER FUNCTIONS =====
        
        // Timer state variables
        let timerInterval = null;
        let totalSeconds = 0;
        let isTimerRunning = false;
        
        /**
         * Format seconds into HH:MM:SS format
         * @param {number} seconds - Total seconds to format
         * @returns {string} Formatted time string
         */
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            
            return [hours, minutes, secs]
                .map(val => val.toString().padStart(2, '0'))
                .join(':');
        }
        
        /**
         * Start the workout timer
         */
        function startTimer() {
            if (isTimerRunning) return;
            
            isTimerRunning = true;
            
            // Update UI - Show Pause & Reset, Hide Start
            document.getElementById('start-workout-timer-btn').classList.add('hidden');
            document.getElementById('pause-workout-timer-btn').classList.remove('hidden');
            document.getElementById('reset-workout-timer-btn').classList.remove('hidden');
            
            // Update status
            document.getElementById('timer-status').textContent = 'Workout in progress... Keep going! ðŸ’ª';
            document.getElementById('timer-status').style.color = 'var(--color-accent)';
            
            // Start the interval
            timerInterval = setInterval(() => {
                totalSeconds++;
                document.getElementById('workout-timer-display').textContent = formatTime(totalSeconds);
            }, 1000);
            
            // Show toast notification
            showToast('Timer Started! â±ï¸', 'Your workout timer is now running. Give it your all!', 'success', 3000);
            
            // Reinitialize icons
            setTimeout(() => window.createIcons?.(), 50);
        }
        
        /**
         * Pause/Resume the workout timer
         */
        function pauseTimer() {
            if (!isTimerRunning) {
                // Resume functionality
                startTimer();
                return;
            }
            
            isTimerRunning = false;
            
            // Clear the interval
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            // Update button to show "Resume"
            const pauseBtn = document.getElementById('pause-workout-timer-btn');
            pauseBtn.innerHTML = '<i data-lucide="play" class="w-5 h-5"></i>Resume';
            pauseBtn.style.background = 'rgba(50, 215, 75, 0.2)';
            pauseBtn.style.borderColor = 'var(--color-accent)';
            pauseBtn.style.color = 'var(--color-accent)';
            
            // Update status
            document.getElementById('timer-status').textContent = 'Workout paused. Take a breath, then hit Resume!';
            document.getElementById('timer-status').style.color = '#FF9F0A';
            
            showToast('Timer Paused', 'Take a quick break if you need it!', 'info', 2000);
            
            // Reinitialize icons
            setTimeout(() => window.createIcons?.(), 50);
        }
        
        /**
         * Reset the workout timer and return to list view
         */
        function resetTimer() {
            // Stop the timer
            isTimerRunning = false;
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
            
            // Reset time
            totalSeconds = 0;
            document.getElementById('workout-timer-display').textContent = '00:00:00';
            
            // Reset UI - Show only Start button
            document.getElementById('start-workout-timer-btn').classList.remove('hidden');
            document.getElementById('pause-workout-timer-btn').classList.add('hidden');
            document.getElementById('reset-workout-timer-btn').classList.add('hidden');
            
            // Reset pause button to original state
            const pauseBtn = document.getElementById('pause-workout-timer-btn');
            pauseBtn.innerHTML = '<i data-lucide="pause" class="w-5 h-5"></i>Pause';
            pauseBtn.style.background = 'rgba(255, 159, 10, 0.2)';
            pauseBtn.style.borderColor = '#FF9F0A';
            pauseBtn.style.color = '#FF9F0A';
            
            // Reset status
            document.getElementById('timer-status').textContent = 'Ready to start your workout';
            document.getElementById('timer-status').style.color = 'rgba(174, 174, 178, 1)';
            
            // Exit active workout view and return to list
            exitActiveWorkout();
            
            showToast('Workout Completed! ðŸŽ‰', 'Great job! Timer has been reset.', 'success', 3000);
            
            // Reinitialize icons
            setTimeout(() => window.createIcons?.(), 50);
        }
        
        /**
         * Show the active workout timer view for a specific workout
         * @param {string} workoutName - Name of the workout routine
         */
        function showActiveWorkout(workoutName) {
            // Hide workout list view
            document.getElementById('workout-list-view').classList.add('hidden');
            
            // Show active timer view
            document.getElementById('active-timer-view').classList.remove('hidden');
            
            // Update the workout name display
            document.getElementById('active-workout-name').textContent = workoutName;
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            // Auto-start the timer
            setTimeout(() => {
                startTimer();
            }, 300);
            
            // Show toast
            showToast('Workout Started! ðŸ’ª', `Timer started for ${workoutName}`, 'success', 3000);
            
            // Reinitialize icons
            setTimeout(() => window.createIcons?.(), 100);
        }
        
        /**
         * Exit active workout and return to workout list
         */
        function exitActiveWorkout() {
            // Pause timer if running
            if (isTimerRunning) {
                pauseTimer();
            }
            
            // Hide active timer view
            document.getElementById('active-timer-view').classList.add('hidden');
            
            // Show workout list view
            document.getElementById('workout-list-view').classList.remove('hidden');
            
            // Reinitialize icons
            setTimeout(() => window.createIcons?.(), 50);
        }
        
        // ===== END WORKOUT TIMER FUNCTIONS =====
        
        // ===== NUTRITION TRACKING FUNCTIONS =====
        
        /**
         * Get today's date in YYYY-MM-DD format for filtering food logs
         * @returns {string} Today's date string
         */
        function getTodayDateString() {
            const today = new Date();
            return today.toISOString().split('T')[0];
        }
        
        /**
         * Log a food item to Firestore
         * @param {string} meal - Meal name (breakfast, lunch, dinner, snacks)
         * @param {string} foodName - Name of the food
         * @param {number} calories - Calorie content
         * @param {number} protein - Protein in grams
         * @param {number} carbs - Carbs in grams
         * @param {number} fat - Fat in grams
         */
        async function logFood(meal, foodName, calories, protein, carbs, fat) {
            if (!currentUser) {
                showToast('Error', 'You must be logged in to log food', 'error', 3000);
                return;
            }
            
            try {
                // Create a timestamped food log entry
                const foodLog = {
                    userId: currentUser.uid,
                    meal: meal,
                    foodName: foodName,
                    calories: parseFloat(calories) || 0,
                    protein: parseFloat(protein) || 0,
                    carbs: parseFloat(carbs) || 0,
                    fat: parseFloat(fat) || 0,
                    date: getTodayDateString(),
                    timestamp: new Date().toISOString()
                };
                
                // Save to Firestore foodLogs collection
                const foodLogsRef = window.firestoreCollection(window.firebaseDb, 'foodLogs');
                await window.firestoreAddDoc(foodLogsRef, foodLog);
                
                showToast('Food Logged! ðŸ½ï¸', `${foodName} added to ${meal}`, 'success', 2000);
                
                // Update the nutrition display
                await updateNutritionDisplay();
                
            } catch (error) {
                console.error('Error logging food:', error);
                showToast('Error', 'Failed to log food. Please try again.', 'error', 3000);
            }
        }
        
        /**
         * Delete a food log entry
         * @param {string} foodLogId - The ID of the food log to delete
         */
        async function deleteFoodLog(foodLogId) {
            if (!currentUser) return;
            
            try {
                const foodLogRef = window.firestoreDoc(window.firebaseDb, 'foodLogs', foodLogId);
                await window.firestoreDeleteDoc(foodLogRef);
                
                showToast('Food Removed', 'Food entry deleted', 'info', 2000);
                await updateNutritionDisplay();
                
            } catch (error) {
                console.error('Error deleting food log:', error);
                showToast('Error', 'Failed to delete food entry', 'error', 3000);
            }
        }
        
        /**
         * Update the nutrition display with today's data
         * Fetches food logs, calculates totals, and updates UI
         */
        async function updateNutritionDisplay() {
            if (!currentUser || !window.nutritionalGoals) {
                // Set default goals if not available
                if (!window.nutritionalGoals) {
                    window.nutritionalGoals = {
                        goalCalories: 2000,
                        goalProtein: 150,
                        goalCarbs: 200,
                        goalFat: 65
                    };
                }
                
                // Update goals display
                document.getElementById('calories-goal').textContent = window.nutritionalGoals.goalCalories;
                document.getElementById('protein-goal').textContent = window.nutritionalGoals.goalProtein;
                document.getElementById('carbs-goal').textContent = window.nutritionalGoals.goalCarbs;
                document.getElementById('fat-goal').textContent = window.nutritionalGoals.goalFat;
                
                // Reset consumed values
                document.getElementById('calories-consumed').textContent = '0';
                document.getElementById('protein-consumed').textContent = '0';
                document.getElementById('carbs-consumed').textContent = '0';
                document.getElementById('fat-consumed').textContent = '0';
                
                // Clear food lists
                ['breakfast', 'lunch', 'dinner', 'snacks'].forEach(meal => {
                    document.getElementById(`${meal}-food-list`).innerHTML = '';
                });
                
                return;
            }
            
            try {
                // Fetch today's food logs from Firestore
                const todayDate = getTodayDateString();
                const foodLogsRef = window.firestoreCollection(window.firebaseDb, 'foodLogs');
                const q = window.firestoreQuery(
                    foodLogsRef,
                    window.firestoreWhere('userId', '==', currentUser.uid),
                    window.firestoreWhere('date', '==', todayDate)
                );
                
                const querySnapshot = await window.firestoreGetDocs(q);
                
                // Calculate totals
                let totalCalories = 0;
                let totalProtein = 0;
                let totalCarbs = 0;
                let totalFat = 0;
                
                // Organize by meal
                const mealLogs = {
                    breakfast: [],
                    lunch: [],
                    dinner: [],
                    snacks: []
                };
                
                querySnapshot.forEach((doc) => {
                    const data = doc.data();
                    totalCalories += data.calories || 0;
                    totalProtein += data.protein || 0;
                    totalCarbs += data.carbs || 0;
                    totalFat += data.fat || 0;
                    
                    if (mealLogs[data.meal]) {
                        mealLogs[data.meal].push({
                            id: doc.id,
                            ...data
                        });
                    }
                });
                
                // Update goals display
                const goals = window.nutritionalGoals;
                document.getElementById('calories-goal').textContent = goals.goalCalories;
                document.getElementById('protein-goal').textContent = goals.goalProtein;
                document.getElementById('carbs-goal').textContent = goals.goalCarbs;
                document.getElementById('fat-goal').textContent = goals.goalFat;
                
                // Update consumed values
                document.getElementById('calories-consumed').textContent = Math.round(totalCalories);
                document.getElementById('protein-consumed').textContent = Math.round(totalProtein);
                document.getElementById('carbs-consumed').textContent = Math.round(totalCarbs);
                document.getElementById('fat-consumed').textContent = Math.round(totalFat);
                
                // Calculate remaining
                const caloriesRemaining = goals.goalCalories - totalCalories;
                const proteinRemaining = goals.goalProtein - totalProtein;
                const carbsRemaining = goals.goalCarbs - totalCarbs;
                const fatRemaining = goals.goalFat - totalFat;
                
                // Update remaining displays
                document.getElementById('calories-remaining').textContent = Math.round(Math.max(0, caloriesRemaining));
                document.getElementById('calories-remaining-small').textContent = Math.round(Math.max(0, caloriesRemaining));
                document.getElementById('protein-remaining').textContent = `${Math.round(Math.max(0, proteinRemaining))}g remaining`;
                document.getElementById('carbs-remaining').textContent = `${Math.round(Math.max(0, carbsRemaining))}g remaining`;
                document.getElementById('fat-remaining').textContent = `${Math.round(Math.max(0, fatRemaining))}g remaining`;
                
                // Update progress bars
                const proteinPercent = Math.min(100, (totalProtein / goals.goalProtein) * 100);
                const carbsPercent = Math.min(100, (totalCarbs / goals.goalCarbs) * 100);
                const fatPercent = Math.min(100, (totalFat / goals.goalFat) * 100);
                
                document.getElementById('protein-progress-bar').style.width = `${proteinPercent}%`;
                document.getElementById('carbs-progress-bar').style.width = `${carbsPercent}%`;
                document.getElementById('fat-progress-bar').style.width = `${fatPercent}%`;
                
                // Render food items in meal sections
                for (const [meal, foods] of Object.entries(mealLogs)) {
                    const listContainer = document.getElementById(`${meal}-food-list`);
                    
                    if (foods.length === 0) {
                        listContainer.innerHTML = '<p class="text-gray-400 text-sm py-2">No foods logged yet</p>';
                    } else {
                        listContainer.innerHTML = foods.map(food => `
                            <div class="flex items-center justify-between p-3 rounded-lg hover:bg-gray-700/50 transition" style="background: rgba(28, 28, 30, 0.4);">
                                <div class="flex-1">
                                    <p class="font-semibold">${food.foodName}</p>
                                    <p class="text-xs text-gray-400">
                                        ${Math.round(food.calories)} cal â€¢ 
                                        P: ${Math.round(food.protein)}g â€¢ 
                                        C: ${Math.round(food.carbs)}g â€¢ 
                                        F: ${Math.round(food.fat)}g
                                    </p>
                                </div>
                                <button onclick="deleteFoodLog('${food.id}')" class="ml-3 p-2 rounded-lg hover:bg-red-500/20 transition text-red-400">
                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                </button>
                            </div>
                        `).join('');
                    }
                }
                
                // Reinitialize icons
                setTimeout(() => window.createIcons?.(), 100);
                
            } catch (error) {
                console.error('Error updating nutrition display:', error);
            }
        }
        
        /**
         * Handle add food button click - prompt for manual input
         * @param {string} mealName - The meal to add food to
         */
        function handleAddFood(mealName) {
            const input = prompt(
                `Add food to ${mealName.charAt(0).toUpperCase() + mealName.slice(1)}\n\n` +
                `Enter: Food Name, Calories, Protein(g), Carbs(g), Fat(g)\n` +
                `Example: Grilled Chicken, 250, 45, 0, 8`
            );
            
            if (input) {
                const parts = input.split(',').map(p => p.trim());
                
                if (parts.length !== 5) {
                    showToast('Invalid Input', 'Please provide all 5 values separated by commas', 'error', 3000);
                    return;
                }
                
                const [foodName, calories, protein, carbs, fat] = parts;
                
                // Validate numeric values
                if (isNaN(calories) || isNaN(protein) || isNaN(carbs) || isNaN(fat)) {
                    showToast('Invalid Input', 'Calories and macros must be numbers', 'error', 3000);
                    return;
                }
                
                // Log the food
                logFood(mealName, foodName, calories, protein, carbs, fat);
            }
        }
        
        // ===== END NUTRITION TRACKING FUNCTIONS =====
        
        // ===== HEALTH TRACKING FUNCTIONS =====
        
        /**
         * Log a health metric to Firestore
         * @param {string} metricType - Type of metric ('sleep', 'water')
         * @param {number} value - The value to log or increment
         */
        async function logHealthMetric(metricType, value) {
            if (!currentUser) {
                showToast('Error', 'You must be logged in to log health metrics', 'error', 3000);
                return;
            }
            
            try {
                const todayDate = getTodayDateString();
                
                // Reference to today's health metric document
                // Document ID format: uid-YYYY-MM-DD
                const docId = `${currentUser.uid}-${todayDate}`;
                const healthMetricRef = window.firestoreDoc(window.firebaseDb, 'healthMetrics', docId);
                
                console.log('Logging health metric:', metricType, value);
                console.log('Document ID:', docId);
                
                let updateData = {
                    userId: currentUser.uid,
                    date: todayDate,
                    timestamp: new Date().toISOString()
                };
                
                if (metricType === 'water') {
                    // Fetch current count first for toast message
                    const healthMetricSnap = await window.firestoreGetDoc(healthMetricRef);
                    const currentWater = healthMetricSnap.exists() ? (healthMetricSnap.data().water || 0) : 0;
                    const newWater = currentWater + value;
                    
                    // Use atomic increment for water count to safely handle concurrent updates
                    updateData.water = window.firestoreIncrement(value);
                    
                    console.log('Water count:', currentWater, '->', newWater);
                    
                    // Update document
                    await window.firestoreSetDoc(healthMetricRef, updateData, { merge: true });
                    
                    showToast('Water Logged! ðŸ’§', `${newWater} ${newWater === 1 ? 'glass' : 'glasses'} today`, 'success', 2000);
                    
                } else if (metricType === 'sleep') {
                    // Set sleep hours directly
                    updateData.sleep = parseFloat(value) || 0;
                    
                    await window.firestoreSetDoc(healthMetricRef, updateData, { merge: true });
                    
                    showToast('Sleep Logged! ðŸ˜´', `${updateData.sleep} hours recorded`, 'success', 2000);
                }
                
                console.log('Health metric logged successfully');
                
                // Update the display to reflect new values
                await updateHealthDisplay();
                
            } catch (error) {
                console.error('Error logging health metric:', error);
                console.error('Error details:', error.message, error.code);
                showToast('Error', `Failed to log health metric: ${error.message}`, 'error', 3000);
            }
        }
        
        /**
         * Reset water count for today
         */
        async function resetWaterCount() {
            if (!currentUser) return;
            
            try {
                const todayDate = getTodayDateString();
                // Use consistent document ID format: uid-YYYY-MM-DD
                const docId = `${currentUser.uid}-${todayDate}`;
                const healthMetricRef = window.firestoreDoc(window.firebaseDb, 'healthMetrics', docId);
                
                await window.firestoreSetDoc(healthMetricRef, {
                    water: 0,
                    userId: currentUser.uid,
                    date: todayDate,
                    timestamp: new Date().toISOString()
                }, { merge: true });
                
                showToast('Water Reset', 'Water count reset to 0', 'info', 2000);
                await updateHealthDisplay();
                
            } catch (error) {
                console.error('Error resetting water:', error);
                showToast('Error', 'Failed to reset water count', 'error', 3000);
            }
        }
        
        /**
         * Reset sleep count for today
         */
        async function resetSleepCount() {
            if (!currentUser) return;
            
            try {
                const todayDate = getTodayDateString();
                // Use consistent document ID format: uid-YYYY-MM-DD
                const docId = `${currentUser.uid}-${todayDate}`;
                const healthMetricRef = window.firestoreDoc(window.firebaseDb, 'healthMetrics', docId);
                
                await window.firestoreSetDoc(healthMetricRef, {
                    sleep: 0,
                    userId: currentUser.uid,
                    date: todayDate,
                    timestamp: new Date().toISOString()
                }, { merge: true });
                
                showToast('Sleep Reset', 'Sleep hours reset to 0', 'info', 2000);
                await updateHealthDisplay();
                
            } catch (error) {
                console.error('Error resetting sleep:', error);
                showToast('Error', 'Failed to reset sleep count', 'error', 3000);
            }
        }
        
        /**
         * Update the health display with today's data
         * Fetches health metrics, calculates score, and updates UI
         */
        async function updateHealthDisplay() {
            // Use user's personalized health goals (fetched from Firestore)
            const sleepGoal = healthGoals.sleep;
            const waterGoal = healthGoals.water;
            
            // Update goal displays
            document.getElementById('sleep-goal-display').textContent = sleepGoal;
            document.getElementById('water-goal-display').textContent = waterGoal;
            
            if (!currentUser) {
                // Reset displays if not logged in
                document.getElementById('sleep-hours-display').textContent = '0';
                document.getElementById('water-count-display').textContent = '0';
                document.getElementById('health-score-display').textContent = '0';
                document.getElementById('health-score-label').textContent = 'Getting Started';
                document.getElementById('sleep-status').textContent = 'Log your sleep';
                document.getElementById('water-status').textContent = 'Stay hydrated!';
                
                // Reset progress indicators
                document.getElementById('sleep-progress-ring').style.strokeDashoffset = '351.86';
                document.getElementById('water-fill-bar').style.height = '0%';
                document.getElementById('health-score-bar').style.width = '0%';
                
                return;
            }
            
            try {
                // Fetch today's health metrics
                const todayDate = getTodayDateString();
                // Use consistent document ID format: uid-YYYY-MM-DD
                const docId = `${currentUser.uid}-${todayDate}`;
                const healthMetricRef = window.firestoreDoc(window.firebaseDb, 'healthMetrics', docId);
                const healthMetricSnap = await window.firestoreGetDoc(healthMetricRef);
                
                let sleepHours = 0;
                let waterCount = 0;
                
                if (healthMetricSnap.exists()) {
                    const data = healthMetricSnap.data();
                    sleepHours = data.sleep || 0;
                    waterCount = data.water || 0;
                }
                
                // Update sleep display
                document.getElementById('sleep-hours-display').textContent = sleepHours.toFixed(1);
                
                // Update sleep progress ring
                const sleepRatio = Math.min(1, sleepHours / sleepGoal);
                const circumference = 351.86;
                const sleepOffset = circumference - (sleepRatio * circumference);
                document.getElementById('sleep-progress-ring').style.strokeDashoffset = sleepOffset;
                
                // Update sleep status
                if (sleepHours === 0) {
                    document.getElementById('sleep-status').textContent = 'Log your sleep';
                } else if (sleepHours >= sleepGoal) {
                    document.getElementById('sleep-status').textContent = 'âœ… Goal achieved!';
                } else {
                    const remaining = sleepGoal - sleepHours;
                    document.getElementById('sleep-status').textContent = `${remaining.toFixed(1)}h to goal`;
                }
                
                // Update water display
                document.getElementById('water-count-display').textContent = waterCount;
                
                // Update water fill bar
                const waterRatio = Math.min(1, waterCount / waterGoal);
                document.getElementById('water-fill-bar').style.height = `${waterRatio * 100}%`;
                
                // Update water status
                if (waterCount === 0) {
                    document.getElementById('water-status').textContent = 'Stay hydrated!';
                } else if (waterCount >= waterGoal) {
                    document.getElementById('water-status').textContent = 'âœ… Goal achieved!';
                } else {
                    const remaining = waterGoal - waterCount;
                    document.getElementById('water-status').textContent = `${remaining} more to go`;
                }
                
                // Calculate health score
                const healthScore = Math.round(((sleepRatio + waterRatio) / 2) * 100);
                document.getElementById('health-score-display').textContent = healthScore;
                document.getElementById('health-score-bar').style.width = `${healthScore}%`;
                
                // Update health score label
                let scoreLabel = 'Getting Started';
                let scoreLabelColor = 'text-gray-400';
                
                if (healthScore >= 90) {
                    scoreLabel = 'ðŸŒŸ Excellent!';
                    scoreLabelColor = 'text-green-400';
                } else if (healthScore >= 75) {
                    scoreLabel = 'ðŸ’ª Great!';
                    scoreLabelColor = 'text-green-400';
                } else if (healthScore >= 50) {
                    scoreLabel = 'ðŸ‘ Good';
                    scoreLabelColor = 'text-blue-400';
                } else if (healthScore >= 25) {
                    scoreLabel = 'âš ï¸ Needs Improvement';
                    scoreLabelColor = 'text-orange-400';
                } else if (healthScore > 0) {
                    scoreLabel = 'ðŸ”´ Low';
                    scoreLabelColor = 'text-red-400';
                }
                
                const scoreLabelElement = document.getElementById('health-score-label');
                scoreLabelElement.textContent = scoreLabel;
                scoreLabelElement.className = `text-lg font-bold mb-2 ${scoreLabelColor}`;
                
                // Reinitialize icons
                setTimeout(() => window.createIcons?.(), 100);
                
            } catch (error) {
                console.error('Error updating health display:', error);
            }
        }
        
        // ===== END HEALTH TRACKING FUNCTIONS =====
        
        // ===== SETTINGS MANAGEMENT FUNCTIONS =====
        
        /**
         * Load and display all settings data
         * Fetches current user data and populates settings UI
         */
        async function loadSettingsData() {
            if (!currentUser) {
                // Reset displays if not logged in
                document.getElementById('settings-name-display').textContent = '-';
                document.getElementById('settings-email-display').textContent = '-';
                document.getElementById('settings-avatar-initial').textContent = 'U';
                return;
            }
            
            try {
                // Fetch user data from Firestore
                const userRef = window.firestoreDoc(window.firebaseDb, 'users', currentUser.uid);
                const userSnap = await window.firestoreGetDoc(userRef);
                
                // Update profile display
                const displayName = userName || 'User';
                document.getElementById('settings-name-display').textContent = displayName;
                document.getElementById('settings-email-display').textContent = currentUser.email || '-';
                
                // Update avatar initial (first letter of name)
                const initial = displayName.charAt(0).toUpperCase();
                document.getElementById('settings-avatar-initial').textContent = initial;
                
                // Load avatar if exists
                if (userSnap.exists() && userSnap.data().photoURL) {
                    const avatarImg = document.getElementById('settings-avatar-img');
                    const avatarInitial = document.getElementById('settings-avatar-initial');
                    
                    avatarImg.src = userSnap.data().photoURL;
                    avatarImg.classList.remove('hidden');
                    avatarInitial.classList.add('hidden');
                } else {
                    // Show initial if no photo
                    const avatarImg = document.getElementById('settings-avatar-img');
                    const avatarInitial = document.getElementById('settings-avatar-initial');
                    avatarImg.classList.add('hidden');
                    avatarInitial.classList.remove('hidden');
                }
                
                // Update nutrition goals
                if (window.nutritionalGoals) {
                    document.getElementById('settings-calories-goal').textContent = window.nutritionalGoals.goalCalories || 2000;
                    document.getElementById('settings-protein-goal').textContent = window.nutritionalGoals.goalProtein || 150;
                    document.getElementById('settings-carbs-goal').textContent = window.nutritionalGoals.goalCarbs || 200;
                    document.getElementById('settings-fat-goal').textContent = window.nutritionalGoals.goalFat || 65;
                }
                
                // Fetch and update health goals from Firestore
                if (userSnap.exists() && userSnap.data().healthGoals) {
                    healthGoals.water = userSnap.data().healthGoals.water || 8;
                    healthGoals.sleep = userSnap.data().healthGoals.sleep || 8;
                }
                
                document.getElementById('settings-water-goal').textContent = healthGoals.water;
                document.getElementById('settings-sleep-goal').textContent = healthGoals.sleep;
                
                // Reinitialize icons
                setTimeout(() => window.createIcons?.(), 100);
                
            } catch (error) {
                console.error('Error loading settings data:', error);
            }
        }
        
        /**
         * Update user profile information
         */
        async function updateProfile() {
            if (!currentUser) {
                showToast('Error', 'You must be logged in to update your profile', 'error', 3000);
                return;
            }
            
            const newName = await showPrompt('Edit Profile', 'Enter your new name:', userName, 'Your name');
            
            if (newName && newName.trim() !== '') {
                try {
                    const userRef = window.firestoreDoc(window.firebaseDb, 'users', currentUser.uid);
                    await window.firestoreSetDoc(userRef, {
                        displayName: newName.trim()
                    }, { merge: true });
                    
                    userName = newName.trim();
                    showToast('Profile Updated! âœ…', 'Your name has been updated successfully', 'success', 3000);
                    
                    // Refresh displays
                    loadSettingsData();
                    document.getElementById('user-name').textContent = userName;
                    document.getElementById('dashboard-name').textContent = userName;
                    
                } catch (error) {
                    console.error('Error updating profile:', error);
                    showToast('Error', 'Failed to update profile. Please try again.', 'error', 3000);
                }
            }
        }
        
        /**
         * Trigger avatar upload
         */
        function changeAvatar() {
            const input = document.getElementById('avatar-upload-input');
            input.click();
            
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                // Validate file type
                if (!file.type.startsWith('image/')) {
                    showToast('Invalid File', 'Please select an image file', 'error', 3000);
                    return;
                }
                
                // Validate file size (max 5MB)
                if (file.size > 5 * 1024 * 1024) {
                    showToast('File Too Large', 'Image must be less than 5MB', 'error', 3000);
                    return;
                }
                
                await uploadAvatar(file);
            };
        }
        
        /**
         * Upload avatar to Firebase Storage
         */
        async function uploadAvatar(file) {
            if (!currentUser) {
                showToast('Error', 'You must be logged in to upload an avatar', 'error', 3000);
                return;
            }
            
            try {
                showToast('Uploading...', 'Your photo is being uploaded', 'info', 2000);
                
                // Create storage reference
                const fileExt = file.name.split('.').pop();
                const fileName = `avatars/${currentUser.uid}.${fileExt}`;
                const storageRef = window.firebaseStorageRef(window.firebaseStorage, fileName);
                
                // Upload file
                await window.firebaseUploadBytes(storageRef, file);
                
                // Get download URL
                const downloadURL = await window.firebaseGetDownloadURL(storageRef);
                
                // Save URL to Firestore
                const userRef = window.firestoreDoc(window.firebaseDb, 'users', currentUser.uid);
                await window.firestoreSetDoc(userRef, {
                    photoURL: downloadURL
                }, { merge: true });
                
                // Update display
                const avatarImg = document.getElementById('settings-avatar-img');
                const avatarInitial = document.getElementById('settings-avatar-initial');
                
                avatarImg.src = downloadURL;
                avatarImg.classList.remove('hidden');
                avatarInitial.classList.add('hidden');
                
                showToast('Photo Updated! ðŸ“¸', 'Your profile photo has been changed', 'success', 3000);
                
                // Clear input
                document.getElementById('avatar-upload-input').value = '';
                
            } catch (error) {
                console.error('Error uploading avatar:', error);
                showToast('Upload Failed', 'Failed to upload photo. Please try again.', 'error', 3000);
            }
        }
        
        /**
         * Change password functionality
         */
        async function changePassword() {
            if (!currentUser) {
                showToast('Error', 'You must be logged in to change password', 'error', 3000);
                return;
            }
            
            const passwords = await showForm('Change Password', [
                {
                    label: 'Current Password',
                    type: 'password',
                    id: 'currentPassword',
                    placeholder: 'Enter current password',
                    required: true
                },
                {
                    label: 'New Password',
                    type: 'password',
                    id: 'newPassword',
                    placeholder: 'Enter new password (min. 6 characters)',
                    required: true,
                    min: 6
                },
                {
                    label: 'Confirm New Password',
                    type: 'password',
                    id: 'confirmPassword',
                    placeholder: 'Confirm new password',
                    required: true
                }
            ]);
            
            if (!passwords) return;
            
            // Validate password length
            if (passwords.newPassword.length < 6) {
                showToast('Invalid Password', 'Password must be at least 6 characters', 'error', 3000);
                return;
            }
            
            // Validate password match
            if (passwords.newPassword !== passwords.confirmPassword) {
                showToast('Password Mismatch', 'Passwords do not match', 'error', 3000);
                return;
            }
            
            try {
                // Re-authenticate user before changing password
                const credential = window.firebaseEmailAuthProvider.credential(
                    currentUser.email,
                    passwords.currentPassword
                );
                await window.firebaseReauthenticateWithCredential(currentUser, credential);
                
                // Update password
                await window.firebaseUpdatePassword(currentUser, passwords.newPassword);
                
                showToast('Password Changed! ðŸ”’', 'Your password has been updated successfully', 'success', 3000);
            } catch (error) {
                console.error('Error changing password:', error);
                if (error.code === 'auth/wrong-password') {
                    showToast('Error', 'Current password is incorrect', 'error', 3000);
                } else if (error.code === 'auth/weak-password') {
                    showToast('Error', 'Password is too weak', 'error', 3000);
                } else {
                    showToast('Error', 'Failed to change password. Please try again.', 'error', 3000);
                }
            }
        }
        
        /**
         * Navigate to premium upgrade page
         */
        function upgradeToPremium() {
            showToast('Coming Soon! ðŸ‘‘', 'Premium features will be available soon. Stay tuned!', 'info', 3000);
        }
        
        /**
         * Handle units of measurement change
         */
        async function changeUnits(unit) {
            if (!currentUser) {
                showToast('Error', 'You must be logged in to change units', 'error', 3000);
                return;
            }
            
            try {
                const userRef = window.firestoreDoc(window.firebaseDb, 'users', currentUser.uid);
                await window.firestoreSetDoc(userRef, {
                    settings: {
                        units: unit
                    }
                }, { merge: true });
                
                showToast('Units Updated! ðŸ“', `Now using ${unit === 'metric' ? 'Metric' : 'Imperial'} units`, 'success', 2000);
            } catch (error) {
                console.error('Error updating units:', error);
                showToast('Error', 'Failed to update units', 'error', 3000);
            }
        }
        
        /**
         * Open notification settings
         */
        function openNotificationSettings() {
            showToast('Notification Settings', 'Push notifications, reminders, and goal alerts can be configured here', 'info', 3000);
        }
        
        /**
         * Connect to Apple Health
         */
        function connectAppleHealth() {
            showToast('Apple Health', 'Apple Health integration requires native iOS app. Coming soon!', 'info', 3000);
        }
        
        /**
         * Connect wearable devices
         */
        function connectWearables() {
            showToast('Wearable Devices', 'Connect your Fitbit, Garmin, or other wearables. Coming soon!', 'info', 3000);
        }
        
        /**
         * Export health data
         */
        async function exportHealthData() {
            if (!currentUser) {
                showToast('Error', 'You must be logged in to export data', 'error', 3000);
                return;
            }
            
            try {
                showToast('Preparing Export... ðŸ“¦', 'Gathering your health data...', 'info', 2000);
                
                // Fetch all user data
                const userData = {
                    profile: {
                        name: userName,
                        email: currentUser.email,
                        uid: currentUser.uid
                    },
                    nutritionalGoals: window.nutritionalGoals || {},
                    exportDate: new Date().toISOString()
                };
                
                // Create downloadable JSON file
                const dataStr = JSON.stringify(userData, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                
                const link = document.createElement('a');
                link.href = url;
                link.download = `fitness-data-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                showToast('Export Complete! âœ…', 'Your data has been downloaded', 'success', 3000);
            } catch (error) {
                console.error('Error exporting data:', error);
                showToast('Error', 'Failed to export data', 'error', 3000);
            }
        }
        
        /**
         * Open help center
         */
        function openHelpCenter() {
            showToast('Help Center', 'Opening help documentation...', 'info', 2000);
            // In production, this would open a help page
            window.open('https://github.com', '_blank');
        }
        
        /**
         * Contact support
         */
        function contactSupport() {
            const email = 'support@fitnessapp.com';
            showToast('Contact Support', `Email us at ${email}`, 'info', 3000);
            // In production, this would open a support form or email client
        }
        
        /**
         * Open privacy policy
         */
        function openPrivacyPolicy() {
            showToast('Privacy Policy', 'Opening privacy policy...', 'info', 2000);
            window.open('https://github.com', '_blank');
        }
        
        /**
         * Open terms of service
         */
        function openTermsOfService() {
            showToast('Terms of Service', 'Opening terms of service...', 'info', 2000);
            window.open('https://github.com', '_blank');
        }
        
        /**
         * Delete account
         */
        async function deleteAccount() {
            if (!currentUser) {
                showToast('Error', 'You must be logged in', 'error', 3000);
                return;
            }
            
            const confirmation = await showPrompt(
                'âš ï¸ Delete Account',
                'âš ï¸ WARNING: This action is IRREVERSIBLE!\n\nAll your data will be permanently deleted.\n\nType "DELETE" in capital letters to confirm:',
                '',
                'Type DELETE to confirm'
            );
            
            if (confirmation !== 'DELETE') {
                showToast('Cancelled', 'Account deletion cancelled', 'info', 2000);
                return;
            }
            
            const password = await showPrompt('Confirm Password', 'Enter your password to confirm deletion:', '', 'Your password', 'password');
            if (!password) return;
            
            try {
                // Re-authenticate before deletion
                const credential = window.firebaseEmailAuthProvider.credential(
                    currentUser.email,
                    password
                );
                await window.firebaseReauthenticateWithCredential(currentUser, credential);
                
                // Delete user document from Firestore
                const userRef = window.firestoreDoc(window.firebaseDb, 'users', currentUser.uid);
                await window.firestoreDeleteDoc(userRef);
                
                // Delete Firebase Auth account
                await window.firebaseDeleteUser(currentUser);
                
                showToast('Account Deleted', 'Your account has been permanently deleted', 'info', 3000);
                
                // Reset state and navigate to login
                currentUser = null;
                userName = '';
                setTimeout(() => {
                    updateUIState('login-view');
                }, 1500);
                
            } catch (error) {
                console.error('Error deleting account:', error);
                if (error.code === 'auth/wrong-password') {
                    showToast('Error', 'Password is incorrect', 'error', 3000);
                } else {
                    showToast('Error', 'Failed to delete account. Please try again.', 'error', 3000);
                }
            }
        }
        
        /**
         * Update nutrition goals
         */
        async function updateNutritionGoals() {
            if (!currentUser) {
                showToast('Error', 'You must be logged in to update goals', 'error', 3000);
                return;
            }
            
            const currentGoals = window.nutritionalGoals || {
                goalCalories: 2000,
                goalProtein: 150,
                goalCarbs: 200,
                goalFat: 65
            };
            
            const goals = await showForm('Update Nutrition Goals', [
                {
                    label: 'Daily Calories (kcal)',
                    type: 'number',
                    id: 'calories',
                    placeholder: 'e.g., 2000',
                    defaultValue: currentGoals.goalCalories,
                    required: true,
                    min: 1000,
                    max: 5000
                },
                {
                    label: 'Protein (g)',
                    type: 'number',
                    id: 'protein',
                    placeholder: 'e.g., 150',
                    defaultValue: currentGoals.goalProtein,
                    required: true,
                    min: 0,
                    max: 500
                },
                {
                    label: 'Carbohydrates (g)',
                    type: 'number',
                    id: 'carbs',
                    placeholder: 'e.g., 200',
                    defaultValue: currentGoals.goalCarbs,
                    required: true,
                    min: 0,
                    max: 1000
                },
                {
                    label: 'Fat (g)',
                    type: 'number',
                    id: 'fat',
                    placeholder: 'e.g., 65',
                    defaultValue: currentGoals.goalFat,
                    required: true,
                    min: 0,
                    max: 300
                }
            ]);
            
            if (!goals) return;
            
            try {
                const userRef = window.firestoreDoc(window.firebaseDb, 'users', currentUser.uid);
                const newGoals = {
                    goalCalories: goals.calories,
                    goalProtein: goals.protein,
                    goalCarbs: goals.carbs,
                    goalFat: goals.fat
                };
                
                await window.firestoreSetDoc(userRef, {
                    nutritionalGoals: newGoals
                }, { merge: true });
                
                window.nutritionalGoals = newGoals;
                showToast('Goals Updated! ðŸŽ¯', 'Your nutrition goals have been updated', 'success', 3000);
                
                // Refresh displays
                loadSettingsData();
                updateNutritionDisplay();
                
            } catch (error) {
                console.error('Error updating nutrition goals:', error);
                showToast('Error', 'Failed to update goals. Please try again.', 'error', 3000);
            }
        }
        
        /**
         * Update health goals (water and sleep)
         */
        async function updateHealthGoals() {
            if (!currentUser) {
                showToast('Error', 'You must be logged in to update goals', 'error', 3000);
                return;
            }
            
            const goals = await showForm('Update Health Goals', [
                {
                    label: 'Water Goal (glasses per day)',
                    type: 'number',
                    id: 'water',
                    placeholder: 'e.g., 8',
                    defaultValue: 8,
                    required: true,
                    min: 1,
                    max: 20,
                    step: 1
                },
                {
                    label: 'Sleep Goal (hours per night)',
                    type: 'number',
                    id: 'sleep',
                    placeholder: 'e.g., 8',
                    defaultValue: 8,
                    required: true,
                    min: 4,
                    max: 12,
                    step: 0.5
                }
            ]);
            
            if (!goals) return;
            
            try {
                const userRef = window.firestoreDoc(window.firebaseDb, 'users', currentUser.uid);
                await window.firestoreSetDoc(userRef, {
                    healthGoals: {
                        water: goals.water,
                        sleep: goals.sleep
                    }
                }, { merge: true });
                
                // Update global health goals
                healthGoals.water = goals.water;
                healthGoals.sleep = goals.sleep;
                
                showToast('Health Goals Updated! ðŸ’ª', 'Your health goals have been updated', 'success', 3000);
                
                // Refresh displays
                loadSettingsData();
                updateHealthDisplay();
                
            } catch (error) {
                console.error('Error updating health goals:', error);
                showToast('Error', 'Failed to update goals. Please try again.', 'error', 3000);
            }
        }
        
        /**
         * Handle user logout
         */
        async function handleLogout() {
            try {
                const confirmed = await showConfirm(
                    'Log Out? ðŸ‘‹',
                    'Are you sure you want to log out?',
                    'Log Out',
                    'Cancel'
                );
                
                if (confirmed) {
                    // Sign out from Firebase
                    await window.firebaseSignOut(window.firebaseAuth);
                    
                    // Clear current user
                    currentUser = null;
                    userName = '';
                    userStats = {};
                    
                    // Show toast
                    showToast('Logged Out', 'You have been logged out successfully', 'info', 2000);
                    
                    // Navigate to login view
                    updateUIState('login-view');
                }
                
            } catch (error) {
                console.error('Error logging out:', error);
                showToast('Error', 'Failed to log out. Please try again.', 'error', 3000);
            }
        }
        
        // ===== END SETTINGS MANAGEMENT FUNCTIONS =====
        
        function displayRoutines() {
            const html = myRoutines.length > 0 ? myRoutines.map(r => `
                <div class="p-4 rounded-xl" style="background-color: var(--color-card);">
                    <h3 class="font-semibold text-lg">${r.name}</h3>
                    <p class="text-sm text-gray-400 mt-1">${r.workouts.join(', ')}</p>
                    <div class="flex items-center justify-between mt-3">
                        <span class="text-sm text-gray-400">${r.duration} min â€¢ Created ${r.created}</span>
                        <button onclick="startRoutine(${r.id})" class="px-4 py-2 rounded-lg text-black font-semibold text-sm" style="background-color: var(--color-accent);">
                            Start
                        </button>
                    </div>
                </div>
            `).join('') : '<p class="text-center text-gray-400 py-12 col-span-2">No custom routines yet. Create one!</p>';
            
            document.getElementById('routines-list').innerHTML = html;
        }
        
        function displayHistory() {
            const html = workoutHistory.map(h => `
                <div class="p-4 rounded-xl flex items-center justify-between" style="background-color: var(--color-card);">
                    <div>
                        <h3 class="font-semibold">${h.name}</h3>
                        <p class="text-sm text-gray-400">${h.date} â€¢ ${h.duration} min â€¢ ${h.calories} cal</p>
                    </div>
                    <button onclick="repeatWorkout('${h.name}')" class="px-4 py-2 rounded-lg border border-gray-600 text-sm font-semibold hover:bg-gray-700">
                        Repeat
                    </button>
                </div>
            `).join('');
            
            document.getElementById('history-list').innerHTML = html;
        }
        
        function createNewRoutine() {
            const name = prompt('Enter routine name:');
            if (name) {
                showModal('Routine Creation ðŸ‹ï¸', `Creating "${name}"! Select workouts from the library to build your custom routine.`, 'info');
            }
        }
        
        async function startRoutine(id) {
            const routine = myRoutines.find(r => r.id === id);
            const confirmed = await showConfirm(
                'Start Routine? ðŸ‹ï¸', 
                `${routine.name}\nTotal duration: ${routine.duration} minutes\n\nWorkouts:\n${routine.workouts.join(', ')}`,
                'Start Now',
                'Cancel'
            );
            if (confirmed) {
                // Launch the workout timer view with the routine name
                showActiveWorkout(routine.name);
            }
        }
        
        async function repeatWorkout(name) {
            const confirmed = await showConfirm('Repeat Workout? ðŸ”„', `Ready to do ${name} again?`, 'Start Workout', 'Cancel');
            if (confirmed) {
                // Launch the workout timer view with the workout name
                showActiveWorkout(name);
            }
        }
        
        // Social Features
        function searchFriends() {
            const query = document.getElementById('friend-search').value.toLowerCase();
            if (!query) {
                showToast('Search Required', 'Please enter a name or username to search', 'warning', 2500);
                return;
            }
            
            const results = availableFriends.filter(f => 
                !friends.some(friend => friend.id === f.id) &&
                (f.name.toLowerCase().includes(query) || f.username.toLowerCase().includes(query))
            );
            
            if (results.length === 0) {
                document.getElementById('friend-search-results').innerHTML = '<p class="text-gray-400 text-sm">No users found</p>';
                return;
            }
            
            const html = results.map(u => `
                <div class="flex items-center justify-between p-3 rounded-lg bg-gray-700">
                    <div class="flex items-center">
                        <img src="${u.image}" alt="${u.name}" class="w-10 h-10 rounded-full mr-3">
                        <div>
                            <h4 class="font-semibold">${u.name}</h4>
                            <p class="text-xs text-gray-400">@${u.username} â€¢ ${u.workouts} workouts</p>
                        </div>
                    </div>
                    <button onclick="addFriend(${u.id})" class="px-4 py-1 rounded-lg text-black font-semibold text-sm" style="background-color: var(--color-accent);">
                        Add Friend
                    </button>
                </div>
            `).join('');
            
            document.getElementById('friend-search-results').innerHTML = html;
        }
        
        function addFriend(id) {
            const friend = availableFriends.find(f => f.id === id);
            if (friend && !friends.some(f => f.id === id)) {
                friends.push(friend);
                displayFriends();
                searchFriends(); // Refresh search results
                showToast('Friend Added! ðŸ‘¥', `${friend.name} is now your friend!`, 'success', 3000);
            }
        }
        
        async function removeFriend(id) {
            const confirmed = await showConfirm('Remove Friend?', 'Are you sure you want to remove this friend?', 'Remove', 'Cancel');
            if (confirmed) {
                const friend = friends.find(f => f.id === id);
                friends = friends.filter(f => f.id !== id);
                displayFriends();
                showToast('Friend Removed', `${friend?.name || 'Friend'} has been removed`, 'info', 2500);
            }
        }
        
        function displayFriends() {
            document.getElementById('friends-count').textContent = friends.length;
            
            if (friends.length === 0) {
                document.getElementById('friends-list').innerHTML = '<p class="text-gray-400 text-sm">No friends yet. Search and add friends above!</p>';
                return;
            }
            
            const html = friends.map(f => `
                <div class="flex items-center justify-between p-3 rounded-lg bg-gray-700">
                    <div class="flex items-center">
                        <img src="${f.image}" alt="${f.name}" class="w-10 h-10 rounded-full mr-3">
                        <div>
                            <h4 class="font-semibold">${f.name}</h4>
                            <p class="text-xs text-gray-400">@${f.username} â€¢ ${f.workouts} workouts</p>
                        </div>
                    </div>
                    <button onclick="removeFriend(${f.id})" class="px-4 py-1 rounded-lg border border-gray-600 text-sm font-semibold hover:bg-gray-600">
                        Remove
                    </button>
                </div>
            `).join('');
            
            document.getElementById('friends-list').innerHTML = html;
        }
        
        // ===== SOCIAL VIEW DATA FETCHING FUNCTIONS =====
        
        /**
         * Fetch global leaderboard data from Firestore
         * Returns top 10 users by total workouts completed
         */
        async function fetchLeaderboard() {
            try {
                const usersCol = window.firestoreCollection(window.firebaseDb, 'users');
                const q = window.firestoreQuery(
                    usersCol,
                    window.firestoreOrderBy('stats.totalWorkouts', 'desc'),
                    window.firestoreLimit(10)
                );
                const querySnapshot = await window.firestoreGetDocs(q);
                return querySnapshot.docs.map((doc, index) => ({
                    id: doc.id,
                    name: doc.data().displayName || 'Unknown User',
                    totalWorkoutsCompleted: doc.data().stats?.totalWorkouts || 0,
                    rank: index + 1
                }));
            } catch (error) {
                console.error('Error fetching leaderboard:', error);
                return [];
            }
        }
        
        /**
         * Fetch friends' recent activity from Firestore
         * Returns recent workouts completed by user's friends
         */
        async function fetchFriendsActivity() {
            if (!currentUser || !userData.friends || userData.friends.length === 0) {
                console.log('No friends to fetch activity for');
                return [];
            }
            
            try {
                const workoutsCol = window.firestoreCollection(window.firebaseDb, 'workouts');
                // Firestore 'in' query has a limit of 10 items
                const friendsToQuery = userData.friends.slice(0, 10);
                
                const q = window.firestoreQuery(
                    workoutsCol,
                    window.firestoreWhere('userId', 'in', friendsToQuery),
                    window.firestoreOrderBy('completedAt', 'desc'),
                    window.firestoreLimit(5)
                );
                const querySnapshot = await window.firestoreGetDocs(q);
                
                // Fetch friend names for each workout
                const activities = await Promise.all(
                    querySnapshot.docs.map(async (doc) => {
                        const workoutData = doc.data();
                        // Fetch user data to get friend name
                        const userRef = window.firestoreDoc(window.firebaseDb, 'users', workoutData.userId);
                        const userSnap = await window.firestoreGetDoc(userRef);
                        const userName = userSnap.exists() ? userSnap.data().displayName : 'Unknown User';
                        
                        return {
                            id: doc.id,
                            friendName: userName,
                            workoutName: workoutData.title || 'Workout',
                            workoutType: workoutData.category || 'General',
                            date: workoutData.completedAt || Date.now()
                        };
                    })
                );
                
                return activities;
                
            } catch (error) {
                console.error('Error fetching friends activity:', error);
                return [];
            }
        }
        
        /**
         * Update the Social view display with leaderboard and activity feed data
         */
        async function updateSocialDisplay() {
            console.log('Updating social display...');
            
            try {
                // Fetch leaderboard data
                const leaderboardData = await fetchLeaderboard();
                const leaderboardList = document.getElementById('leaderboard-list');
                
                if (leaderboardList) {
                    if (leaderboardData.length === 0) {
                        leaderboardList.innerHTML = '<p class="text-gray-400 text-sm">No leaderboard data available yet.</p>';
                    } else {
                        const leaderboardHTML = leaderboardData.map(user => {
                            const isTopThree = user.rank <= 3;
                            const rankDisplay = user.rank === 1 ? 'ðŸ¥‡' : user.rank === 2 ? 'ðŸ¥ˆ' : user.rank === 3 ? 'ðŸ¥‰' : `#${user.rank}`;
                            const topThreeClass = isTopThree ? 'text-green-500 font-bold' : '';
                            
                            return `
                                <li class="flex items-center justify-between p-4 rounded-lg bg-gray-700 hover:bg-gray-600 transition-colors ${isTopThree ? 'border-2 border-green-500' : ''}">
                                    <div class="flex items-center gap-3">
                                        <span class="text-2xl">${rankDisplay}</span>
                                        <div>
                                            <h4 class="${topThreeClass}">${user.name}</h4>
                                            <p class="text-sm text-gray-400">${user.totalWorkoutsCompleted} workouts completed</p>
                                        </div>
                                    </div>
                                </li>
                            `;
                        }).join('');
                        
                        leaderboardList.innerHTML = leaderboardHTML;
                    }
                }
                
                // Fetch friends activity data
                const activityData = await fetchFriendsActivity();
                const activityFeedList = document.getElementById('activity-feed-list');
                
                if (activityFeedList) {
                    if (activityData.length === 0) {
                        activityFeedList.innerHTML = '<p class="text-gray-400 text-sm">No recent activity from friends. Add friends to see their workouts!</p>';
                    } else {
                        const activityHTML = activityData.map(activity => {
                            const timeAgo = formatTimeAgo(activity.date);
                            return `
                                <li class="p-4 rounded-lg bg-gray-700 hover:bg-gray-600 transition-colors">
                                    <div class="flex items-center gap-3 mb-2">
                                        <div class="w-10 h-10 rounded-full bg-gradient-to-br from-green-400 to-blue-500 flex items-center justify-center text-white font-bold">
                                            ${activity.friendName.charAt(0).toUpperCase()}
                                        </div>
                                        <div>
                                            <h4 class="font-semibold">${activity.friendName}</h4>
                                            <p class="text-xs text-gray-400">${timeAgo}</p>
                                        </div>
                                    </div>
                                    <p class="text-sm text-gray-300">
                                        Completed <span class="font-semibold text-green-400">${activity.workoutName}</span>
                                        <span class="text-gray-500">(${activity.workoutType})</span>
                                    </p>
                                </li>
                            `;
                        }).join('');
                        
                        activityFeedList.innerHTML = activityHTML;
                    }
                }
                
                console.log('Social display updated successfully');
                
            } catch (error) {
                console.error('Error updating social display:', error);
            }
        }
        
        /**
         * Format timestamp to human-readable "time ago" format
         */
        function formatTimeAgo(timestamp) {
            const now = Date.now();
            const diff = now - timestamp;
            const seconds = Math.floor(diff / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            
            if (days > 0) return `${days}d ago`;
            if (hours > 0) return `${hours}h ago`;
            if (minutes > 0) return `${minutes}m ago`;
            return 'Just now';
        }
        
        function likePost(btn) {
            const currentLikes = parseInt(btn.textContent.match(/\d+/)[0]);
            btn.textContent = `â¤ï¸ ${currentLikes + 1}`;
            btn.disabled = true;
            btn.style.opacity = '0.7';
        }

        // ===== SOCIAL FEATURES: FRIENDS MANAGEMENT =====

        /**
         * Load and display friends list
         */
        async function loadFriendsList() {
            if (!currentUser) return;
            
            try {
                const userRef = window.firestoreDoc(window.firebaseDb, 'users', currentUser.uid);
                const userSnap = await window.firestoreGetDoc(userRef);
                
                if (!userSnap.exists()) return;
                
                const userData = userSnap.data();
                const friends = userData.friends || [];
                
                // Update friends count
                document.getElementById('friends-count').textContent = friends.length;
                
                const friendsList = document.getElementById('friends-list');
                if (friends.length === 0) {
                    friendsList.innerHTML = `
                        <div class="text-center py-12">
                            <i data-lucide="users" class="w-12 h-12 mx-auto mb-2 text-gray-500"></i>
                            <p class="text-gray-400 text-sm">No friends yet. Start connecting!</p>
                        </div>
                    `;
                    setTimeout(() => window.lucide?.createIcons?.(), 100);
                    return;
                }
                
                // Fetch friend details
                const friendsData = await Promise.all(
                    friends.map(async (friendId) => {
                        const friendRef = window.firestoreDoc(window.firebaseDb, 'users', friendId);
                        const friendSnap = await window.firestoreGetDoc(friendRef);
                        if (friendSnap.exists()) {
                            const data = friendSnap.data();
                            return {
                                id: friendId,
                                displayName: data.displayName || 'Unknown User',
                                email: data.email || '',
                                photoURL: data.photoURL || null,
                                stats: data.stats || {}
                            };
                        }
                        return null;
                    })
                );
                
                // Filter out null values
                const validFriends = friendsData.filter(f => f !== null);
                
                // Render friends
                const friendsHTML = validFriends.map(friend => {
                    const initial = friend.displayName.charAt(0).toUpperCase();
                    const workouts = friend.stats.totalWorkouts || 0;
                    
                    return `
                        <div class="flex items-center justify-between p-4 rounded-xl" style="background: rgba(0, 0, 0, 0.2);">
                            <div class="flex items-center gap-3">
                                <div class="w-12 h-12 rounded-full flex items-center justify-center overflow-hidden" style="background: linear-gradient(135deg, #BF5AF2, #5E5CE6);">
                                    ${friend.photoURL 
                                        ? `<img src="${friend.photoURL}" alt="${friend.displayName}" class="w-full h-full object-cover">` 
                                        : `<span class="text-lg font-black text-white">${initial}</span>`
                                    }
                                </div>
                                <div>
                                    <p class="font-bold">${friend.displayName}</p>
                                    <p class="text-xs text-gray-400">${workouts} workouts completed</p>
                                </div>
                            </div>
                            <button onclick="removeFriend('${friend.id}', '${friend.displayName}')" class="px-3 py-2 rounded-lg font-semibold text-xs transition-all hover:scale-105" style="background: rgba(255, 69, 58, 0.1); border: 1px solid rgba(255, 69, 58, 0.3); color: #FF453A;">
                                <i data-lucide="user-minus" class="w-4 h-4"></i>
                            </button>
                        </div>
                    `;
                }).join('');
                
                friendsList.innerHTML = friendsHTML;
                setTimeout(() => window.lucide?.createIcons?.(), 100);
                
            } catch (error) {
                console.error('Error loading friends list:', error);
                showToast('Error', 'Failed to load friends list', 'error', 3000);
            }
        }

        /**
         * Show add friend modal
         */
        async function showAddFriendModal() {
            const result = await showPrompt(
                'Add Friend',
                'Enter friend\'s email address',
                'Email address'
            );
            
            if (result) {
                await sendFriendRequest(result);
            }
        }

        /**
         * Send friend request
         */
        async function sendFriendRequest(friendEmail) {
            if (!currentUser) {
                showToast('Error', 'You must be logged in', 'error', 3000);
                return;
            }
            
            try {
                // Check if it's the user's own email
                if (friendEmail.toLowerCase() === currentUser.email.toLowerCase()) {
                    showToast('Error', 'You cannot add yourself as a friend', 'error', 3000);
                    return;
                }
                
                // Find user by email
                const usersCol = window.firestoreCollection(window.firebaseDb, 'users');
                const q = window.firestoreQuery(
                    usersCol,
                    window.firestoreWhere('email', '==', friendEmail.toLowerCase())
                );
                const querySnapshot = await window.firestoreGetDocs(q);
                
                if (querySnapshot.empty) {
                    showToast('Not Found', 'No user found with that email', 'error', 3000);
                    return;
                }
                
                const friendDoc = querySnapshot.docs[0];
                const friendId = friendDoc.id;
                const friendData = friendDoc.data();
                
                // Check if already friends
                const userRef = window.firestoreDoc(window.firebaseDb, 'users', currentUser.uid);
                const userSnap = await window.firestoreGetDoc(userRef);
                const userData = userSnap.data();
                
                if (userData.friends && userData.friends.includes(friendId)) {
                    showToast('Already Friends', 'This user is already your friend', 'info', 3000);
                    return;
                }
                
                // Check if request already sent
                const requestsCol = window.firestoreCollection(window.firebaseDb, 'friendRequests');
                const existingRequest = window.firestoreQuery(
                    requestsCol,
                    window.firestoreWhere('from', '==', currentUser.uid),
                    window.firestoreWhere('to', '==', friendId)
                );
                const existingSnap = await window.firestoreGetDocs(existingRequest);
                
                if (!existingSnap.empty) {
                    showToast('Already Sent', 'Friend request already sent', 'info', 3000);
                    return;
                }
                
                // Create friend request
                await window.firestoreAddDoc(requestsCol, {
                    from: currentUser.uid,
                    to: friendId,
                    status: 'pending',
                    createdAt: Date.now()
                });
                
                showToast('Request Sent! ðŸ“¤', `Friend request sent to ${friendData.displayName}`, 'success', 3000);
                
            } catch (error) {
                console.error('Error sending friend request:', error);
                showToast('Error', 'Failed to send friend request', 'error', 3000);
            }
        }

        /**
         * Remove friend
         */
        async function removeFriend(friendId, friendName) {
            const confirmed = await showConfirm(
                'Remove Friend',
                `Are you sure you want to remove ${friendName} from your friends?`
            );
            
            if (!confirmed) return;
            
            try {
                const userRef = window.firestoreDoc(window.firebaseDb, 'users', currentUser.uid);
                const userSnap = await window.firestoreGetDoc(userRef);
                const userData = userSnap.data();
                
                const friends = userData.friends || [];
                const updatedFriends = friends.filter(id => id !== friendId);
                
                await window.firestoreUpdateDoc(userRef, {
                    friends: updatedFriends
                });
                
                // Also remove current user from friend's friend list
                const friendRef = window.firestoreDoc(window.firebaseDb, 'users', friendId);
                const friendSnap = await window.firestoreGetDoc(friendRef);
                const friendData = friendSnap.data();
                
                const friendFriends = friendData.friends || [];
                const updatedFriendFriends = friendFriends.filter(id => id !== currentUser.uid);
                
                await window.firestoreUpdateDoc(friendRef, {
                    friends: updatedFriendFriends
                });
                
                showToast('Friend Removed', `${friendName} has been removed from your friends`, 'success', 3000);
                
                // Reload friends list
                await loadFriendsList();
                await loadActivityFeed();
                
            } catch (error) {
                console.error('Error removing friend:', error);
                showToast('Error', 'Failed to remove friend', 'error', 3000);
            }
        }

        /**
         * Load and display pending friend requests
         */
        async function showFriendRequests() {
            if (!currentUser) return;
            
            try {
                // Get incoming requests
                const requestsCol = window.firestoreCollection(window.firebaseDb, 'friendRequests');
                const q = window.firestoreQuery(
                    requestsCol,
                    window.firestoreWhere('to', '==', currentUser.uid),
                    window.firestoreWhere('status', '==', 'pending')
                );
                const querySnapshot = await window.firestoreGetDocs(q);
                
                if (querySnapshot.empty) {
                    showToast('No Requests', 'You have no pending friend requests', 'info', 3000);
                    return;
                }
                
                // Fetch sender details
                const requests = await Promise.all(
                    querySnapshot.docs.map(async (doc) => {
                        const data = doc.data();
                        const senderRef = window.firestoreDoc(window.firebaseDb, 'users', data.from);
                        const senderSnap = await window.firestoreGetDoc(senderRef);
                        const senderData = senderSnap.data();
                        
                        return {
                            id: doc.id,
                            fromId: data.from,
                            fromName: senderData.displayName || 'Unknown User',
                            fromEmail: senderData.email || '',
                            photoURL: senderData.photoURL || null
                        };
                    })
                );
                
                // Build HTML for requests
                const requestsHTML = requests.map(req => {
                    const initial = req.fromName.charAt(0).toUpperCase();
                    return `
                        <div class="flex items-center justify-between p-4 rounded-xl" style="background: rgba(255, 159, 10, 0.1); border: 1px solid rgba(255, 159, 10, 0.3);">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 rounded-full flex items-center justify-center overflow-hidden" style="background: linear-gradient(135deg, #FF9F0A, #FFCC00);">
                                    ${req.photoURL 
                                        ? `<img src="${req.photoURL}" alt="${req.fromName}" class="w-full h-full object-cover">` 
                                        : `<span class="text-sm font-black text-white">${initial}</span>`
                                    }
                                </div>
                                <div>
                                    <p class="font-bold">${req.fromName}</p>
                                    <p class="text-xs text-gray-400">${req.fromEmail}</p>
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="acceptFriendRequest('${req.id}', '${req.fromId}', '${req.fromName}')" class="px-3 py-2 rounded-lg font-semibold text-xs transition-all hover:scale-105" style="background: linear-gradient(135deg, #32D74B, #00D9FF); color: black;">
                                    <i data-lucide="check" class="w-4 h-4"></i>
                                </button>
                                <button onclick="rejectFriendRequest('${req.id}')" class="px-3 py-2 rounded-lg font-semibold text-xs transition-all hover:scale-105" style="background: rgba(255, 69, 58, 0.1); border: 1px solid rgba(255, 69, 58, 0.3); color: #FF453A;">
                                    <i data-lucide="x" class="w-4 h-4"></i>
                                </button>
                            </div>
                        </div>
                    `;
                }).join('');
                
                // Show modal with requests
                await showModal(
                    'Friend Requests',
                    `<div class="space-y-3">${requestsHTML}</div>`,
                    'info'
                );
                
                setTimeout(() => window.lucide?.createIcons?.(), 100);
                
            } catch (error) {
                console.error('Error loading friend requests:', error);
                showToast('Error', 'Failed to load friend requests', 'error', 3000);
            }
        }

        /**
         * Accept friend request
         */
        async function acceptFriendRequest(requestId, friendId, friendName) {
            try {
                // Update request status
                const requestRef = window.firestoreDoc(window.firebaseDb, 'friendRequests', requestId);
                await window.firestoreUpdateDoc(requestRef, {
                    status: 'accepted',
                    acceptedAt: Date.now()
                });
                
                // Add to current user's friends
                const userRef = window.firestoreDoc(window.firebaseDb, 'users', currentUser.uid);
                const userSnap = await window.firestoreGetDoc(userRef);
                const userData = userSnap.data();
                const friends = userData.friends || [];
                
                if (!friends.includes(friendId)) {
                    await window.firestoreUpdateDoc(userRef, {
                        friends: [...friends, friendId]
                    });
                }
                
                // Add to friend's friends
                const friendRef = window.firestoreDoc(window.firebaseDb, 'users', friendId);
                const friendSnap = await window.firestoreGetDoc(friendRef);
                const friendData = friendSnap.data();
                const friendFriends = friendData.friends || [];
                
                if (!friendFriends.includes(currentUser.uid)) {
                    await window.firestoreUpdateDoc(friendRef, {
                        friends: [...friendFriends, currentUser.uid]
                    });
                }
                
                showToast('Friend Added! ðŸŽ‰', `${friendName} is now your friend`, 'success', 3000);
                
                // Close modal and refresh
                closeModal();
                await loadFriendsList();
                await loadFriendRequests();
                await loadActivityFeed();
                
            } catch (error) {
                console.error('Error accepting friend request:', error);
                showToast('Error', 'Failed to accept friend request', 'error', 3000);
            }
        }

        /**
         * Reject friend request
         */
        async function rejectFriendRequest(requestId) {
            try {
                const requestRef = window.firestoreDoc(window.firebaseDb, 'friendRequests', requestId);
                await window.firestoreUpdateDoc(requestRef, {
                    status: 'rejected',
                    rejectedAt: Date.now()
                });
                
                showToast('Request Rejected', 'Friend request declined', 'success', 3000);
                
                // Close modal and refresh
                closeModal();
                await loadFriendRequests();
                
            } catch (error) {
                console.error('Error rejecting friend request:', error);
                showToast('Error', 'Failed to reject friend request', 'error', 3000);
            }
        }

        /**
         * Load friend requests count
         */
        async function loadFriendRequests() {
            if (!currentUser) return;
            
            try {
                const requestsCol = window.firestoreCollection(window.firebaseDb, 'friendRequests');
                const q = window.firestoreQuery(
                    requestsCol,
                    window.firestoreWhere('to', '==', currentUser.uid),
                    window.firestoreWhere('status', '==', 'pending')
                );
                const querySnapshot = await window.firestoreGetDocs(q);
                
                document.getElementById('pending-requests-count').textContent = querySnapshot.size;
                
            } catch (error) {
                console.error('Error loading friend requests count:', error);
            }
        }

        // ===== SOCIAL FEATURES: ACTIVITY FEED =====

        /**
         * Load and display activity feed
         */
        async function loadActivityFeed() {
            if (!currentUser) return;
            
            try {
                // Get user's friends
                const userRef = window.firestoreDoc(window.firebaseDb, 'users', currentUser.uid);
                const userSnap = await window.firestoreGetDoc(userRef);
                const userData = userSnap.data();
                const friends = userData.friends || [];
                
                // Also include current user's activities
                const usersToQuery = [currentUser.uid, ...friends].slice(0, 10); // Firestore 'in' limit
                
                const activityFeedList = document.getElementById('activity-feed-list');
                
                if (usersToQuery.length === 0) {
                    activityFeedList.innerHTML = `
                        <div class="text-center py-12">
                            <i data-lucide="activity" class="w-12 h-12 mx-auto mb-2 text-gray-500"></i>
                            <p class="text-gray-400 text-sm">No activities yet. Start working out or add friends!</p>
                        </div>
                    `;
                    setTimeout(() => window.lucide?.createIcons?.(), 100);
                    return;
                }
                
                // Fetch recent activities from activities collection
                const activitiesCol = window.firestoreCollection(window.firebaseDb, 'activities');
                const q = window.firestoreQuery(
                    activitiesCol,
                    window.firestoreWhere('userId', 'in', usersToQuery),
                    window.firestoreOrderBy('timestamp', 'desc'),
                    window.firestoreLimit(20)
                );
                const querySnapshot = await window.firestoreGetDocs(q);
                
                if (querySnapshot.empty) {
                    activityFeedList.innerHTML = `
                        <div class="text-center py-12">
                            <i data-lucide="activity" class="w-12 h-12 mx-auto mb-2 text-gray-500"></i>
                            <p class="text-gray-400 text-sm">No activities yet. Be the first to share!</p>
                        </div>
                    `;
                    setTimeout(() => window.lucide?.createIcons?.(), 100);
                    return;
                }
                
                // Fetch user details for activities
                const activities = await Promise.all(
                    querySnapshot.docs.map(async (doc) => {
                        const data = doc.data();
                        const userRef = window.firestoreDoc(window.firebaseDb, 'users', data.userId);
                        const userSnap = await window.firestoreGetDoc(userRef);
                        const userData = userSnap.data();
                        
                        return {
                            id: doc.id,
                            userId: data.userId,
                            userName: userData.displayName || 'Unknown User',
                            photoURL: userData.photoURL || null,
                            type: data.type,
                            description: data.description,
                            timestamp: data.timestamp,
                            likes: data.likes || 0,
                            isOwn: data.userId === currentUser.uid
                        };
                    })
                );
                
                // Render activities
                const activitiesHTML = activities.map(activity => {
                    const initial = activity.userName.charAt(0).toUpperCase();
                    const timeAgo = formatTimeAgo(activity.timestamp);
                    const icon = getActivityIcon(activity.type);
                    
                    return `
                        <div class="p-4 rounded-xl" style="background: rgba(0, 0, 0, 0.2); border: 1px solid rgba(255, 255, 255, 0.1);">
                            <div class="flex items-start gap-3">
                                <div class="w-10 h-10 rounded-full flex items-center justify-center overflow-hidden flex-shrink-0" style="background: linear-gradient(135deg, #32D74B, #00D9FF);">
                                    ${activity.photoURL 
                                        ? `<img src="${activity.photoURL}" alt="${activity.userName}" class="w-full h-full object-cover">` 
                                        : `<span class="text-sm font-black text-white">${initial}</span>`
                                    }
                                </div>
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center justify-between mb-1">
                                        <p class="font-bold">${activity.userName}</p>
                                        <p class="text-xs text-gray-400">${timeAgo}</p>
                                    </div>
                                    <div class="flex items-start gap-2 mb-2">
                                        <i data-lucide="${icon}" class="w-4 h-4 text-teal-400 mt-1 flex-shrink-0"></i>
                                        <p class="text-sm text-gray-300">${activity.description}</p>
                                    </div>
                                    <div class="flex items-center gap-4 text-xs text-gray-400">
                                        <button onclick="likeActivity('${activity.id}')" class="flex items-center gap-1 hover:text-red-400 transition-colors">
                                            <i data-lucide="heart" class="w-4 h-4"></i>
                                            <span id="likes-${activity.id}">${activity.likes}</span>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                activityFeedList.innerHTML = activitiesHTML;
                setTimeout(() => window.lucide?.createIcons?.(), 100);
                
            } catch (error) {
                console.error('Error loading activity feed:', error);
                const activityFeedList = document.getElementById('activity-feed-list');
                if (activityFeedList) {
                    activityFeedList.innerHTML = `
                        <div class="text-center py-12">
                            <i data-lucide="alert-circle" class="w-12 h-12 mx-auto mb-2 text-red-400"></i>
                            <p class="text-gray-400 text-sm">Failed to load activities</p>
                        </div>
                    `;
                    setTimeout(() => window.lucide?.createIcons?.(), 100);
                }
            }
        }

        /**
         * Get icon for activity type
         */
        function getActivityIcon(type) {
            const icons = {
                'workout': 'dumbbell',
                'nutrition': 'apple',
                'health': 'heart',
                'achievement': 'trophy',
                'challenge': 'zap'
            };
            return icons[type] || 'activity';
        }

        /**
         * Like an activity
         */
        async function likeActivity(activityId) {
            try {
                const activityRef = window.firestoreDoc(window.firebaseDb, 'activities', activityId);
                await window.firestoreUpdateDoc(activityRef, {
                    likes: window.firestoreIncrement(1)
                });
                
                // Update UI
                const likesElement = document.getElementById(`likes-${activityId}`);
                if (likesElement) {
                    likesElement.textContent = parseInt(likesElement.textContent) + 1;
                }
                
            } catch (error) {
                console.error('Error liking activity:', error);
            }
        }

        /**
         * Share activity
         */
        async function shareActivity() {
            if (!currentUser) {
                showToast('Error', 'You must be logged in', 'error', 3000);
                return;
            }
            
            const activities = [
                { value: 'workout', label: 'ðŸ‹ï¸ Completed a workout' },
                { value: 'nutrition', label: 'ðŸŽ Hit nutrition goal' },
                { value: 'health', label: 'ðŸ’§ Hit hydration goal' },
                { value: 'achievement', label: 'ðŸ† Achieved a milestone' }
            ];
            
            const result = await showForm(
                'Share Activity',
                [
                    {
                        type: 'select',
                        name: 'type',
                        label: 'Activity Type',
                        options: activities
                    },
                    {
                        type: 'textarea',
                        name: 'description',
                        label: 'Description',
                        placeholder: 'What did you accomplish?'
                    }
                ]
            );
            
            if (!result) return;
            
            try {
                const activitiesCol = window.firestoreCollection(window.firebaseDb, 'activities');
                await window.firestoreAddDoc(activitiesCol, {
                    userId: currentUser.uid,
                    type: result.type,
                    description: result.description,
                    timestamp: Date.now(),
                    likes: 0
                });
                
                showToast('Shared! ðŸŽ‰', 'Your activity has been shared with your friends', 'success', 3000);
                
                // Reload activity feed
                await loadActivityFeed();
                
            } catch (error) {
                console.error('Error sharing activity:', error);
                showToast('Error', 'Failed to share activity', 'error', 3000);
            }
        }

        // ===== SOCIAL FEATURES: LEADERBOARD =====

        /**
         * Load and display leaderboard with type filtering
         */
        async function loadLeaderboard(type = 'workouts') {
            try {
                const usersCol = window.firestoreCollection(window.firebaseDb, 'users');
                let orderField = 'stats.totalWorkouts';
                
                if (type === 'calories') {
                    orderField = 'stats.totalCalories';
                } else if (type === 'streak') {
                    orderField = 'stats.currentStreak';
                }
                
                const q = window.firestoreQuery(
                    usersCol,
                    window.firestoreOrderBy(orderField, 'desc'),
                    window.firestoreLimit(10)
                );
                const querySnapshot = await window.firestoreGetDocs(q);
                
                const leaderboardList = document.getElementById('leaderboard-list');
                
                if (querySnapshot.empty) {
                    leaderboardList.innerHTML = `
                        <div class="text-center py-8">
                            <i data-lucide="trophy" class="w-12 h-12 mx-auto mb-2 text-gray-500"></i>
                            <p class="text-gray-400 text-sm">No leaderboard data available yet</p>
                        </div>
                    `;
                    setTimeout(() => window.lucide?.createIcons?.(), 100);
                    return;
                }
                
                const leaders = querySnapshot.docs.map((doc, index) => {
                    const data = doc.data();
                    let value = 0;
                    let unit = '';
                    
                    if (type === 'workouts') {
                        value = data.stats?.totalWorkouts || 0;
                        unit = 'workouts';
                    } else if (type === 'calories') {
                        value = data.stats?.totalCalories || 0;
                        unit = 'calories';
                    } else if (type === 'streak') {
                        value = data.stats?.currentStreak || 0;
                        unit = 'day streak';
                    }
                    
                    return {
                        id: doc.id,
                        rank: index + 1,
                        name: data.displayName || 'Unknown User',
                        photoURL: data.photoURL || null,
                        value: value,
                        unit: unit,
                        isCurrentUser: doc.id === currentUser?.uid
                    };
                });
                
                const leaderboardHTML = leaders.map(leader => {
                    const initial = leader.name.charAt(0).toUpperCase();
                    const rankEmoji = leader.rank === 1 ? 'ðŸ¥‡' : leader.rank === 2 ? 'ðŸ¥ˆ' : leader.rank === 3 ? 'ðŸ¥‰' : `#${leader.rank}`;
                    const highlightClass = leader.isCurrentUser ? 'border-2 border-teal-400' : '';
                    const topThreeClass = leader.rank <= 3 ? 'bg-gradient-to-r from-yellow-900/20 to-transparent' : '';
                    
                    return `
                        <div class="flex items-center justify-between p-4 rounded-xl ${topThreeClass} ${highlightClass}" style="background: rgba(0, 0, 0, 0.2); border: 1px solid rgba(255, 255, 255, 0.1);">
                            <div class="flex items-center gap-3">
                                <span class="text-2xl w-10 text-center">${rankEmoji}</span>
                                <div class="w-10 h-10 rounded-full flex items-center justify-center overflow-hidden" style="background: linear-gradient(135deg, #FFCC00, #FF9F0A);">
                                    ${leader.photoURL 
                                        ? `<img src="${leader.photoURL}" alt="${leader.name}" class="w-full h-full object-cover">` 
                                        : `<span class="text-sm font-black text-white">${initial}</span>`
                                    }
                                </div>
                                <div>
                                    <p class="font-bold ${leader.isCurrentUser ? 'text-teal-400' : ''}">${leader.name} ${leader.isCurrentUser ? '(You)' : ''}</p>
                                    <p class="text-xs text-gray-400">${leader.value.toLocaleString()} ${leader.unit}</p>
                                </div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                leaderboardList.innerHTML = leaderboardHTML;
                
            } catch (error) {
                console.error('Error loading leaderboard:', error);
                const leaderboardList = document.getElementById('leaderboard-list');
                if (leaderboardList) {
                    leaderboardList.innerHTML = `
                        <div class="text-center py-8">
                            <i data-lucide="alert-circle" class="w-12 h-12 mx-auto mb-2 text-red-400"></i>
                            <p class="text-gray-400 text-sm">Failed to load leaderboard</p>
                        </div>
                    `;
                    setTimeout(() => window.lucide?.createIcons?.(), 100);
                }
            }
        }

        // ===== SOCIAL FEATURES: CHALLENGES =====

        /**
         * Show challenges modal
         */
        async function showChallenges() {
            if (!currentUser) {
                showToast('Error', 'You must be logged in', 'error', 3000);
                return;
            }
            
            try {
                // Get user's active challenges
                const challengesCol = window.firestoreCollection(window.firebaseDb, 'challenges');
                const q = window.firestoreQuery(
                    challengesCol,
                    window.firestoreWhere('participants', 'array-contains', currentUser.uid),
                    window.firestoreWhere('status', '==', 'active')
                );
                const querySnapshot = await window.firestoreGetDocs(q);
                
                // Update active challenges count
                document.getElementById('active-challenges-count').textContent = querySnapshot.size;
                
                if (querySnapshot.empty) {
                    await showModal(
                        'Challenges',
                        `
                            <div class="text-center py-8">
                                <i data-lucide="zap" class="w-16 h-16 mx-auto mb-4 text-gray-500"></i>
                                <p class="text-gray-400 mb-6">No active challenges. Start one to compete with friends!</p>
                                <button onclick="createChallenge()" class="px-6 py-3 rounded-lg font-bold transition-all hover:scale-105" style="background: linear-gradient(135deg, #32D74B, #00D9FF); color: black;">
                                    <i data-lucide="plus" class="w-5 h-5 inline mr-2"></i>
                                    Create Challenge
                                </button>
                            </div>
                        `,
                        'info'
                    );
                    setTimeout(() => window.lucide?.createIcons?.(), 100);
                    return;
                }
                
                // Render challenges
                const challenges = querySnapshot.docs.map(doc => {
                    const data = doc.data();
                    return {
                        id: doc.id,
                        name: data.name,
                        type: data.type,
                        goal: data.goal,
                        endDate: data.endDate,
                        participants: data.participants || []
                    };
                });
                
                const challengesHTML = challenges.map(challenge => {
                    const daysLeft = Math.ceil((challenge.endDate - Date.now()) / (1000 * 60 * 60 * 24));
                    const icon = challenge.type === 'workouts' ? 'dumbbell' : challenge.type === 'calories' ? 'flame' : 'target';
                    
                    return `
                        <div class="p-4 rounded-xl mb-3" style="background: linear-gradient(135deg, rgba(50, 215, 75, 0.1), rgba(0, 217, 255, 0.05)); border: 1px solid rgba(50, 215, 75, 0.3);">
                            <div class="flex items-start justify-between mb-3">
                                <div>
                                    <h4 class="font-bold text-lg">${challenge.name}</h4>
                                    <p class="text-xs text-gray-400">${challenge.participants.length} participants â€¢ ${daysLeft} days left</p>
                                </div>
                                <i data-lucide="${icon}" class="w-6 h-6 text-teal-400"></i>
                            </div>
                            <div class="flex items-center gap-2 text-sm">
                                <span class="px-2 py-1 rounded-lg font-semibold" style="background: rgba(50, 215, 75, 0.2); color: #32D74B;">
                                    Goal: ${challenge.goal} ${challenge.type}
                                </span>
                            </div>
                        </div>
                    `;
                }).join('');
                
                await showModal(
                    'Your Challenges',
                    `
                        <div class="space-y-3">
                            ${challengesHTML}
                            <button onclick="createChallenge()" class="w-full px-6 py-3 rounded-lg font-bold transition-all hover:scale-105" style="background: linear-gradient(135deg, #32D74B, #00D9FF); color: black;">
                                <i data-lucide="plus" class="w-5 h-5 inline mr-2"></i>
                                Create New Challenge
                            </button>
                        </div>
                    `,
                    'info'
                );
                
                setTimeout(() => window.lucide?.createIcons?.(), 100);
                
            } catch (error) {
                console.error('Error loading challenges:', error);
                showToast('Error', 'Failed to load challenges', 'error', 3000);
            }
        }

        /**
         * Create a new challenge
         */
        async function createChallenge() {
            closeModal(); // Close the challenges modal first
            
            const result = await showForm(
                'Create Challenge',
                [
                    {
                        type: 'text',
                        name: 'name',
                        label: 'Challenge Name',
                        placeholder: '30-Day Fitness Challenge'
                    },
                    {
                        type: 'select',
                        name: 'type',
                        label: 'Challenge Type',
                        options: [
                            { value: 'workouts', label: 'Total Workouts' },
                            { value: 'calories', label: 'Total Calories' },
                            { value: 'streak', label: 'Daily Streak' }
                        ]
                    },
                    {
                        type: 'number',
                        name: 'goal',
                        label: 'Goal',
                        placeholder: '30'
                    },
                    {
                        type: 'number',
                        name: 'duration',
                        label: 'Duration (days)',
                        placeholder: '30'
                    }
                ]
            );
            
            if (!result) return;
            
            try {
                const challengesCol = window.firestoreCollection(window.firebaseDb, 'challenges');
                const endDate = Date.now() + (parseInt(result.duration) * 24 * 60 * 60 * 1000);
                
                await window.firestoreAddDoc(challengesCol, {
                    name: result.name,
                    type: result.type,
                    goal: parseInt(result.goal),
                    duration: parseInt(result.duration),
                    endDate: endDate,
                    createdBy: currentUser.uid,
                    participants: [currentUser.uid],
                    status: 'active',
                    createdAt: Date.now()
                });
                
                showToast('Challenge Created! ðŸš€', 'Your challenge is now active', 'success', 3000);
                
                // Refresh challenges count
                await showChallenges();
                
            } catch (error) {
                console.error('Error creating challenge:', error);
                showToast('Error', 'Failed to create challenge', 'error', 3000);
            }
        }

        // ===== END SOCIAL FEATURES =====

        function filterWorkouts(category) {
            currentFilter = category;
            
            // Update filter buttons styling
            document.querySelectorAll('.workout-filter').forEach(btn => {
                btn.style.backgroundColor = '';
                btn.style.color = '';
                btn.classList.add('border', 'border-gray-500', 'text-gray-300');
                btn.classList.remove('text-black');
            });
            
            // Highlight active filter button
            const activeBtn = Array.from(document.querySelectorAll('.workout-filter')).find(
                btn => btn.textContent.trim() === category
            );
            if (activeBtn) {
                activeBtn.style.backgroundColor = 'var(--color-accent)';
                activeBtn.style.color = 'black';
                activeBtn.classList.remove('border', 'border-gray-500', 'text-gray-300');
                activeBtn.classList.add('text-black');
            }
            
            displayWorkouts();
            
            // Scroll to workout list smoothly
            document.getElementById('workout-list').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function displayWorkouts() {
            const filtered = currentFilter === 'All' 
                ? workouts 
                : workouts.filter(w => w.level === currentFilter || w.category === currentFilter);
            
            if (filtered.length === 0) {
                document.getElementById('workout-list').innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <p class="text-gray-400 text-lg">No workouts found for "${currentFilter}"</p>
                        <button onclick="filterWorkouts('All')" class="mt-4 px-6 py-2 rounded-lg text-black font-semibold" style="background-color: var(--color-accent);">
                            View All Workouts
                        </button>
                    </div>
                `;
                return;
            }
            
            const html = filtered.map(w => `
                <div class="rounded-xl overflow-hidden cursor-pointer hover:scale-105 transition" style="background-color: var(--color-card);" onclick="startWorkout(${w.id})">
                    <img src="${w.image}" alt="${w.name}" class="w-full h-40 object-cover">
                    <div class="p-4">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-xs px-2 py-1 rounded-full bg-gray-700">${w.level}</span>
                            <span class="text-xs text-gray-400">${w.category}</span>
                        </div>
                        <h3 class="font-semibold mt-2">${w.name}</h3>
                        <div class="flex items-center justify-between mt-2">
                            <p class="text-sm text-gray-400">
                                <i data-lucide="clock" class="w-3 h-3 inline"></i> ${w.duration} min
                            </p>
                            <p class="text-sm text-gray-400">
                                <i data-lucide="flame" class="w-3 h-3 inline"></i> ${w.calories} cal
                            </p>
                        </div>
                        <button class="mt-3 w-full py-2 rounded-lg text-black font-semibold flex items-center justify-center" style="background-color: var(--color-accent);">
                            <i data-lucide="play" class="w-4 h-4 mr-2"></i> Start Workout
                        </button>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('workout-list').innerHTML = html;
            setTimeout(() => window.createIcons?.(), 100);
        }

        async function startWorkout(id) {
            const workout = workouts.find(w => w.id === id);
            if (!workout) return;
            
            const message = `Duration: ${workout.duration} minutes | Calories: ${workout.calories} cal\nLevel: ${workout.level} | Category: ${workout.category}`;
            
            const confirmed = await showConfirm(
                `Start ${workout.name}? ðŸ‹ï¸`,
                message,
                'Start Workout',
                'Cancel'
            );
            
            if (confirmed) {
                // Launch the workout timer view
                showActiveWorkout(workout.name);
                      
                // Add to history (prepend to beginning)
                workoutHistory.unshift({
                    name: workout.name,
                    date: 'Just now',
                    duration: workout.duration,
                    calories: workout.calories
                });
                
                // Keep only last 10 workouts
                if (workoutHistory.length > 10) {
                    workoutHistory.pop();
                }
                
                // Update stats in Firestore if user is logged in
                if (currentUser) {
                    await updateUserStats({
                        workouts: 1,
                        calories: workout.calories,
                        steps: Math.floor(workout.duration * 100) // Approximate steps based on duration
                    });
                    showToast('Stats Updated! ðŸ“Š', 'Your progress has been saved', 'success', 2500);
                }
            }
        }

        // Interactive stat card functions
        async function showCaloriesDetail() {
            const calories = userStats.totalCalories || 0;
            const message = `
                <div style="text-align: left;">
                    <p style="font-size: 2rem; font-weight: 800; text-align: center; margin-bottom: 1rem;">
                        ${calories.toLocaleString()} <span style="font-size: 1.2rem; color: #888;">cal</span>
                    </p>
                    <p style="margin-bottom: 1rem;">
                        Calories are tracked automatically when you complete workouts. Every workout counts!
                    </p>
                    <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 0.5rem; margin-top: 1rem;">
                        <p style="font-size: 0.9rem; color: #aaa;">
                            ðŸ’¡ <strong>Tip:</strong> Complete workouts from the Workout section to increase your calorie burn!
                        </p>
                    </div>
                </div>
            `;
            await showModal('Calories Burned ðŸ”¥', message, 'info');
        }
        
        async function showStepsDetail() {
            const steps = userStats.totalSteps || 0;
            const goal = dailyGoals.steps.goal;
            const remaining = Math.max(0, goal - steps);
            const percent = Math.min((steps / goal) * 100, 100).toFixed(1);
            
            const message = `
                <div style="text-align: left;">
                    <p style="font-size: 2rem; font-weight: 800; text-align: center; margin-bottom: 1rem;">
                        ${steps.toLocaleString()} <span style="font-size: 1.2rem; color: #888;">steps</span>
                    </p>
                    <div style="background: #1a1a1a; border-radius: 1rem; padding: 0.5rem; margin-bottom: 1rem;">
                        <div style="background: linear-gradient(135deg, #32D74B 0%, #00D9FF 100%); height: 0.5rem; border-radius: 1rem; width: ${percent}%;"></div>
                    </div>
                    <p style="text-align: center; margin-bottom: 1rem; font-size: 1.1rem;">
                        ${remaining > 0 ? `${remaining.toLocaleString()} steps to go! (${percent}%)` : 'ðŸŽ‰ Goal reached! Amazing work!'}
                    </p>
                    <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 0.5rem; margin-top: 1rem;">
                        <p style="font-size: 0.9rem; color: #aaa;">
                            ðŸ’¡ <strong>Tip:</strong> Steps are added automatically when you complete workouts. Keep moving!
                        </p>
                        <button onclick="addTestSteps()" style="margin-top: 0.5rem; background: var(--color-accent); color: black; padding: 0.5rem 1rem; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 600;">
                            âž• Add 1000 Steps (Test)
                        </button>
                    </div>
                </div>
            `;
            await showModal('Steps Tracker ðŸ‘£', message, 'info');
        }
        
        async function showWorkoutsDetail() {
            const workouts = userStats.totalWorkouts || 0;
            const calories = userStats.totalCalories || 0;
            
            const message = `
                <div style="text-align: left;">
                    <p style="font-size: 2rem; font-weight: 800; text-align: center; margin-bottom: 1rem;">
                        ${workouts} <span style="font-size: 1.2rem; color: #888;">workouts</span>
                    </p>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
                        <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 0.5rem; text-align: center;">
                            <p style="font-size: 0.8rem; color: #888; margin-bottom: 0.5rem;">Calories Burned</p>
                            <p style="font-size: 1.5rem; font-weight: 700;">${calories.toLocaleString()}</p>
                        </div>
                        <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 0.5rem; text-align: center;">
                            <p style="font-size: 0.8rem; color: #888; margin-bottom: 0.5rem;">Avg. per Workout</p>
                            <p style="font-size: 1.5rem; font-weight: 700;">${workouts > 0 ? Math.round(calories / workouts) : 0}</p>
                        </div>
                    </div>
                    <p style="text-align: center;">
                        ${workouts === 0 ? 'ðŸŽ¯ Start your first workout today!' : 'ðŸ’ª Amazing progress! Keep crushing it!'}
                    </p>
                    <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 0.5rem; margin-top: 1rem;">
                        <p style="font-size: 0.9rem; color: #aaa;">
                            ðŸ’¡ <strong>Tip:</strong> Browse the Workout library and start a new workout to increase this counter!
                        </p>
                    </div>
                </div>
            `;
            await showModal('Workouts Done ðŸ’ª', message, 'success');
        }
        
        async function showStreakDetail() {
            const streak = userStats.currentStreak || 0;
            const longest = userStats.longestStreak || 0;
            
            const message = `
                <div style="text-align: left;">
                    <p style="font-size: 2rem; font-weight: 800; text-align: center; margin-bottom: 1rem;">
                        ${streak} <span style="font-size: 1.2rem; color: #888;">days</span>
                    </p>
                    <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem;">
                        <p style="font-size: 0.9rem; color: #aaa; text-align: center;">
                            ðŸ† Longest Streak: <strong>${longest} days</strong>
                        </p>
                    </div>
                    <p style="text-align: center; margin-bottom: 1rem;">
                        ${streak > 0 ? 'ðŸ”¥ Keep the momentum going! Don\'t break the streak!' : 'ðŸŽ¯ Start your streak today! Complete any workout to begin.'}
                    </p>
                    <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 0.5rem; margin-top: 1rem;">
                        <p style="font-size: 0.9rem; color: #aaa;">
                            ðŸ’¡ <strong>How it works:</strong> Your streak increases by 1 for each consecutive day you complete at least one workout. Keep showing up!
                        </p>
                    </div>
                </div>
            `;
            await showModal('Active Streak ðŸ”¥', message, 'info');
        }
        
        // Test function to add steps manually
        async function addTestSteps() {
            const stepsToAdd = 1000;
            if (currentUser) {
                await updateUserStats({
                    steps: stepsToAdd
                });
            } else {
                userStats.totalSteps = (userStats.totalSteps || 0) + stepsToAdd;
                updateDashboardStats();
            }
            showToast('Steps Added! ðŸ‘Ÿ', `Added ${stepsToAdd.toLocaleString()} steps to your total!`, 'success', 2500);
            
            // Close modal and reopen with updated stats
            document.querySelectorAll('.modal-overlay').forEach(m => m.remove());
            setTimeout(() => showStepsDetail(), 300);
        }
        
        // Test function to trigger celebration
        function testCelebration() {
            // Temporarily complete all goals
            const originalAllGoalsCompleted = allGoalsCompletedToday;
            allGoalsCompletedToday = false; // Reset to allow celebration
            
            dailyGoals.water.current = dailyGoals.water.goal;
            dailyGoals.sleep.current = dailyGoals.sleep.goal;
            dailyGoals.steps.current = dailyGoals.steps.goal;
            
            updateGoalsUI();
            
            showToast('Test Mode', 'All goals marked as completed for testing!', 'info', 2000);
        }
        
        // Update user stats in Firestore
        async function updateUserStats(updates) {
            if (!currentUser) return;
            
            try {
                const userRef = window.firestoreDoc(window.firebaseDb, 'users', currentUser.uid);
                const userSnap = await window.firestoreGetDoc(userRef);
                
                if (userSnap.exists()) {
                    const currentStats = userSnap.data().stats || {};
                    const newStats = {
                        totalWorkouts: (currentStats.totalWorkouts || 0) + (updates.workouts || 0),
                        totalCalories: (currentStats.totalCalories || 0) + (updates.calories || 0),
                        totalSteps: (currentStats.totalSteps || 0) + (updates.steps || 0),
                        currentStreak: currentStats.currentStreak || 0,
                        longestStreak: currentStats.longestStreak || 0
                    };
                    
                    await window.firestoreUpdateDoc(userRef, { stats: newStats });
                    userStats = newStats;
                    updateDashboardStats();
                }
            } catch (error) {
                console.error('Error updating stats:', error);
            }
        }
        
        
        // Authentication state listener - Single entry point for app initialization
        let authInitialized = false;
        
        /**
         * Scroll-to-Hide Navbar Logic with Tailwind Classes
         * Improved version with proper scroll target detection and threshold
         */
        let scrollListenerActive = false;
        let scrollHandler = null; // Store reference to the scroll handler for cleanup
        
        /**
         * Initialize scroll-to-hide functionality for sidebar
         * @param {HTMLElement} sidebarElement - The sidebar element
         */
        function initScrollToHide(sidebarElement) {
            if (!sidebarElement) {
                console.error('âŒ Cannot initialize scroll-to-hide: sidebar element not found');
                return;
            }
            
            // Identify the element that ACTUALLY scrolls
            const scrollTarget = window;
            
            // Initialize last scroll position
            let lastScrollY = scrollTarget === window ? window.scrollY : scrollTarget.scrollTop;
            
            // Set initial visible state
            sidebarElement.classList.add('sidebar-visible');
            sidebarElement.classList.remove('sidebar-hidden');
            
            // Create the scroll handler function
            scrollHandler = () => {
                // Get current scroll position based on target type
                const currentScrollY = scrollTarget === window ? window.scrollY : scrollTarget.scrollTop;
                
                // Threshold: Only react to scrolls greater than 10px to prevent jitter
                if (Math.abs(currentScrollY - lastScrollY) < 10) return;
                
                // Always show sidebar at the very top of the page
                if (currentScrollY < 50) {
                    if (sidebarElement.classList.contains('sidebar-hidden')) {
                        sidebarElement.classList.remove('sidebar-hidden');
                        sidebarElement.classList.add('sidebar-visible');
                        console.log('ðŸ“ Sidebar shown (at top)');
                    }
                }
                // Hide sidebar when scrolling DOWN
                else if (currentScrollY > lastScrollY && currentScrollY > 100) {
                    if (!sidebarElement.classList.contains('sidebar-hidden')) {
                        sidebarElement.classList.remove('sidebar-visible');
                        sidebarElement.classList.add('sidebar-hidden');
                        console.log('â¬†ï¸ Sidebar hidden (scrolling down) - Y:', currentScrollY);
                    }
                }
                // Show sidebar when scrolling UP
                else if (currentScrollY < lastScrollY) {
                    if (sidebarElement.classList.contains('sidebar-hidden')) {
                        sidebarElement.classList.remove('sidebar-hidden');
                        sidebarElement.classList.add('sidebar-visible');
                        console.log('â¬‡ï¸ Sidebar shown (scrolling up) - Y:', currentScrollY);
                    }
                }
                
                // Update last scroll position
                lastScrollY = currentScrollY;
            };
            
            // Attach scroll listener with passive flag for better performance
            scrollTarget.addEventListener('scroll', scrollHandler, { passive: true });
            scrollListenerActive = true;
            
            console.log('âœ… Scroll-to-hide initialized successfully for sidebar');
            console.log('   - Scroll target:', scrollTarget === window ? 'window' : 'element');
            console.log('   - Threshold: 10px minimum scroll');
        }
        
        /**
         * Initialize scroll listener (wrapper for backward compatibility)
         */
        function initScrollListener() {
            if (!scrollListenerActive) {
                const sidebar = document.getElementById('corporate-sidebar');
                if (sidebar && !document.body.classList.contains('landing-page')) {
                    initScrollToHide(sidebar);
                }
            }
        }
        
        /**
         * Remove scroll listener and reset navbar state
         */
        function removeScrollListener() {
            if (scrollListenerActive && scrollHandler) {
                // Remove the event listener
                window.removeEventListener('scroll', scrollHandler);
                scrollHandler = null;
                scrollListenerActive = false;
                
                // Reset navbar to visible state
                const navbar = document.querySelector('.navbar');
                if (navbar) {
                    navbar.classList.remove('-translate-y-full');
                    navbar.classList.add('translate-y-0');
                    navbar.style.opacity = '1';
                    // Clear any inline styles
                    navbar.style.removeProperty('transform');
                }
                
                console.log('âŒ Scroll-to-hide disabled');
            }
        }
        
        /**
         * Initialize Firebase Authentication - Single Entry Point
         * This function controls the entire app lifecycle and ensures proper initialization sequence
         */
        function initAuth() {
            if (window.firebaseOnAuthStateChanged && window.firebaseAuth) {
                window.firebaseOnAuthStateChanged(window.firebaseAuth, async (user) => {
                    if (user) {
                        // ========== USER IS AUTHENTICATED ==========
                        currentUser = user;
                        console.log('User authenticated:', user.email);
                        
                        // CRITICAL: Load user data first
                        await loadUserData(user.uid);
                        
                        // Navigate to dashboard immediately after data load
                        updateUIState('dashboard-view');
                        
                        // Initialize Lucide icons
                        window.createIcons?.();
                        
                        // Initialize all app views and functions
                        displayWorkouts();
                        displayFriends();
                        updateGoalsUI();
                        updateDashboardStats();
                        
                        // Initialize new views
                        updateNutritionDisplay();
                        updateHealthDisplay();
                        updateSocialDisplay();
                        
                        // Enable scroll-to-hide navbar for authenticated users
                        initScrollListener();
                        
                        console.log('App fully initialized for authenticated user');
                        
                    } else {
                        // ========== USER IS NOT AUTHENTICATED ==========
                        currentUser = null;
                        console.log('No user authenticated');
                        
                        // Disable scroll-to-hide for unauthenticated users
                        removeScrollListener();
                        
                        // Show login view
                        updateUIState('login-view');
                    }
                });
            }
        }
            
            // Handle browser back/forward buttons
            window.addEventListener('popstate', (event) => {
                const targetView = event.state;
                
                // If user is authenticated and trying to go back to login/signup, prevent it
                if (currentUser && (targetView === 'login' || targetView === 'signup' || !targetView)) {
                    history.pushState('dashboard', '', '');
                    showView('dashboard');
                    return;
                }
                
                // If user is not authenticated and on a protected page, redirect to login
                if (!currentUser && targetView !== 'login' && targetView !== 'signup') {
                    history.pushState('login', '', '');
                    showView('login');
                    return;
                }
                
                // Navigate to the target view
                if (targetView && ['dashboard', 'workout', 'nutrition', 'health', 'social', 'settings', 'login', 'signup'].includes(targetView)) {
                    const views = ['login-view', 'signup-view', 'dashboard-view', 'workout-view', 'nutrition-view', 'health-view', 'social-view', 'settings-view'];
                    views.forEach(v => document.getElementById(v).classList.add('hidden'));
                    document.getElementById(targetView + '-view').classList.remove('hidden');
                    
                    // Update sidebar visibility and main content styling
                    const sidebar = document.getElementById('sidebar');
                    const mainContent = document.getElementById('main-content');
                    if (targetView === 'login' || targetView === 'signup') {
                        sidebar.classList.add('hidden');
                        mainContent.classList.remove('ml-64');
                        // Remove padding and background for landing page
                        mainContent.style.padding = '0';
                        mainContent.style.background = 'transparent';
                        mainContent.style.backdropFilter = 'none';
                    } else {
                        sidebar.classList.remove('hidden');
                        mainContent.classList.add('ml-64');
                        // Restore padding and background for app views
                        mainContent.style.padding = '1.5rem';
                        mainContent.style.background = 'rgba(10, 10, 10, 0.3)';
                        mainContent.style.backdropFilter = 'blur(5px)';
                    }
                    
                    // Update active nav
                    const navLinks = document.querySelectorAll('.nav-link');
                    navLinks.forEach(link => {
                        link.classList.remove('active');
                        const linkView = link.getAttribute('data-view');
                        if (linkView === targetView) {
                            link.classList.add('active');
                        }
                    });
                }
            });
            
            // Set initial history state
            if (!history.state) {
                history.replaceState('login', '', '');
            }
        
        // ========== APPLICATION INITIALIZATION ==========
        // CRITICAL: initAuth() is the ONLY entry point for app initialization
        // Everything else happens inside the Firebase auth state listener
        
        // Initialize icons immediately
        window.createIcons?.();
        
        // Hide sidebar on initial page load (prevents flash before auth state is determined)
        const sidebar = document.getElementById('corporate-sidebar');
        if (sidebar) {
            sidebar.style.display = 'none';
            console.log('Sidebar hidden on initial page load - waiting for auth state');
        }
        document.body.classList.add('landing-page');
        
        // Initialize Firebase Auth - This controls everything
        initAuth();
        
        // Initialize Event Listeners (can be done immediately)
        setTimeout(() => {
            // Initialize Workout Timer Event Listeners
            const startTimerBtn = document.getElementById('start-workout-timer-btn');
            const pauseTimerBtn = document.getElementById('pause-workout-timer-btn');
            const resetTimerBtn = document.getElementById('reset-workout-timer-btn');
            
            if (startTimerBtn) {
                startTimerBtn.addEventListener('click', startTimer);
            }
            if (pauseTimerBtn) {
                pauseTimerBtn.addEventListener('click', pauseTimer);
            }
            if (resetTimerBtn) {
                resetTimerBtn.addEventListener('click', resetTimer);
            }
            
            // Initialize Nutrition Add Food Button Event Listeners
            const addFoodBreakfastBtn = document.getElementById('add-food-breakfast-btn');
            const addFoodLunchBtn = document.getElementById('add-food-lunch-btn');
            const addFoodDinnerBtn = document.getElementById('add-food-dinner-btn');
            const addFoodSnacksBtn = document.getElementById('add-food-snacks-btn');
            
            if (addFoodBreakfastBtn) {
                addFoodBreakfastBtn.addEventListener('click', () => handleAddFood('breakfast'));
            }
            if (addFoodLunchBtn) {
                addFoodLunchBtn.addEventListener('click', () => handleAddFood('lunch'));
            }
            if (addFoodDinnerBtn) {
                addFoodDinnerBtn.addEventListener('click', () => handleAddFood('dinner'));
            }
            if (addFoodSnacksBtn) {
                addFoodSnacksBtn.addEventListener('click', () => handleAddFood('snacks'));
            }
            
            // Initialize Health Tracking Event Listeners
            const addWaterBtn = document.getElementById('add-water-btn');
            const logSleepBtn = document.getElementById('log-sleep-btn');
            const resetWaterBtn = document.getElementById('reset-water-btn');
            const resetSleepBtn = document.getElementById('reset-sleep-btn');
            const sleepInput = document.getElementById('sleep-input');
            const addSleep6hBtn = document.getElementById('add-sleep-6h-btn');
            const addSleep7hBtn = document.getElementById('add-sleep-7h-btn');
            const addSleep8hBtn = document.getElementById('add-sleep-8h-btn');
            
            if (addWaterBtn) {
                addWaterBtn.addEventListener('click', () => logHealthMetric('water', 1));
            }
            
            // Quick sleep log buttons
            if (addSleep6hBtn) {
                addSleep6hBtn.addEventListener('click', () => logHealthMetric('sleep', 6));
            }
            if (addSleep7hBtn) {
                addSleep7hBtn.addEventListener('click', () => logHealthMetric('sleep', 7));
            }
            if (addSleep8hBtn) {
                addSleep8hBtn.addEventListener('click', () => logHealthMetric('sleep', 8));
            }
            
            // Custom sleep log
            if (logSleepBtn) {
                logSleepBtn.addEventListener('click', () => {
                    const sleepValue = parseFloat(sleepInput.value);
                    if (sleepValue && sleepValue > 0 && sleepValue <= 24) {
                        logHealthMetric('sleep', sleepValue);
                        sleepInput.value = '';
                    } else {
                        showToast('Invalid Input', 'Please enter a valid number of hours (0-24)', 'error', 3000);
                    }
                });
            }
            
            if (resetWaterBtn) {
                resetWaterBtn.addEventListener('click', resetWaterCount);
            }
            
            if (resetSleepBtn) {
                resetSleepBtn.addEventListener('click', resetSleepCount);
            }
            
            // Allow Enter key to log sleep
            if (sleepInput) {
                sleepInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        logSleepBtn.click();
                    }
                });
            }
            
            // Initialize Settings Event Listeners
            const updateProfileBtn = document.getElementById('update-profile-btn');
            const editGoalsBtn = document.getElementById('edit-goals-btn');
            const editHealthGoalsBtn = document.getElementById('edit-health-goals-btn');
            const logoutBtn = document.getElementById('logout-btn');
            
            if (updateProfileBtn) {
                updateProfileBtn.addEventListener('click', updateProfile);
            }
            if (editGoalsBtn) {
                editGoalsBtn.addEventListener('click', updateNutritionGoals);
            }
            if (editHealthGoalsBtn) {
                editHealthGoalsBtn.addEventListener('click', updateHealthGoals);
            }
            if (logoutBtn) {
                logoutBtn.addEventListener('click', handleLogout);
            }
            
            // Add event listeners for all settings buttons using querySelectorAll
            document.addEventListener('click', (e) => {
                const target = e.target;
                const button = target.closest('button');
                if (!button) return;
                
                // Check button content or parent content
                const buttonText = button.textContent.trim();
                
                // Change Password
                if (buttonText.includes('Change Password')) {
                    changePassword();
                }
                // Premium Upgrade
                else if (buttonText.includes('Upgrade to Premium')) {
                    upgradeToPremium();
                }
                // Notification Settings
                else if (buttonText.includes('Notification Settings')) {
                    openNotificationSettings();
                }
                // Apple Health
                else if (buttonText.includes('Apple Health')) {
                    connectAppleHealth();
                }
                // Wearable Devices
                else if (buttonText.includes('Wearable Devices')) {
                    connectWearables();
                }
                // Export Data
                else if (buttonText.includes('Export Health Data')) {
                    exportHealthData();
                }
                // Help Center
                else if (buttonText.includes('Help Center')) {
                    openHelpCenter();
                }
                // Contact Support
                else if (buttonText.includes('Contact Support')) {
                    contactSupport();
                }
                // Privacy Policy
                else if (buttonText.includes('Privacy Policy')) {
                    openPrivacyPolicy();
                }
                // Terms of Service
                else if (buttonText.includes('Terms of Service')) {
                    openTermsOfService();
                }
                // Delete Account
                else if (buttonText.includes('Delete Account')) {
                    deleteAccount();
                }
            });
            
            // Units selector change event
            const unitsSelector = document.querySelector('select[class*="bg-gray-700"]');
            if (unitsSelector) {
                unitsSelector.addEventListener('change', (e) => {
                    changeUnits(e.target.value);
                });
            }
            
            // Initialize Social Event Listeners
            const addFriendBtn = document.getElementById('add-friend-btn');
            if (addFriendBtn) {
                addFriendBtn.addEventListener('click', showAddFriendModal);
            }
            
            // Leaderboard type filter
            const leaderboardType = document.getElementById('leaderboard-type');
            if (leaderboardType) {
                leaderboardType.addEventListener('change', (e) => {
                    loadLeaderboard(e.target.value);
                });
            }
            
            // Reinitialize icons periodically to ensure they all show
            setInterval(() => {
                window.createIcons?.();
            }, 2000);
        }, 100);
    </script>
    
    <!-- PWA Service Worker Registration -->
    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then((registration) => {
                        console.log('ServiceWorker registered:', registration);
                        
                        // Check for updates every hour
                        setInterval(() => {
                            registration.update();
                        }, 60 * 60 * 1000);
                    })
                    .catch((error) => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }
        
        // PWA Install Prompt
        let deferredPrompt;
        const installButton = document.createElement('button');
        installButton.id = 'pwa-install-btn';
        installButton.innerHTML = `
            <svg style="width: 20px; height: 20px; display: inline-block; margin-right: 8px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
            </svg>
            Install App
        `;
        installButton.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 24px;
            background: linear-gradient(135deg, #32D74B, #00D9FF);
            color: black;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            box-shadow: 0 8px 24px rgba(50, 215, 75, 0.4);
            z-index: 9998;
            display: none;
            align-items: center;
            transition: all 0.3s ease;
        `;
        
        installButton.onmouseover = () => {
            installButton.style.transform = 'translateY(-2px)';
            installButton.style.boxShadow = '0 12px 32px rgba(50, 215, 75, 0.5)';
        };
        
        installButton.onmouseout = () => {
            installButton.style.transform = 'translateY(0)';
            installButton.style.boxShadow = '0 8px 24px rgba(50, 215, 75, 0.4)';
        };
        
        document.body.appendChild(installButton);
        
        // Capture the beforeinstallprompt event
        window.addEventListener('beforeinstallprompt', (e) => {
            // Prevent the mini-infobar from appearing
            e.preventDefault();
            // Save the event for later use
            deferredPrompt = e;
            // Show install button
            installButton.style.display = 'flex';
            
            console.log('Install prompt available');
        });
        
        // Handle install button click
        installButton.addEventListener('click', async () => {
            if (deferredPrompt) {
                // Show the install prompt
                deferredPrompt.prompt();
                
                // Wait for the user's response
                const { outcome } = await deferredPrompt.userChoice;
                
                console.log(`User response: ${outcome}`);
                
                if (outcome === 'accepted') {
                    showToast('App Installed! ðŸŽ‰', 'GetFit has been added to your device', 'success', 3000);
                }
                
                // Clear the deferredPrompt
                deferredPrompt = null;
                installButton.style.display = 'none';
            }
        });
        
        // Detect if app is installed
        window.addEventListener('appinstalled', () => {
            console.log('PWA installed successfully');
            installButton.style.display = 'none';
            showToast('Welcome! ðŸš€', 'GetFit is now installed on your device', 'success', 3000);
        });
        
        // Hide install button if already in standalone mode
        if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true) {
            installButton.style.display = 'none';
            console.log('App running in standalone mode');
        }
    </script>
</body>
</html>